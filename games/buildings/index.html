<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Web VR City Map</title>
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <style>
        body { margin: 0; }
        a-scene { height: 100vh; }
    </style>
</head>
<body>
    <a-scene>
        <a-sky color="#87CEEB"></a-sky>
        <a-plane position="0 0 -5" rotation="-90 0 0" width="1000" height="1000" color="#008000"></a-plane>
        <a-entity id="buildings"></a-entity>
    </a-scene>

    <script>
        const baseModelEndpoint = "https://api.syte.ms/api/3d/gltf/DENW49AL00009XTX";
        const buildingsContainer = document.getElementById('buildings');

        function randomizeUrl() {
            const characters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
            let randomSuffix = '';
            for (let i = 0; i < 3; i++) {
                randomSuffix += characters.charAt(Math.floor(Math.random() * characters.length));
            }
            return baseModelEndpoint.slice(0, -3) + randomSuffix;
        }

        function loadBuilding(position) {
            const url = randomizeUrl(); // Get random model URL
            const modelEntity = document.createElement('a-entity');

            modelEntity.setAttribute('gltf-model', url);
            modelEntity.setAttribute('scale', '0.5 0.5 0.5');
            modelEntity.setAttribute('position', position);
            buildingsContainer.appendChild(modelEntity);

            modelEntity.addEventListener('model-loaded', () => {
                console.log(`Model loaded successfully from: ${url}`);
            });
            modelEntity.addEventListener('model-error', () => {
                console.log(`Failed to load model from: ${url}. Retrying...`);
                loadBuilding(position); // Retry loading at the same position
            });
        }

        function placeRandomBuildings() {
            const numberOfBuildings = 20; // Increased to add more buildings
            for (let i = 0; i < numberOfBuildings; i++) {
                const x = (Math.random() - 0.5) * 100; // Random x position
                const z = (Math.random() - 0.5) * 100; // Random z position
                loadBuilding(`${x} 0 ${z}`);
            }
        }

        // Start placing buildings
        placeRandomBuildings();

        // Load new buildings as the user moves
        document.querySelector('a-scene').addEventListener('enter-vr', placeRandomBuildings);
    </script>
</body>
</html>
