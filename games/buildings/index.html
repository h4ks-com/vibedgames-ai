<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Web VR A-Frame City Map</title>
    <style>
        body { margin: 0; }
        a-scene { height: 100vh; }
    </style>
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
</head>
<body>
    <a-scene>
        <a-sky color="#87CEEB"></a-sky>
        <a-plane rotation="-90 0 0" width="1000" height="1000" color="#32CD32"></a-plane>

        <a-entity id="models-container"></a-entity>
        
        <a-camera position="0 1.6 5"></a-camera>
    </a-scene>

    <script>
        const baseUrl = "https://api.syte.ms/api/3d/gltf/DENW49AL00009XTX";
        const numModels = 20;
        
        function randomPosition() {
            return {
                x: (Math.random() - 0.5) * 200, // Range -100 to 100
                y: 0,
                z: (Math.random() - 0.5) * 200  // Range -100 to 100
            };
        }

        function generateRandomSuffix() {
            return Math.random().toString(36).substring(2, 5).toUpperCase(); // Generate random letters
        }

        function loadModel(randomSuffix) {
            return new Promise((resolve) => {
                const modelUrl = baseUrl.slice(0, -3) + randomSuffix;
                const modelEntity = document.createElement('a-entity');
                modelEntity.setAttribute('gltf-model', modelUrl);
                modelEntity.setAttribute('position', `${randomPosition().x} ${randomPosition().y} ${randomPosition().z}`);

                modelEntity.addEventListener('model-loaded', () => {
                    console.log('Model loaded successfully:', modelUrl);
                    resolve();
                });

                modelEntity.addEventListener('model-error', () => {
                    console.error('Model load failed, trying a new URL:', modelUrl);
                    loadModel(generateRandomSuffix()).then(resolve); // Retry on error
                });

                document.getElementById('models-container').appendChild(modelEntity);
            });
        }

        // Load a few models asynchronously
        const loadAllModels = async () => {
            const loadPromises = [];
            for (let i = 0; i < numModels; i++) {
                loadPromises.push(loadModel(generateRandomSuffix()));
            }
            await Promise.all(loadPromises); // Wait for all models to finish loading
            console.log(`${numModels} models attempted to load.`);
        };

        loadAllModels(); // Initiate the loading of models
    </script>
</body>
</html>
