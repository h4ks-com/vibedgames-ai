<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Web VR City Map</title>
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <style>
        body { margin: 0; }
    </style>
</head>
<body>
    <a-scene>
        <a-sky color="#87CEEB"></a-sky>
        <a-plane position="0 0 -5" rotation="-90 0 0" width="1000" height="1000" color="#008000"></a-plane>
        <a-entity id="buildings"></a-entity>
    </a-scene>

    <script>
        const baseModelEndpoint = "https://api.syte.ms/api/3d/gltf/DENW49AL00009XTX";
        const buildingsContainer = document.getElementById('buildings');
        let totalBuildings = 0; // Counter for total buildings loaded
        const maxBuildings = 100; // Limit for total buildings

        function randomizeUrl() {
            const characters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
            let randomSuffix = '';
            for (let i = 0; i < 3; i++) {
                randomSuffix += characters.charAt(Math.floor(Math.random() * characters.length));
            }
            return baseModelEndpoint.slice(0, -3) + randomSuffix;
        }

        function loadBuilding(position) {
            const url = randomizeUrl(); // Get random model URL
            const modelEntity = document.createElement('a-entity');

            modelEntity.setAttribute('gltf-model', url);
            modelEntity.setAttribute('scale', '0.5 0.5 0.5');
            modelEntity.setAttribute('position', position);
            buildingsContainer.appendChild(modelEntity);

            modelEntity.addEventListener('model-loaded', () => {
                console.log(`Model loaded successfully from: ${url}`);
                totalBuildings++; // Increment total buildings after successful load
                // If max buildings not reached, load more
                if (totalBuildings < maxBuildings) {
                    loadMoreBuildings(); 
                }
            });

            modelEntity.addEventListener('model-error', () => {
                console.log(`Failed to load model from: ${url}. Retrying...`);
                loadBuilding(position); // Retry loading at the same position
            });
        }

        function loadMoreBuildings() {
            const numberOfBuildingsToLoad = 10; // Number of buildings to load in each attempt
            for (let i = 0; i < numberOfBuildingsToLoad; i++) {
                const x = (Math.random() - 0.5) * 20; // Random x position (closer together)
                const z = (Math.random() - 0.5) * 20; // Random z position (closer together)
                loadBuilding(`${x} 0 ${z}`);
            }
        }

        // Start placing buildings
        loadMoreBuildings(); // Initial load
    </script>
</body>
</html>
