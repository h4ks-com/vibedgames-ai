<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VR IRC Client</title>
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <style>
        body {
            margin: 0;
            overflow: hidden;
        }
        #chat {
            position: fixed;
            width: 300px;
            height: 400px;
            bottom: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.9);
            border: 1px solid #ccc;
            border-radius: 5px;
            padding: 10px;
            display: flex;
            flex-direction: column;
        }
        #input {
            flex: 0 0 40px;
            border: 1px solid #ccc;
            border-radius: 5px;
            padding: 5px;
        }
    </style>
</head>
<body>
    <a-scene>
        <a-sky color="#87CEEB"></a-sky>

        <!-- Generate buildings -->
        <script>
            for (let i = 0; i < 10; i++) {
                const height = Math.floor(Math.random() * 5) + 6; // Between 6 and 10 stories
                const width = Math.random() * 2 + 1; // Width between 1 and 3
                const depth = Math.random() * 2 + 1; // Depth between 1 and 3
                const xOffset = (Math.random() - 0.5) * 20; // Position variations
                const zOffset = (Math.random() - 0.5) * 20;

                const building = document.createElement('a-box');
                building.setAttribute('height', height * 2);
                building.setAttribute('width', width);
                building.setAttribute('depth', depth);
                building.setAttribute('position', `${xOffset} ${height * 2 / 2} ${zOffset}`);
                building.setAttribute('color', '#8B4513'); // Brown color for the building

                for (let j = 0; j < 64; j++) {
                    const window = document.createElement('a-plane');
                    const wxOffset = (j % 16 - 8) * (width / 4); // Space the windows out
                    const wzOffset = Math.floor(j / 16) * (height * 2 / 4); // Stack them vertically
                    window.setAttribute('width', 0.5);
                    window.setAttribute('height', 1);
                    window.setAttribute('color', '#FFD700'); // Gold color for windows
                    window.setAttribute('position', `${wxOffset} ${1 + wzOffset} ${depth / 2 + 0.01}`);
                    building.appendChild(window);
                }

                document.querySelector('a-scene').appendChild(building);
            }
        </script>

        <a-camera position="0 1.6 0"></a-camera>
    </a-scene>

    <div id="chat">
        <h3>Chat</h3>
        <div id="messages" style="flex: 1; overflow: auto;"></div>
        <input type="text" id="input" placeholder="Type a message..." />
    </div>

    <script>
        const chatDiv = document.getElementById('messages');
        const inputField = document.getElementById('input');
        const server = "irc.h4ks.com";
        const port = 8097;

        // Generate a random nickname
        function generateNick() {
            const prefix = "watcher";
            const randomChars = Math.random().toString(36).substring(2, 10);
            return prefix + randomChars;
        }

        const nick = generateNick();
        const channel = "#lobby";

        function appendMessage(message) {
            const messageDiv = document.createElement('div');
            messageDiv.textContent = message;
            chatDiv.appendChild(messageDiv);
            chatDiv.scrollTop = chatDiv.scrollHeight; // Scroll to bottom
        }

        const ws = new WebSocket(`wss://${server}:${port}`);

        ws.onopen = () => {
            appendMessage("Connected to IRC server");
            ws.send(`NICK ${nick}`);
            ws.send(`USER ${nick} 0 * :${nick}`);
            ws.send(`JOIN ${channel}`);
        };

        ws.onmessage = (event) => {
            const message = event.data;
            const parts = message.split(' ');

            if (parts[0] === 'PING') {
                ws.send(`PONG ${parts[1]}`);
            } else if (message.includes(`PRIVMSG ${channel}`)) {
                const from = parts[0].split('!')[0];
                const text = message.split(' :')[1];
                appendMessage(`${from}: ${text}`);
            }
        };

        inputField.addEventListener('keydown', (event) => {
            if (event.key === 'Enter') {
                const msg = inputField.value;
                if (msg) {
                    ws.send(`PRIVMSG ${channel} :${msg}`);
                    appendMessage(`You: ${msg}`);
                    inputField.value = '';
                }
            }
        });
    </script>
</body>
</html>
