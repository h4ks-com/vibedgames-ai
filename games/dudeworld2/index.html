<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DudeWorld 2 - Web VR A-Frame</title>
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <style>
        body { margin: 0; padding: 0; overflow: hidden; }
        .label { position: absolute; top: 10%; left: 50%; transform: translateX(-50%); color: white; font-size: 24px; text-align: center; }
    </style>
</head>
<body>

    <div class="label" id="randomString">Loading...</div>

    <a-scene>
        <a-sky id="sky" color="#FFF"></a-sky>
        <a-plane id="floor" rotation="-90 0 0" height="100" width="100" color="#FFF"></a-plane>

        <!-- Buildings -->
        <script>
            const buildings = []; // Store references to buildings
            const randomColor = () => {
                return `#${Math.floor(Math.random() * 16777215).toString(16)}`;
            };

            const addBuildings = () => {
                for (let i = 0; i < 10; i++) {
                    const building = document.createElement('a-box');
                    const size = Math.random() * 5 + 1; // Random size between 1 and 6
                    building.setAttribute('width', size);
                    building.setAttribute('height', Math.random() * 5 + 1); // Random height
                    building.setAttribute('depth', size);
                    building.setAttribute('color', randomColor());
                    building.setAttribute('position', {
                        x: (Math.random() - 0.5) * 20,
                        y: size / 2,
                        z: (Math.random() - 0.5) * 20,
                    });
                    document.querySelector('a-scene').appendChild(building);
                    buildings.push(building); // Store the building reference
                }
            };

            const addSpheresWithLabels = () => {
                for (let i = 0; i < 10; i++) {
                    const sphere = document.createElement('a-sphere');
                    sphere.setAttribute('radius', 0.2);
                    sphere.setAttribute('color', randomColor());
                    sphere.setAttribute('position', {
                        x: (Math.random() - 0.5) * 20,
                        y: 0.2,
                        z: (Math.random() - 0.5) * 20,
                    });
                    document.querySelector('a-scene').appendChild(sphere);

                    const label = document.createElement('a-entity');
                    label.setAttribute('text', {
                        value: `Label ${i + 1}`,
                        align: 'center',
                        color: '#FFFFFF',
                    });
                    label.setAttribute('position', {
                        x: sphere.getAttribute('position').x,
                        y: sphere.getAttribute('position').y + 0.5,
                        z: sphere.getAttribute('position').z,
                    });
                    document.querySelector('a-scene').appendChild(label);
                }
            };

            const updateRandomString = () => {
                const randomString = Math.random().toString(36).substring(7);
                document.getElementById('randomString').innerText = randomString;

                // Update sphere labels
                const spheres = document.querySelectorAll('a-sphere');
                spheres.forEach((sphere, index) => {
                    const newLabel = randomString.substring(index, index + 1) || '';
                    const label = sphere.getAttribute('label');
                    if (label) {
                        label.setAttribute('text', 'value', newLabel);
                    }
                });
                
                // Update building positions based on the random string
                buildings.forEach((building, index) => {
                    const charCode = randomString.charCodeAt(index % randomString.length) || 65; // If undefined, use 'A'
                    const positionX = (charCode - 65) % 10 - 5; // Map character code to range -5 to +5
                    building.setAttribute('position', {
                        x: positionX,
                        y: building.getAttribute('position').y,
                        z: Math.random() * 20 - 10, // Random depth
                    });
                });
            };

            const updateSkyAndFloor = () => {
                document.getElementById('sky').setAttribute('color', randomColor());
                document.getElementById('floor').setAttribute('color', randomColor());
            };

            window.onload = () => {
                updateSkyAndFloor();
                addBuildings();
                addSpheresWithLabels();
                updateRandomString();
                setInterval(updateRandomString, 1000); // Update the string and building positions every second
                setInterval(updateSkyAndFloor, 10000); // Update sky and floor colors every 10 seconds
            };
        </script>
    </a-scene>

</body>
</html>
