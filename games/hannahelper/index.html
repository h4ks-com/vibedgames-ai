<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>HannaHelper Pro</title>
  <style>
    :root {
      --bg: #f6f7fb;
      --card: #ffffff;
      --user: #d0ebff;
      --bot: #e8f7ea;
      --text: #333;
      --muted: #666;
      --accent: #4f8cff;
      --shadow: 0 8px 20px rgba(0,0,0,.08);
      --bubble-radius: 14px;
      --gap: 8px;
      --toast: rgba(0,0,0,.07);
    }
    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0;
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, Arial, sans-serif;
      background: radial-gradient(circle at top left, rgba(79,140,255,.08), transparent 40%),
                  radial-gradient(circle at bottom right, rgba(0,0,0,.04), transparent 40%),
                  var(--bg);
      color: var(--text);
      display: grid;
      place-items: center;
    }
    .app {
      width: min(860px, 92vw);
      height: min(78vh, 760px);
      background: var(--card);
      border-radius: 16px;
      box-shadow: var(--shadow);
      padding: 14px;
      display: grid;
      grid-template-rows: auto auto 1fr auto;
      gap: 10px;
      position: relative;
      overflow: hidden;
    }
    header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding-bottom: 6px;
      border-bottom: 1px solid #eee;
    }
    .title-area {
      display: flex; align-items: center; gap: 12px;
    }
    .logo {
      width: 28px; height: 28px; border-radius: 6px;
      display: inline-block;
      background: conic-gradient(from 180deg at 50% 50%, #4f8cff, #7bf8a6, #ffd36b, #4f8cff);
      filter: saturate(95%);
    }
    .title { font-size: 1.05rem; font-weight: 700; }
    .hint { font-size: 0.85rem; color: var(--muted); }
    .tools { display: flex; gap: 8px; align-items: center; }

    .btn, button {
      appearance: none; border: 0; outline: 0;
      background: var(--accent); color: white; font-weight: 600;
      padding: 10px 12px; border-radius: 8px; cursor: pointer;
      transition: transform .08s ease, background .2s;
    }
    .btn.secondary {
      background: #f0f0f5; color: #333; font-weight: 600;
      border: 1px solid #ddd;
    }
    .btn.ghost {
      background: transparent; color: #333; border: 1px solid #ccc;
    }
    .btn:active { transform: translateY(1px); }
    .gear {
      width: 36px; height: 36px; border-radius: 9px;
      display: inline-flex; align-items: center; justify-content: center;
      background: #6c8cff; color: white; cursor: pointer;
    }

    /* Settings Panel (collapsible) */
    .settings {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
      padding: 12px;
      border-radius: 12px;
      background: #fff;
      border: 1px solid #eee;
      animation: slideDown .25s ease-out;
    }
    @keyframes slideDown { from { transform: translateY(-6px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }

    .panel {
      padding: 10px 12px;
      border-radius: 8px;
      background: #f9f9fb;
      border: 1px solid #eee;
    }
    .panel h4 { margin: 0 0 8px 0; font-size: 0.95rem; }
    .row { display: flex; align-items: center; gap: 8px; justify-content: space-between; padding: 6px 0; }
    .row label { font-size: 0.92rem; color: var(--text); }
    select, input[type="range"] { width: 180px; }
    input[type="checkbox"] { transform: scale(1.1); }

    /* Chat area */
    #chat {
      flex: 1;
      overflow: auto;
      padding: 8px;
      border: 1px solid #eee;
      border-radius: 12px;
      background: #fbfbfb;
      display: flex;
      flex-direction: column;
      gap: 8px;
      scroll-behavior: smooth;
    }
    .bubble {
      display: grid; grid-template-columns: 28px 1fr; align-items: start; gap: 8px;
      max-width: 78%;
      padding: 8px 12px;
      border-radius: var(--bubble-radius);
      line-height: 1.25;
      position: relative;
      opacity: 0; transform: translateY(6px);
      animation: fadeInUp .25s ease forwards;
    }
    @keyframes fadeInUp { to { opacity: 1; transform: translateY(0); } }

    .bubble.user {
      justify-self: end;
      background: var(--user);
      color: #0b2;
    }
    .bubble.bot {
      justify-self: start;
      background: var(--bot);
      color: #0b2;
    }
    .bubble .text {
      font-size: 0.95rem;
      white-space: pre-wrap;
      word-break: break-word;
    }
    .avatar {
      width: 26px; height: 26px; border-radius: 50%;
      display: inline-block;
      background: #ddd; box-shadow: inset 0 0 0 2px #fff;
    }
    .avatar.user { background: #6ea8ff; }
    .avatar.bot { background: #8bd4a8; }

    /* Typewriter effect target */
    .typing { border-right: .08em solid rgba(0,0,0,.5); }

    .badge {
      display: inline-flex; align-items: center; gap: 6px;
      padding: 6px 10px; border-radius: 999px;
      background: #eef6ff; color: #1e4ed8; font-weight: 600;
      font-size: 12px;
      position: absolute; top: -6px; right: -6px;
    }

    /* Input area */
    .input-area {
      display: flex; gap: 8px; align-items: center;
      padding-top: 6px; border-top: 1px solid #eee;
    }
    #userInput {
      flex: 1; padding: 12px 14px; border: 1px solid #ccc; border-radius: 8px;
      font-size: 1rem; outline: none;
      transition: border-color .2s;
    }
    #userInput:focus { border-color: #4f8cff; }

    /* Helpers */
    .hidden { display: none; }

    /* Themes */
    body.dark {
      --bg: #0f1221;
      --card: #141726;
      --user: #1e2a50;
      --bot: #1a2a1a;
      --text: #e9e8f8;
      --muted: #b8b8c9;
      --accent: #7aa6ff;
      --toast: rgba(255,255,255,.08);
    }
    body.dark #chat { background: #0b1020; border-color: #2a2a2a; }
    body.dark .panel { background: #1f1f2a; border-color: #2e2e3a; }
    body.dark .hint { color: #aaa; }
  </style>
</head>
<body>
  <div class="app" aria-label="HannaHelper game">
    <header>
      <div class="title-area">
        <span class="logo" aria-hidden="true"></span>
        <div>
          <div class="title" style="display:flex; align-items:center; gap:6px;">
            HannaHelper Pro
            <span class="badge" id="modeBadge" title="Current mode">Concise</span>
          </div>
          <div class="hint" id="statusHint">Hint: Ask anything. Use the advanced settings to tailor responses.</div>
        </div>
      </div>
      <div class="tools" aria-label="global controls">
        <button class="gear" id="toggleSettings" title="Advanced settings">⚙️</button>
        <button class="btn" id="exportBtn" title="Export chat">Export</button>
      </div>
    </header>

    <section id="settings" class="hidden" aria-label="Advanced settings panel">
      <div class="settings" style="grid-template-columns: 1fr 1fr;">
        <div class="panel" aria-label="Mode settings">
          <h4>Response Mode</h4>
          <div class="row">
            <label for="modeSelect">Mode</label>
            <select id="modeSelect" title="Response mode">
              <option value="concise">Concise</option>
              <option value="balanced" selected>Balanced</option>
              <option value="verbose">Verbose</option>
              <option value="friendly">Friendly</option>
              <option value="techy">Techy</option>
            </select>
          </div>
          <div class="row">
            <label for="densityRange">Density</label>
            <input type="range" id="densityRange" min="1" max="3" step="1" value="2" title="Chat density">
          </div>
        </div>

        <div class="panel" aria-label="Behavior settings">
          <h4>Behavior & Appearance</h4>
          <div class="row">
            <label for="emojiToggle">Emoji</label>
            <input type="checkbox" id="emojiToggle" checked />
          </div>
          <div class="row">
            <label for="typewriterToggle">Typewriter</label>
            <input type="checkbox" id="typewriterToggle" checked />
          </div>
          <div class="row">
            <label for="themeToggle">Theme</label>
            <button class="btn ghost" id="themeToggle" title="Toggle theme">Light/Dark</button>
          </div>
        </div>

        <div class="panel" aria-label="Prompts">
          <h4>Prompts</h4>
          <p style="font-size:.85rem; color:var(--muted); margin:0 0 8px 0;">
            Quick prompts to jumpstart helpful replies.
          </p>
          <div class="row" style="gap:6px;">
            <button class="btn secondary" data-prompt="Tell me a short plan for organizing my day.">Day plan</button>
            <button class="btn secondary" data-prompt="Explain how to optimize my study routine in under 3 bullet points.">Study tips</button>
            <button class="btn secondary" data-prompt="Give me a one-sentence summary of this topic: AI.">Topic sum</button>
          </div>
        </div>

        <div class="panel" aria-label="Actions">
          <h4>Actions</h4>
          <div class="row">
            <button class="btn" id="clearBtn" title="Clear chat">Clear</button>
            <button class="btn" id="importBtn" title="Import sample chat">Load Sample</button>
          </div>
        </div>
      </div>
    </section>

    <section id="chat" aria-live="polite" aria-label="Chat area">
      <!-- messages appear here -->
    </section>

    <div class="input-area" aria-label="Input area" style="gap:8px;">
      <input id="userInput" type="text" placeholder="Ask HannaHelper something..." autocomplete="off" />
      <button id="sendBtn" class="btn" title="Send">Send</button>
      <button id="promptBtn" class="btn secondary" title="Prompts">Prompts</button>
    </div>
  </div>

  <script>
    (function() {
      // Elements
      const chat = document.getElementById('chat');
      const input = document.getElementById('userInput');
      const sendBtn = document.getElementById('sendBtn');
      const toggleSettings = document.getElementById('toggleSettings');
      const settingsEl = document.getElementById('settings');
      const modeSelect = document.getElementById('modeSelect');
      const densityRange = document.getElementById('densityRange');
      const emojiToggle = document.getElementById('emojiToggle');
      const typewriterToggle = document.getElementById('typewriterToggle');
      const themeToggle = document.getElementById('themeToggle');
      const statusHint = document.getElementById('statusHint');
      const modeBadge = document.getElementById('modeBadge');
      const exportBtn = document.getElementById('exportBtn');
      const clearBtn = document.getElementById('clearBtn');
      const importBtn = document.getElementById('importBtn');
      const promptBtn = document.getElementById('promptBtn');
      const prompts = document.querySelectorAll('[data-prompt]');

      // State
      let settings = {
        mode: 'concise',
        density: 2,
        emoji: true,
        typewriter: true,
        theme: 'light'
      };
      let history = [];

      // Helpers
      const EMOJIS = ['✨','💡','🎯','🧠','⚡','🚀','🌟','🎉','🧩','🎈'];

      function saveSettings() {
        localStorage.setItem('hanna_settings', JSON.stringify(settings));
      }
      function loadSettings() {
        const s = localStorage.getItem('hanna_settings');
        if (s) {
          try { settings = JSON.parse(s); } catch(e) { /* ignore */ }
        }
      }
      function saveHistory() {
        localStorage.setItem('hanna_history', JSON.stringify(history));
      }
      function loadHistory() {
        const h = localStorage.getItem('hanna_history');
        if (h) {
          try { history = JSON.parse(h); } catch(e) { /* ignore */ }
        }
      }

      function applyTheme() {
        if (settings.theme === 'dark') {
          document.body.classList.add('dark');
        } else {
          document.body.classList.remove('dark');
        }
      }

      function setModeBadge() {
        modeBadge.textContent = capitalize(settings.mode);
      }

      function capitalize(s) { return s.charAt(0).toUpperCase() + s.slice(1); }

      function randomEmoji() {
        if (!settings.emoji) return '';
        return EMOJIS[Math.floor(Math.random() * EMOJIS.length)];
      }

      function addMessage(sender, text) {
        const bubble = document.createElement('div');
        bubble.className = 'bubble ' + sender;
        // avatar
        const av = document.createElement('span');
        av.className = 'avatar ' + sender;
        bubble.appendChild(av);
        // text wrapper
        const t = document.createElement('span');
        t.className = 'text';
        bubble.appendChild(t);

        // Typewriter or immediate
        if (settings.typewriter && sender === 'bot' && text.length > 28) {
          t.textContent = '';
          bubble.classList.add('typing');
          let i = 0;
          const speed = 18;
          const timer = setInterval(() => {
            t.textContent = text.substring(0, i + 1);
            i++;
            if (i >= text.length) {
              clearInterval(timer);
              bubble.classList.remove('typing');
            }
          }, speed);
        } else {
          t.textContent = text;
        }

        chat.appendChild(bubble);
        // auto-scroll
        chat.scrollTop = chat.scrollHeight;
        // push to history
        history.push({ sender, text, ts: Date.now() });
        saveHistory();

        // little pop animation on arrival
        bubble.style.animationDuration = (0.25 + Math.random() * 0.15).toFixed(2) + 's';
      }

      function botResponse(inputText) {
        // Basic heuristic responses with mode influence
        const mode = settings.mode;
        const base = {
          concise: [
            "Got it. I'll keep it short and sweet.",
            "Here's the gist: plan, execute, repeat."
          ],
          balanced: [
            "Here's a balanced take: summarize, then explain briefly with examples.",
            "I can help with steps and a quick rationale."
          ],
          verbose: [
            "I'm going to provide a thorough explanation with context, examples, and next steps.",
            "Here's a full walkthrough: define, explore, and implement with caveats."
          ],
          friendly: [
            "Nice question! Here's a friendly, helpful answer.",
            "Happy to help—here's a clear, supportive response."
          ],
          techy: [
            "Applying algorithmic reasoning: outline, edge cases, and performance notes.",
            "Solution sketch: modularize, optimize, and test with cases."
          ]
        };

        // Simple matching
        const q = inputText.toLowerCase();
        let reply = "";

        if (q.includes('hello') || q.includes('hi')) {
          reply = "Hi there! I’m HannaHelper. How can I assist you today?";
        } else if (q.includes('day') && q.includes('plan')) {
          reply = "Sure—start with a 3-step plan: 1) list today’s goals, 2) block time, 3) review results.";
        } else if (q.includes('export')) {
          reply = "Use the Export button to download your chat as JSON.";
        } else if (q.includes('help') || q.includes('how')) {
          reply = "Ask me to explain a concept, draft a plan, or solve a small task. I tailor length by mode.";
        } else {
          // default from mode
          const pool = base[mode] || base.concise;
          reply = pool[Math.floor(Math.random() * pool.length)];
        }

        // Append token for flavor
        const token = generateToken();
        if (settings.emoji) reply += " " + randomEmoji() + " " + "t." + token;

        // Elaborate depending on mode
        if (mode === 'concise') {
          reply = reply.split('.')[0] + '.';
        } else if (mode === 'verbose') {
          reply += " If you'd like, I can expand on any point with more detail or code examples.";
        } else if (mode === 'techy') {
          reply += " Complexity: O(n) in the number of steps, memory usage considered.";
        }

        // sanitize length
        if (reply.length > 420) reply = reply.substring(0, 417) + '...';
        return reply;
      }

      function respond() {
        const token = generateToken();
        const inputText = (history.slice(-1)[0] && history.slice(-1)[0].text) || '';
        let reply = botResponse(inputText);
        // ensure mode badge updates
        setModeBadge();

        // Show bot reply
        addMessage('bot', reply);
        // update hint
        statusHint.textContent = "Tip: You are in " + capitalize(settings.mode) + " mode. Ask anything.";
      }

      // Token generator for flavor
      function generateToken() {
        const chars = 'ABCDEFGHJKLMNPQRSTUVWXYZ23456789';
        let t = '';
        for (let i = 0; i < 6; i++) t += chars.charAt(Math.floor(Math.random() * chars.length));
        return t;
      }

      // Initialize
      function initialWelcome() {
        const welcome = "HannaHelper is online. I can help with quick plans, explanations, and tips — all tailored to your mode.";
        addMessage('bot', welcome);
      }

      // Input handling
      function submit() {
        const val = input.value.trim();
        if (!val) return;
        addMessage('user', val);
        input.value = '';
        // store
        history.push({ sender: 'user', text: val, ts: Date.now() });
        saveHistory();
        // bot reply after a moment
        setTimeout(respond, 180);
      }

      // Event bindings
      sendBtn.addEventListener('click', submit);
      input.addEventListener('keydown', (e) => {
        if (e.key === 'Enter') {
          e.preventDefault();
          submit();
        }
      });

      toggleSettings.addEventListener('click', () => {
        if (settingsEl.classList.contains('hidden')) {
          settingsEl.classList.remove('hidden');
        } else {
          settingsEl.classList.add('hidden');
        }
      });

      modeSelect.addEventListener('change', () => {
        settings.mode = modeSelect.value;
        setModeBadge();
        saveSettings();
        statusHint.textContent = "Mode changed to " + capitalize(settings.mode) + ". Responses will adapt.";
      });

      densityRange.addEventListener('change', () => {
        settings.density = Number(densityRange.value);
        // affects chat density by adjusting maximum bubble width
        chat.style.setProperty('--gap', settings.density === 3 ? '14px' : '8px');
        chat.style.setProperty('--bubble-radius', settings.density === 1 ? '10px' : '14px');
        saveSettings();
      });

      emojiToggle.addEventListener('change', () => {
        settings.emoji = emojiToggle.checked;
        saveSettings();
      });

      typewriterToggle.addEventListener('change', () => {
        settings.typewriter = typewriterToggle.checked;
        saveSettings();
      });

      themeToggle.addEventListener('click', () => {
        settings.theme = (settings.theme === 'light') ? 'dark' : 'light';
        applyTheme();
        saveSettings();
        statusHint.textContent = "Theme: " + (settings.theme === 'dark' ? 'Dark' : 'Light');
      });

      // Prompts quick-fill
      prompts.forEach(btn => {
        btn.addEventListener('click', () => {
          const prompt = btn.getAttribute('data-prompt');
          input.value = prompt;
          input.focus();
        });
      });

      // Prompts area
      promptBtn.addEventListener('click', () => {
        input.value = "Tell me a short plan for organizing my day.";
        input.focus();
      });

      // Export/import
      exportBtn.addEventListener('click', exportChat);
      clearBtn.addEventListener('click', () => {
        history = [];
        chat.innerHTML = '';
        saveHistory();
        initialWelcome();
      });

      importBtn.addEventListener('click', loadSampleChat);

      function exportChat() {
        const data = {
          settings,
          history
        };
        const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'hanna_history.json';
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
      }

      function loadSampleChat() {
        // simple sample chat
        history = [
          { sender: 'bot', text: "Welcome back! This sample shows how HannaHelper responds in various modes.", ts: Date.now() - 10000 },
          { sender: 'user', text: "Hello Hanna!", ts: Date.now() - 9000 },
          { sender: 'bot', text: "Hi there! Ready to tackle tasks with concise or verbose explanations based on your setting.", ts: Date.now() - 8000 }
        ];
        renderHistory();
      }

      function renderHistory() {
        chat.innerHTML = '';
        history.forEach(item => {
          addMessage(item.sender, item.text);
        });
      }

      // Init
      function init() {
        loadSettings();
        loadHistory();
        applyTheme();
        // set UI to saved values
        modeSelect.value = settings.mode;
        densityRange.value = String(settings.density);
        emojiToggle.checked = settings.emoji;
        typewriterToggle.checked = settings.typewriter;
        setModeBadge();

        if (history.length > 0) {
          renderHistory();
        } else {
          initialWelcome();
        }

        // hide settings on start
        settingsEl.classList.add('hidden');
      }

      // History token
      function setModeBadge() {
        modeBadge.textContent = capitalize(settings.mode);
      }

      // Run
      init();
    })();
  </script>
</body>
</html>