<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Mandel Night VR Scene with User Coordinates Overlay</title>
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <style>
        body { margin: 0; }
        #coordinates-panel {
            position: absolute;
            top: 20px;
            left: 20px;
            color: white;
            background: rgba(0, 0, 0, 0.5);
            padding: 10px;
            border-radius: 5px;
            font-family: Arial, sans-serif;
            z-index: 999;
        }
        #info {
            position: absolute;
            top: 100px;
            left: 10px;
            color: white;
            z-index: 1000;
            background-color: rgba(0, 0, 0, 0.7);
            padding: 10px;
            border-radius: 5px;
            font-size: 18px;
        }
        a-scene { height: 100vh; background-color: skyblue; }
    </style>
</head>
<body>
    <div id="coordinates-panel">Coordinates: (0, 0, 0)</div>
    <div id="info">Number of Objects: <span id="object-count">0</span></div>

    <audio autoplay loop>
        <source src="https://archive.org/download/Winston_Churchill/1934-11-16_BBC_Winston_Churchill_The_Threat_Of_Nazi_Germany.mp3" type="audio/mpeg">
    </audio>

    <a-scene>
        <a-sky id="mandelbrot-sky" src="" rotation="0 -130 0"></a-sky>
        <a-entity light="type: ambient; intensity: 0.2"></a-entity>
        <a-entity light="type: directional; intensity: 0.5; position: 0 10 0"></a-entity>

        <a-box position="0 3.501 -10" depth="5" height="15" width="5" src="#" castShadow receiveShadow id="mandelbrot-building"></a-box>
        
        <a-plane position="0 0.001 -10" width="4000" height="4000" src="#" rotation="-90 0 0" repeat="1000 1000"></a-plane>
        
        <a-box position="0 0.051 0" width="100" height="0.1" depth="100" color="green"></a-box>
        
        <a-entity id="curved-road" position="0 0.1 0"></a-entity>
        <a-entity id="road-boundaries" position="0 0.1 0"></a-entity>
        <a-camera position="0 5 20"></a-camera>
        
        <a-entity id="structures"></a-entity>
        <a-entity id="cars"></a-entity>

        <script>
            const roadWidth = 12.5; 
            const roadLength = 100;
            const roadSegments = 100; 

            const cars = []; 
            const buildings = []; 

            function createCurvedRoad() {
                for (let i = 0; i < roadSegments; i++) {
                    const positionZ = (i / roadSegments) * roadLength - (roadLength / 2);
                    const sinValue = Math.sin((i / roadSegments) * Math.PI * 2) * (roadWidth / 2);

                    const segment = document.createElement('a-box');
                    segment.setAttribute('width', 1);
                    segment.setAttribute('height', 0.8);
                    segment.setAttribute('depth', 2);
                    segment.setAttribute('color', 'black');
                    segment.setAttribute('position', `${sinValue} 0.051 ${positionZ}`);
                    segment.setAttribute('rotation', '0 90 0');

                    document.getElementById('curved-road').appendChild(segment);
                }
            }

            function createRoadBoundaries() {
                const boundaryWidth = 0.2; 
                
                for (let i = 0; i < roadSegments; i++) {
                    const positionZ = (i / roadSegments) * roadLength - (roadLength / 2);
                    const sinValueLeft = Math.sin((i / roadSegments) * Math.PI * 2) * (roadWidth / 2) - (roadWidth / 2) - (boundaryWidth / 2);
                    const sinValueRight = Math.sin((i / roadSegments) * Math.PI * 2) * (roadWidth / 2) + (roadWidth / 2) + (boundaryWidth / 2);

                    const leftBoundary = document.createElement('a-box');
                    leftBoundary.setAttribute('width', boundaryWidth);
                    leftBoundary.setAttribute('height', 0.1);
                    leftBoundary.setAttribute('depth', 2);
                    leftBoundary.setAttribute('color', 'white');
                    leftBoundary.setAttribute('position', `${sinValueLeft} 0.1 ${positionZ}`);
                    leftBoundary.setAttribute('rotation', '0 90 0');
                    document.getElementById('road-boundaries').appendChild(leftBoundary);

                    const rightBoundary = document.createElement('a-box');
                    rightBoundary.setAttribute('width', boundaryWidth);
                    rightBoundary.setAttribute('height', 0.1);
                    rightBoundary.setAttribute('depth', 2);
                    rightBoundary.setAttribute('color', 'white');
                    rightBoundary.setAttribute('position', `${sinValueRight} 0.1 ${positionZ}`);
                    rightBoundary.setAttribute('rotation', '0 90 0');
                    document.getElementById('road-boundaries').appendChild(rightBoundary);
                }
            }

            function createBuilding() {
                const randomWidth = Math.random() * 4 + 1; 
                const randomHeight = Math.random() * 10 + 3; 
                
                let xPosition, zPosition;

                if (Math.random() < 0.5) {
                    xPosition = Math.random() * (40 - (randomWidth / 2)) + (6.25 + (randomWidth / 2));
                } else {
                    xPosition = Math.random() * (40 - (randomWidth / 2)) - (6.25 + (randomWidth / 2));
                }
                zPosition = Math.random() * 80 - 40; 

                const building = document.createElement('a-box');
                const buildingColor = `hsl(${Math.random() * 360}, 100%, 50%)`; 

                building.setAttribute('color', buildingColor);
                building.setAttribute('width', randomWidth);
                building.setAttribute('depth', randomWidth);
                building.setAttribute('height', randomHeight);
                building.setAttribute('position', `${xPosition} ${randomHeight / 2 + 0.001} ${zPosition}`);

                document.getElementById('structures').appendChild(building);
                buildings.push(building); 
            }

            function createCar() {
                const carColors = ['red', 'red', 'red', 'red', 'red', 'red'];

                const car = document.createElement('a-entity');
                const randomColor = carColors[Math.floor(Math.random() * carColors.length)];

                const carWidth = 1; 
                const carLength = carWidth * 1.5; 
                const laneOffset = Math.random() > 0.5 ? -6 : 6; 
                const startZ = 50; 
                const randomSpeed = (Math.random() * 2 + 1) * 0.3; 

                const carBody = document.createElement('a-box');
                carBody.setAttribute('color', randomColor);
                carBody.setAttribute('position', `0 0.25 0`);
                carBody.setAttribute('width', carWidth);
                carBody.setAttribute('length', carLength); 
                carBody.setAttribute('depth', 0.5); 

                car.appendChild(carBody);
                document.getElementById('cars').appendChild(car);
                cars.push(car); 

                let positionZ = startZ;
                function drive() {
                    positionZ -= randomSpeed;
                    const sineIndex = ((positionZ + 50) / 100) * Math.PI * 2; 
                    const sinValue = Math.sin(sineIndex) * (roadWidth / 2); 

                    car.setAttribute('position', `${sinValue + laneOffset} 0.25 ${positionZ}`); 

                    if (positionZ < -50) {
                        positionZ = 50;
                    }
                    requestAnimationFrame(drive);
                }
                requestAnimationFrame(drive);
            }

            function updateObjectCount() {
                const currentCount = cars.length + buildings.length;
                document.getElementById('object-count').innerText = currentCount;
            }

            createCurvedRoad();
            createRoadBoundaries();

            for (let i = 0; i < 10; i++) {
                createBuilding();
            }

            setInterval(createCar, 10000); 
            setInterval(updateObjectCount, 1000); 

            // Coordinate panel update
            const coordinatesPanel = document.getElementById('coordinates-panel');
            const camera = document.querySelector('[camera]');

            function updateCoordinates() {
                const position = camera.getAttribute('position');
                coordinatesPanel.innerHTML = `Coordinates: (${position.x.toFixed(2)}, ${position.y.toFixed(2)}, ${position.z.toFixed(2)})`;
                requestAnimationFrame(updateCoordinates);
            }
            updateCoordinates();
        </script>

        <!-- Mandelbrot Image Generation -->
        <script>
            function createMandelbrotImage(width, height) {
                const canvas = document.createElement('canvas');
                canvas.width = width;
                canvas.height = height;
                const ctx = canvas.getContext('2d');

                ctx.clearRect(0, 0, width, height); 

                const colors = [];
                for (let i = 0; i < 256; i++) {
                    const r = (i & 0xFF) % 256; 
                    const g = (i * 2) % 256; 
                    const b = (i * 4) % 256; 
                    colors.push(`rgba(${r},${g},${b},1)`); 
                }

                const maxIterations = 100;

                for (let x = 0; x < width; x++) {
                    for (let y = 0; y < height; y++) {
                        let zx = 0, zy = 0;
                        let cX = (x / width) * 4 - 2; 
                        let cY = (y / height) * 4 - 2; 
                        let iterations = 0;

                        while (zx * zx + zy * zy < 4 && iterations < maxIterations) {
                            let tmp = zx * zx - zy * zy + cX;
                            zy = 2 * zx * zy + cY;
                            zx = tmp;
                            iterations++;
                        }

                        const colorIndex = Math.min(Math.floor((iterations / maxIterations) * 256), 255);
                        ctx.fillStyle = colors[colorIndex];
                        ctx.fillRect(x, y, 1, 1); 
                    }
                }
                return canvas.toDataURL();
            }

            const mandelbrotImageSrc = createMandelbrotImage(200, 200); 
            document.getElementById('mandelbrot-sky').setAttribute('src', mandelbrotImageSrc);
            document.getElementById('mandelbrot-building').setAttribute('src', mandelbrotImageSrc);
            document.querySelector('a-plane').setAttribute('src', mandelbrotImageSrc);
            document.querySelector('a-plane').setAttribute('repeat', '1000 1000'); 
        </script>
    </a-scene>
</body>
</html>
