<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>TacoWebsite — Explore Popular Tacos</title>
  <meta name="description" content="A lightweight, data-driven catalog of popular Mexican tacos with search, tag filters, responsive design, a lightbox gallery, favorites, and themes." />
  <meta property="og:title" content="TacoWebsite" />
  <meta property="og:description" content="Explore popular tacos with searchable, filterable data and a lightbox gallery." />
  <style>
    :root{
      --bg: #ffffff;
      --fg: #1f2937;
      --muted:#6b7280;
      --card:#ffffff;
      --accent:#e11d48;
      --chip:#f3f4f6;
      --border:#e5e7eb;
      --shadow:0 6px 18px rgba(0,0,0,.08);
      --radius:12px;
      --brand: #111;
      --bg-grad: linear-gradient(135deg, #fff 0%, #f7f7fb 60%);
    }
    body.dark {
      --bg: #0b1020;
      --fg: #e5e7eb;
      --muted:#a6aab8;
      --card:#14172a;
      --border:#2a2f4a;
      --shadow: 0 8px 20px rgba(0,0,0,.4);
      --bg-grad: linear-gradient(135deg, #0b1020 0%, #15182b 60%);
    }
    *, *::before, *::after { box-sizing: border-box; }
    html { scroll-behavior: smooth; }
    body {
      margin:0;
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      color: var(--fg);
      background: var(--bg);
      background-image: radial-gradient(circle at 20% -10%, rgba(255,255,255,.6) 0 20px, transparent 20px),
                        radial-gradient(circle at 70% 0, rgba(0,0,0,.04) 0 20px, transparent 20px);
      background-size: cover;
      line-height: 1.5;
      transition: background 0.3s ease;
    }
    a { color: inherit; text-decoration: none; }
    header[role="navigation"] { position: sticky; top:0; z-index: 40; background: #fff; border-bottom: 1px solid var(--border); }
    body.dark header[role="navigation"] { background: #0b1020; border-bottom: 1px solid #25283a; }
    .container { width: min(1100px, 92%); margin: 0 auto; padding: 0 0.5rem; }
    .brand { display:flex; align-items:center; gap:.75rem; padding: .75rem 0; }
    .brand img { width:28px; height:28px; }
    nav ul { list-style:none; margin:0; padding:0; display:flex; gap:1rem; flex-wrap: wrap; align-items:center; }
    nav a { padding:.5rem 0; color:#374151; font-weight:700; letter-spacing:.2px; }
    nav a:focus-visible { outline: 2px solid #111827; outline-offset: 2px; border-radius:4px; }
    .skip-link{ position:absolute; left:-9999px; top:auto; width:1px; height:1px; overflow:hidden; }
    .skip-link:focus{ position:relative; width:auto; height:auto; padding:8px 12px; background:#111; color:#fff; border-radius:4px; z-index: 999; }

    .hero { padding: 48px 0 28px; text-align:center; background: var(--bg-grad); position: relative; overflow:hidden; }
    .hero::after { content:''; position:absolute; right:-20%; top:-20%; width: 60%; height:60%; background: radial-gradient(circle, rgba(255,255,255,.6), rgba(255,255,255,0) 60%); filter: blur(2px); pointer-events:none; }
    .hero h1{ font-size: clamp(2rem, 3vw + 1rem, 3rem); margin:.25rem 0 0.75rem; }
    .hero p{ color: var(--muted); margin:0 auto 1rem; max-width: 640px; }
    .cta{ display:inline-flex; gap:.5rem; align-items:center; padding:.75rem 1rem; border-radius:999px; border:1px solid var(--border); background:#111; color:#fff; font-weight:700; cursor:pointer; }
    .cta:focus-visible{ outline:2px solid #111; outline-offset:2px; }

    .tools { display:flex; flex-wrap:wrap; gap:.75rem; align-items:center; justify-content:center; margin: 10px 0 16px; }
    .tools .chip{ display:inline-flex; align-items:center; gap:.4rem; padding:.4rem .6rem; border-radius:999px; background:var(--chip); border:1px solid var(--border); font-size:.85rem; color:var(--fg); }

    section { padding: 40px 0; }
    h2 { font-size: 1.75rem; margin:0 0 0.75rem; }
    .section-intro{ color:var(--muted); margin-bottom:1rem; }

    /* Filters & layout */
    .filters{ display:flex; flex-wrap:wrap; gap:.75rem; justify-content:center; align-items:center; margin: 8px 0 10px; }
    .filters label{ font-size:.9rem; color:var(--muted); margin-right:.25rem; }
    .filters select, .filters input{ padding:.55rem .6rem; border-radius:6px; border:1px solid var(--border); background:#fff; min-width: 180px; }
    .filters input[type="search"]{ min-width: 260px; }
    .switch{ display:inline-flex; align-items:center; gap:.5rem; padding:.4rem .6rem; border-radius:999px; border:1px solid var(--border); background:#fff; cursor:pointer; }

    .grid{ display:grid; grid-template-columns: repeat(auto-fill, minmax(260px, 1fr)); gap:1rem; }

    .card{ border:1px solid var(--border); border-radius: var(--radius); overflow:hidden; background:var(--card); box-shadow: var(--shadow); display:flex; flex-direction:column; min-height:100%; position: relative; transform: translateZ(0); transition: transform .25s ease, box-shadow .25s ease; }
    .card:hover{ transform: translateY(-4px) scale(1.01); box-shadow: 0 10px 28px rgba(0,0,0,.14); }
    .card figure{ margin:0; height:180px; background:#f8f8f8; display:flex; align-items:center; justify-content:center; overflow:hidden; position:relative; }
    .card img{ width:100%; height:100%; object-fit:cover; display:block; filter: saturate(1.05); transform: scale(1.01); transition: transform .6s ease; }
    .card:hover img{ transform: scale(1.08); }
    .card-content{ padding: .75rem 1rem 1rem; display:flex; flex-direction:column; gap:.25rem; }
    .card h3{ font-size:1.05rem; margin:0; }
    .desc{ color: var(--muted); font-size:.95rem; margin:0; }
    .meta{ display:flex; gap:.4rem; align-items:center; flex-wrap:wrap; margin-top:.25rem; }
    .badge{ background: var(--chip); border-radius:999px; padding: .25rem .6rem; font-size:.75rem; color:#374151; }
    .ingredients{ font-size:.85rem; color:#374151; margin:0; }

    .btn{ margin-top:auto; padding:.5rem .75rem; border:none; background:#111; color:#fff; border-radius:6px; font-weight:700; cursor:pointer; }
    .btn:focus-visible{ outline:2px solid #111; outline-offset:2px; }

    .favBtn{ position:absolute; top:8px; right:8px; background: rgba(255,255,255,.85); border:1px solid var(--border); width:34px; height:34px; border-radius:8px; display:flex; align-items:center; justify-content:center; cursor:pointer; transition: transform .2s ease; z-index:2; }
    body.dark .favBtn{ background: rgba(0,0,0,.35); color:#ffd1d1; border:1px solid #444; }
    .favBtn:hover{ transform: scale(1.05); }
    .favBtn.active{ background: #e0245e; color: #fff; }

    /* Lightbox */
    .lightbox{ position:fixed; inset:0; background: rgba(0,0,0,.8); display:none; align-items:center; justify-content:center; padding:1rem; z-index: 9999; opacity:0; transition: opacity .2s ease; }
    .lightbox.is-open{ display:flex; opacity:1; }
    .lb-content{ position:relative; max-width: 90vw; max-height: 85vh; display:flex; flex-direction:column; align-items:stretch; justify-content:center; }
    .lb-image{ width:100%; height:auto; border-radius:8px; box-shadow: 0 8px 24px rgba(0,0,0,.4); background:#000; }
    .lb-controls{ display:flex; justify-content:space-between; align-items:center; margin-top:.5rem; }
    .lb-btn{ background:#111; color:#fff; border:0; border-radius:6px; padding:.5rem 1rem; cursor:pointer; font-weight:700; }
    .lb-caption{ color:#fff; text-align:center; margin-top:.25rem; font-size:.95rem; }

    .lb-close{ position:absolute; top:8px; right:8px; background:#111; color:#fff; border:0; border-radius:6px; width:34px; height:34px; font-size:16px; cursor:pointer; }

    footer{ padding: 2rem 0; text-align:center; color:var(--muted); }

    .sr-only { position:absolute; width:1px; height:1px; padding:0; margin:-1px; overflow:hidden; clip:rect(0,0,0,0); white-space:nowrap; border:0; }

    @media (max-width: 700px){
      .filters{ flex-direction:column; align-items:stretch; }
      .card figure{ height:140px; }
    }

    /* Simple powered animations for gallery tiles */
    @keyframes pop {
      0% { transform: scale(0.98); opacity:.0; }
      100% { transform: scale(1); opacity:1; }
    }
    .thumb{ border-radius:8px; overflow:hidden; border:1px solid var(--border); animation: pop 0.35s ease both; }
    .thumb img{ display:block; width:100%; height:120px; object-fit:cover; }
  </style>
</head>
<body>
  <a href="#types" class="skip-link">Skip to content</a>

  <header role="navigation" aria-label="Main navigation">
    <div class="container brand" aria-label="TacoWebsite brand">
      <svg width="26" height="26" viewBox="0 0 24 24" aria-label="Taco icon" role="img" focusable="false" fill="currentColor"><path d="M4 8c-1.1 0-2 .9-2 2 0 3 4 7 6 7s6-4 6-7c0-1.1-.9-2-2-2H4zm9 3c-1 0-2-.9-2-2 0-1.1.9-2 2-2h0c1 0 2 .9 2 2s-.9 2-2 2z"/></svg>
      <strong style="letter-spacing:.5px">TacoWebsite</strong>
      <nav aria-label="Primary">
        <ul role="list">
          <li><a href="#home" aria-label="Home">Home</a></li>
          <li><a href="#types" aria-label="Types of Tacos">Types of Tacos</a></li>
          <li><a href="#ingredients" aria-label="Ingredients">Ingredients</a></li>
          <li><a href="#gallery" aria-label="Gallery">Gallery</a></li>
          <li><a href="#about" aria-label="About">About</a></li>
        </ul>
      </nav>
      <div style="margin-left:auto; display:flex; align-items:center; gap:.5rem;">
        <button id="themeToggle" class="cta" style="padding:.5rem .75rem; background:#111; border-radius:999px; font-size:.9rem;" aria-label="Toggle theme">🌙</button>
      </div>
    </div>
  </header>

  <main id="home" class="container" aria-label="Homepage">
    <section class="hero" aria-labelledby="hero-title">
      <h1 id="hero-title">Explore the world of tacos</h1>
      <p>Data-driven catalog of popular Mexican tacos. Search, filter by type, region, or ingredient, and enjoy a lightweight lightbox gallery with favorites and themes.</p>
      <a href="#types" class="cta" aria-label="Explore tacos" style="background:#e11d48 not-allowed; color:#fff;">Explore Tacos</a>
    </section>
  </main>

  <main class="container" aria-label="Main content">
    <section id="types" aria-labelledby="types-title">
      <h2 id="types-title">Types of Tacos</h2>
      <p class="section-intro">A curated collection of popular tacos. Use filters to refine results.</p>

      <div class="tools" aria-label="Tooling">
        <span class="chip">Tip: Press F to toggle favorites</span>
        <span class="chip">Tip: Use Left/Right arrows in lightbox</span>
      </div>

      <div class="filters" aria-label="Filters">
        <label for="search" class="sr-only" hidden>Search tacos</label>
        <input type="search" id="search" placeholder="Search by name, description, or ingredients" aria-label="Search tacos" />

        <label for="typeFilter" class="sr-only" hidden>Type</label>
        <select id="typeFilter" aria-label="Filter by taco type">
          <!-- options populated by JS -->
        </select>

        <label for="regionFilter" class="sr-only" hidden>Region</label>
        <select id="regionFilter" aria-label="Filter by region">
          <!-- options populated by JS -->
        </select>

        <label for="ingredientFilter" class="sr-only" hidden>Ingredient</label>
        <select id="ingredientFilter" aria-label="Filter by ingredient">
          <!-- options populated by JS -->
        </select>

        <label class="switch" for="showFavs">
          <input id="showFavs" type="checkbox" aria-label="Show favorites only" />
          Show favorites only
        </label>

        <label class="switch" for="sortSel">
          <span style="font-size:.9rem; color:var(--muted); margin-right:.25rem;">Sort:</span>
          <select id="sortSel" aria-label="Sort tacos" style="padding:.5rem .6rem; border-radius:6px; border:1px solid var(--border);">
            <option value="name">Name A-Z</option>
            <option value="region">Region</option>
            <option value="type">Type</option>
          </select>
        </label>
      </div>

      <div id="tacoGrid" class="grid" aria-label="Taco catalog">
        <!-- Taco cards inserted here -->
      </div>
    </section>

    <section id="ingredients" aria-labelledby="ingredients-title">
      <h2 id="ingredients-title">Ingredients</h2>
      <p class="section-intro">A quick overview of commonly used ingredients across these tacos.</p>
      <div id="ingredientList" class="grid" style="grid-template-columns: repeat(auto-fill, minmax(120px, 1fr)); gap:.75rem;">
        <!-- Generated pills -->
      </div>
    </section>

    <section id="gallery" aria-labelledby="gallery-title">
      <h2 id="gallery-title">Gallery</h2>
      <p class="section-intro">Preview tiles of tacos. Click to view in lightbox.</p>
      <div id="galleryGrid" class="grid gallery-grid" aria-label="Gallery thumbnails" style="margin-bottom:12px;">
        <!-- Thumbnails populated by JS -->
      </div>
    </section>

    <section id="about" aria-labelledby="about-title">
      <h2 id="about-title">About</h2>
      <p style="max-width:720px; color:var(--muted);">
        TacoWebsite is a lightweight, accessible, data-driven catalog of popular tacos. Built with semantic HTML,
        responsive design, and modern UI interactions for a delightful browsing experience.
      </p>
    </section>
  </main>

  <footer aria-label="Site footer">
    <div class="container">
      <p style="margin:0 0 6px;">© <span id="year"></span> TacoWebsite. All rights reserved.</p>
    </div>
  </footer>

  <!-- Lightbox -->
  <div id="lightbox" class="lightbox" role="dialog" aria-label="Image viewer" aria-hidden="true" style="pointer-events:auto;">
    <div class="lb-content" role="document" aria-label="Lightbox content" style="max-width: 90vw;">
      <button class="lb-close" aria-label="Close lightbox" id="lbClose">✕</button>
      <img id="lb-image" class="lb-image" src="" alt="" />
      <div id="lb-caption" class="lb-caption" aria-live="polite"></div>
      <div class="lb-controls" style="gap:.5rem; align-items:center; justify-content: space-between; padding:0 .4rem;">
        <button id="lbPrev" class="lb-btn" aria-label="Previous image" style="opacity:.9;">Prev</button>
        <div style="display:flex; align-items:center; gap:.5rem;">
          <span id="lbCounter" aria-live="polite" style="color:#fff; font-size:.9rem;"></span>
        </div>
        <button id="lbNext" class="lb-btn" aria-label="Next image" style="opacity:.9;">Next</button>
      </div>
    </div>
  </div>

  <script>
    // Data: taco catalog (SVG derived images)
    (function(){
      function makeSVG(label, color){
        const svg = `
<svg xmlns="http://www.w3.org/2000/svg" width="800" height="500" viewBox="0 0 800 500">
  <defs>
    <linearGradient id="shell" x1="0" y1="0" x2="0" y2="1">
      <stop stop-color="#f6d07a" offset="0"/>
      <stop stop-color="#e6b861" offset="1"/>
    </linearGradient>
  </defs>
  <path d="M40,360 Q400,60 760,360 L740,420 Q400,460 60,420 Z" fill="url(#shell)"/>
  <ellipse cx="400" cy="360" rx="320" ry="60" fill="#e5b36a" opacity="0.25"/>
  <rect x="260" y="210" width="280" height="120" rx="18" fill="${color}" />
  <circle cx="330" cy="235" r="12" fill="#ffd9a8" opacity="0.95"/>
  <circle cx="360" cy="230" r="9" fill="#ffd9a8" opacity="0.9"/>
  <text x="50%" y="480" text-anchor="middle" font-family="Verdana" font-size="28" fill="#fff" opacity="0.6">${label}</text>
</svg>`;
        return 'data:image/svg+xml;utf8,' + encodeURIComponent(svg);
      }

      // Catalog data with multiple images per taco
      window.TACOS = [
        {
          id: 'al-pastor',
          type: 'Al Pastor',
          region: 'Puebla',
          description: 'Pork marinated with adobo and pineapple, served on a warm corn tortilla with onion and cilantro.',
          ingredients: ['Pork','Adobo','Pineapple','Onion','Cilantro','Lime'],
          images: [makeSVG('Al Pastor 1', '#e6762e'), makeSVG('Al Pastor 2', '#d46b1f')]
        },
        {
          id: 'carne-asada',
          type: 'Carne Asada',
          region: 'Sonora',
          description: 'Grilled beef steak with onion, cilantro, and a squeeze of lime on a corn tortilla.',
          ingredients: ['Beef','Lime','Onion','Cilantro','Salsa'],
          images: [makeSVG('Carne Asada 1', '#8b5e3c'), makeSVG('Carne Asada 2', '#6b4a2b')]
        },
        {
          id: 'carnitas',
          type: 'Carnitas',
          region: 'Michoacán',
          description: 'Slow-fried pork shoulder with crisp edges, finished with onion and cilantro.',
          ingredients: ['Pork','Lard','Onion','Cilantro'],
          images: [makeSVG('Carnitas 1', '#c07a2a'), makeSVG('Carnitas 2', '#a05a1f')]
        },
        {
          id: 'barbacoa',
          type: 'Barbacoa',
          region: 'Hidalgo',
          description: 'Slow-cooked lamb or beef in spices; tender, deeply flavorful.',
          ingredients: ['Beef','Lamb','Onion','Cilantro'],
          images: [makeSVG('Barbacoa 1', '#a65e2e'), makeSVG('Barbacoa 2', '#8a4e22')]
        },
        {
          id: 'tuna-mex',
          type: 'Baja Fish',
          region: 'Baja California',
          description: 'Crispy battered fish with slaw and crema; a bright coastal taco.',
          ingredients: ['Fish','Cabbage','Crema','Lime'],
          images: [makeSVG('Baja Fish 1', '#2b9bdc'), makeSVG('Baja Fish 2', '#1a6ea8')]
        },
        {
          id: 'vegetal',
          type: 'Vegetarian',
          region: 'Oaxaca',
          description: 'Grilled veggies and beans on a tortilla with fresh salsa and queso fresco.',
          ingredients: ['Corn','Beans','Bell Peppers','Cheese'],
          images: [makeSVG('Vegetarian 1', '#4caf50'), makeSVG('Vegetarian 2', '#2e7d32')]
        },
        {
          id: 'cochinita',
          type: 'Puerco Adobado',
          region: 'Yucatán',
          description: 'Shredded pork in achiote marinade, with pickled onion and cilantro.',
          ingredients: ['Pork','Achiote','Onion','Cilantro'],
          images: [makeSVG('Cochinita 1', '#d84315'), makeSVG('Cochinita 2', '#bf360c')]
        },
        {
          id: 'guisado',
          type: 'Guisado Taco',
          region: 'Quintana Roo',
          description: 'A comforting mix of stewed meat and vegetables; versatile and hearty.',
          ingredients: ['Beef','Tomato','Potato','Onion'],
          images: [makeSVG('Guisado 1', '#795548'), makeSVG('Guisado 2', '#5d4037')]
        }
      ];
      window.TACOS_DATA = window.TACOS;
    })();
  </script>

  <script>
    (function(){
      const tacos = window.TACOS_DATA || [];
      const grid = document.getElementById('tacoGrid');
      const searchInput = document.getElementById('search');
      const typeFilter = document.getElementById('typeFilter');
      const regionFilter = document.getElementById('regionFilter');
      const ingredientFilter = document.getElementById('ingredientFilter');
      const galleryGrid = document.getElementById('galleryGrid');
      const ingredientList = document.getElementById('ingredientList');
      const lightbox = document.getElementById('lightbox');
      const lbImage = document.getElementById('lb-image');
      const lbCaption = document.getElementById('lb-caption');
      const lbClose = document.getElementById('lbClose');
      const yearEl = document.getElementById('year');
      const themeToggle = document.getElementById('themeToggle');
      const showFavs = document.getElementById('showFavs');
      const sortSel = document.getElementById('sortSel');

      // year
      yearEl.textContent = new Date().getFullYear();

      // Local storage for favorites
      const FAV_KEY = 'tacoFavorites';
      function getFavs(){ try { return JSON.parse(localStorage.getItem(FAV_KEY) || '[]'); } catch{ return []; } }
      function setFavs(ids){ localStorage.setItem(FAV_KEY, JSON.stringify(ids)); }

      // Build filter data
      const types = ['All', ...Array.from(new Set(tacos.map(t => t.type)))].sort((a,b)=> a==='All' ? -1 : b==='All' ? 1 : a.localeCompare(b));
      const regions = ['All', ...Array.from(new Set(tacos.map(t => t.region)))].sort((a,b)=> a==='All'? -1 : b==='All'? 1 : a.localeCompare(b));

      // ingredients are unique across tacos
      const allIngredients = Array.from(new Set(tacos.flatMap(t => t.ingredients))).sort();
      const ingredientsForFilter = ['All', ...allIngredients].sort((a,b)=> a==='All' ? -1 : b==='All' ? 1 : a.localeCompare(b));

      // Populate selects
      function populate(select, arr){
        select.innerHTML = '';
        arr.forEach(v => {
          const opt = document.createElement('option');
          opt.value = v;
          opt.textContent = v;
          select.appendChild(opt);
        });
      }
      populate(typeFilter, types);
      populate(regionFilter, regions);
      populate(ingredientFilter, ingredientsForFilter);

      // Lightbox state
      // Flatten gallery images across tacos
      const galleryImages = [];
      tacos.forEach((taco, ti) => {
        taco.images.forEach((src, idx) => {
          galleryImages.push({
            src,
            caption: `${taco.type} (${idx+1} of ${taco.images.length}) — ${taco.region}`,
            tacoIndex: ti,
            imageIndex: idx
          });
        });
      });
      let currentIndex = 0;

      function openLightbox(index){
        currentIndex = index;
        lbImage.src = galleryImages[currentIndex].src;
        lbImage.alt = galleryImages[currentIndex].caption;
        lbCaption.textContent = galleryImages[currentIndex].caption;
        lightbox.classList.add('is-open');
        lightbox.setAttribute('aria-hidden','false');
        updateCounter();
      }
      function closeLightbox(){
        lightbox.classList.remove('is-open');
        lightbox.setAttribute('aria-hidden','true');
        lbImage.src = '';
        lbCaption.textContent = '';
      }
      function showPrev(){
        currentIndex = (currentIndex - 1 + galleryImages.length) % galleryImages.length;
        openAtCurrent();
      }
      function showNext(){
        currentIndex = (currentIndex + 1) % galleryImages.length;
        openAtCurrent();
      }
      function openAtCurrent(){
        lbImage.src = galleryImages[currentIndex].src;
        lbImage.alt = galleryImages[currentIndex].caption;
        lbCaption.textContent = galleryImages[currentIndex].caption;
        updateCounter();
      }
      function updateCounter(){
        document.getElementById('lbCounter').textContent = (currentIndex + 1) + ' / ' + galleryImages.length;
      }

      lbClose.addEventListener('click', closeLightbox);
      document.getElementById('lbPrev').addEventListener('click', showPrev);
      document.getElementById('lbNext').addEventListener('click', showNext);
      lightbox.addEventListener('click', (e) => { if (e.target === lightbox) closeLightbox(); });
      document.addEventListener('keydown', (e) => {
        if (lightbox.classList.contains('is-open')) {
          if (e.key === 'Escape') closeLightbox();
          if (e.key === 'ArrowLeft') showPrev();
          if (e.key === 'ArrowRight') showNext();
        }
      });

      // Render card
      function createCard(taco){
        const article = document.createElement('article');
        article.className = 'card';
        article.setAttribute('aria-label', taco.type + ' taco');

        // image and favorite button
        const fig = document.createElement('figure');
        const img = document.createElement('img');
        img.src = taco.images[0];
        img.alt = 'Illustration of ' + taco.type + ' taco';
        img.loading = 'lazy';
        fig.appendChild(img);

        // Favorite button
        const favBtn = document.createElement('button');
        favBtn.className = 'favBtn';
        favBtn.setAttribute('aria-label', 'Toggle favorite');
        const favs = getFavs();
        const isFav = favs.includes(taco.id);
        if (isFav) favBtn.classList.add('active');
        favBtn.innerHTML = isFav ? '♥' : '♡';
        favBtn.addEventListener('click', (e) => {
          e.stopPropagation();
          const list = getFavs();
          const idx = list.indexOf(taco.id);
          if (idx >= 0){
            list.splice(idx,1);
            favBtn.classList.remove('active');
            favBtn.innerHTML = '♡';
          } else {
            list.push(taco.id);
            favBtn.classList.add('active');
            favBtn.innerHTML = '♥';
          }
          setFavs(list);
          // If showing favorites, re-filter
          if (showFavs && showFavs.checked){
            filterTacos();
          }
        });
        article.appendChild(fig);
        article.appendChild(favBtn);

        // content
        const content = document.createElement('div');
        content.className = 'card-content';
        const h3 = document.createElement('h3');
        h3.textContent = taco.type;
        const desc = document.createElement('p');
        desc.className = 'desc';
        desc.textContent = taco.description;
        const meta = document.createElement('p');
        meta.className = 'meta';
        const badgeRegion = document.createElement('span');
        badgeRegion.className = 'badge';
        badgeRegion.textContent = taco.region;
        badgeRegion.setAttribute('aria-label', 'Region: ' + taco.region);
        const badgeType = document.createElement('span');
        badgeType.className = 'badge';
        badgeType.textContent = taco.type;
        badgeType.setAttribute('aria-label', 'Type: ' + taco.type);
        meta.appendChild(badgeRegion);
        meta.appendChild(badgeType);
        const ingr = document.createElement('p');
        ingr.className = 'ingredients';
        ingr.textContent = 'Key ingredients: ' + taco.ingredients.join(', ');

        // quick view button
        const btn = document.createElement('button');
        btn.className = 'btn';
        btn.textContent = 'View';
        btn.setAttribute('aria-label', 'Open lightbox for ' + taco.type);
        btn.addEventListener('click', () => {
          // Open lightbox at first image of this taco
          const firstIndex = galleryImages.findIndex(g => g.tacoIndex === tacos.indexOf(taco) && g.imageIndex === 0);
          openLightbox(firstIndex >= 0 ? firstIndex : 0);
        });

        content.appendChild(h3);
        content.appendChild(desc);
        content.appendChild(meta);
        content.appendChild(ingr);
        content.appendChild(btn);
        article.appendChild(content);

        // hover accent line
        const bart = document.createElement('div');
        bart.style.height = '2px';
        bart.style.background = 'linear-gradient(90deg, transparent, rgba(0,0,0,.15), transparent)';
        bart.style.width = '100%';
        bart.style.position = 'absolute';
        bart.style.bottom = '0';
        bart.style.left = '0';
        bart.style.opacity = '0';
        bart.style.transition = 'opacity .25s ease';
        article.appendChild(bart);
        article.addEventListener('mouseenter', () => { bart.style.opacity = '1'; });
        article.addEventListener('mouseleave', () => { bart.style.opacity = '0'; });

        return article;
      }

      function renderGrid(items){
        grid.innerHTML = '';
        if (!items.length){
          const empty = document.createElement('p');
          empty.textContent = 'No tacos match your filters. Try adjusting your search or filters.';
          grid.appendChild(empty);
          return;
        }
        items.forEach(t => grid.appendChild(createCard(t)));
      }

      // gallery rendering
      function renderGallery(){
        galleryGrid.innerHTML = '';
        tacos.forEach((t) => {
          t.images.forEach((src, idx) => {
            const wrap = document.createElement('div');
            wrap.className = 'thumb';
            const img = document.createElement('img');
            img.src = src;
            img.alt = 'Gallery image: ' + t.type;
            img.loading = 'lazy';
            img.style.cursor = 'pointer';
            img.addEventListener('click', () => {
              // find index in flattened gallery
              const flatIdx = galleryImages.findIndex(g => g.tacoIndex === tacos.indexOf(t) && g.imageIndex === idx);
              if (flatIdx >= 0) openLightbox(flatIdx);
            });
            wrap.appendChild(img);
            galleryGrid.appendChild(wrap);
          });
        });
      }

      // Ingredient pills
      function renderIngredientsTiles(){
        ingredientList.innerHTML = '';
        const uniq = Array.from(new Set(tacos.flatMap(t => t.ingredients))).sort();
        uniq.forEach(ing => {
          const pill = document.createElement('span');
          pill.className = 'badge';
          pill.style.display = 'inline-flex';
          pill.style.alignItems = 'center';
          pill.style.justifyContent = 'center';
          pill.style.padding = '6px 10px';
          pill.textContent = ing;
          pill.setAttribute('aria-label', 'Ingredient: ' + ing);
          ingredientList.appendChild(pill);
        });
      }

      // Build flattened galleryImages
      function buildGalleryIndex(){
        galleryImages.length = 0;
        tacos.forEach((taco, ti) => {
          taco.images.forEach((src, idx) => {
            galleryImages.push({ src, caption: `${taco.type} — ${idx+1}`, tacoIndex: ti, imageIndex: idx });
          });
        });
      }

      // Filtering logic
      const galleryImages = []; // runtime
      function filterTacos(){
        const q = (searchInput.value || '').toLowerCase().trim();
        const t = typeFilter.value;
        const r = regionFilter.value;
        const ing = ingredientFilter.value;
        const favOnly = showFavs && showFavs.checked;
        const favList = getFavs();

        const results = tacos.filter(tc => {
          const hay = (tc.type + ' ' + tc.description + ' ' + tc.ingredients.join(' ')).toLowerCase();
          const inSearch = !q || hay.includes(q);
          const inType = t === 'All' || tc.type === t;
          const inRegion = r === 'All' || tc.region === r;
          const inIng = ing === 'All' || tc.ingredients.includes(ing);
          const isFav = !favOnly || favList.includes(tc.id);
          return inSearch && inType && inRegion && inIng && isFav;
        });

        renderGrid(results);
      }

      // Init event wiring
      function initEventWiring(){
        searchInput.addEventListener('input', filterTacos);
        typeFilter.addEventListener('change', filterTacos);
        regionFilter.addEventListener('change', filterTacos);
        ingredientFilter.addEventListener('change', filterTacos);
        showFavs.addEventListener('change', filterTacos);
        sortSel.addEventListener('change', () => {
          // quick resort
          const mode = sortSel.value;
          tacos.sort((a,b) => {
            if (mode === 'name') return a.type.localeCompare(b.type);
            if (mode === 'region') return a.region.localeCompare(b.region);
            if (mode === 'type') return a.type.localeCompare(b.type);
            return 0;
          });
          // re-render currently filtered list
          filterTacos();
        });
      }

      // Theme toggle
      function initTheme(){
        // apply saved theme if any
        const saved = localStorage.getItem('tacoTheme');
        if (saved === 'dark') document.body.classList.add('dark');
        themeToggle.textContent = document.body.classList.contains('dark') ? '☀️' : '🌙';
        themeToggle.addEventListener('click', () => {
          document.body.classList.toggle('dark');
          const on = document.body.classList.contains('dark');
          themeToggle.textContent = on ? '☀️' : '🌙';
          localStorage.setItem('tacoTheme', on ? 'dark' : 'light');
        });
      }

      // Initialize
      // Build initial data
      // Flatten type/region/ingredient selects
      function initFilters(){
        // add "All" options already included
        // add a quick helper to show favorites by default if any
        // Add global "All" as default; already done
      }

      // Create initial UI
      buildGalleryIndex();
      renderGallery();
      renderIngredientsTiles();
      renderGrid(tacos);

      initEventWiring();
      initTheme();
      initFilters();

      // initial grid should be influenced by favorites if any are set and toggled
      // ensure favorites are reflected on first render
      filterTacos();

      // expose a small API for external use (if needed)
      window.tacoWebsite = {
        toggleFavorite: function(id){
          const list = getFavs();
          const idx = list.indexOf(id);
          if (idx >= 0) list.splice(idx,1);
          else list.push(id);
          setFavs(list);
        }
        ,
        openLightboxByIndex: openLightbox
      };
    })();
  </script>
</body>
</html>