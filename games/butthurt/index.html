<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Keep the Shape Standing</title>
    <style>
        /* ... (same styles as before) ... */
    </style>
</head>
<body>
    <div id="game-container">
        <div id="shape"></div>
        <div id="level">Level: 1 - Luminous Line</div>
        <div id="game-over">Game Over!</div>
        <div id="level-complete">Level Complete!</div>
        <div class="key-buttons">
            <!-- Key buttons will be dynamically generated -->
        </div>
    </div>

    <script>
        /* ... (same variables and functions as before) ... */

        document.addEventListener('keydown', e => {
            const key = e.key.toUpperCase();
            const keyButtons = document.querySelectorAll('.key-button');
            keyButtons.forEach(button => {
                if (button.getAttribute('data-key') === key) {
                    button.classList.add('pressed');
                }
            });
            e.preventDefault(); // Prevent default behavior to allow key repeat
        });

        document.addEventListener('keyup', e => {
            const key = e.key.toUpperCase();
            const keyButtons = document.querySelectorAll('.key-button');
            keyButtons.forEach(button => {
                if (button.getAttribute('data-key') === key) {
                    button.classList.remove('pressed');
                }
            });
        });

        // Add key repeat support
        const keyRepeatCodes = {};
        const findKeyRepeatCode = (e) => {
            if (!keyRepeatCodes[e.keyCode]) {
                keyRepeatCodes[e.keyCode] = (new Date()).getTime();
            }
            return keyRepeatCodes[e.keyCode];
        };

        document.addEventListener('keydown', e => {
            if (e.repeat) {
                const key = e.key.toUpperCase();
                const keyButtons = document.querySelectorAll('.key-button');
                keyButtons.forEach(button => {
                    if (button.getAttribute('data-key') === key) {
                        button.classList.add('pressed');
                    }
                });
            }
        });

        document.addEventListener('keypress', e => {
            const key = e.key.toUpperCase();
            const keyButtons = document.querySelectorAll('.key-button');
            keyButtons.forEach(button => {
                if (button.getAttribute('data-key') === key) {
                    button.classList.add('pressed');
                }
            });

            // Remove keys that haven't been pressed for a while
            Object.keys(keyRepeatCodes).forEach(code => {
                if ((new Date()).getTime() - findKeyRepeatCode(e) > 500) {
                    delete keyRepeatCodes[code];
                }
            });
        });

        document.addEventListener('keyup', e => {
            delete keyRepeatCodes[e.keyCode];
        });

        /* ... (rest of the code remains the same) ... */
    </script>
</body>
</html>
