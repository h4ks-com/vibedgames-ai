<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Creature Quest</title>
  <style>
    body {
      display: flex;
      flex-direction: column;
      margin: 0;
      font-family: Arial, sans-serif;
      height: 100vh;
    }
    header {
      background-color: #4CAF50;
      color: white;
      padding: 10px;
      text-align: center;
    }
    main {
      display: flex;
      flex: 1;
      height: calc(100vh - 60px);
    }
    #game-container {
      flex: 3;
      padding: 10px;
      background-color: #e0e0e0;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    #mapCanvas {
      border: 2px solid #333;
      background-color: #b0e0e6;
    }
    #sidebar {
      flex: 1;
      padding: 10px;
      background-color: #f0f0f0;
      display: flex;
      flex-direction: column;
      overflow-y: auto;
    }
    #sidebar h2 {
      margin-top: 0;
    }
    #collection {
      list-style: none;
      padding: 0;
      margin: 0 0 10px 0;
    }
    #collection li {
      padding: 4px;
      background: #fff;
      margin-bottom: 4px;
      border-radius: 4px;
    }
    #messages {
      min-height: 40px;
      padding: 8px;
      background: #fff;
      border: 1px solid #ccc;
      margin-bottom: 10px;
      white-space: pre-line;
    }
    #actions button {
      margin: 4px 0;
      padding: 8px;
      width: 100%;
      font-size: 1em;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <header>
    <h1>Creature Quest</h1>
  </header>
  <main>
    <div id="game-container">
      <!-- Map and exploration view -->
      <canvas id="mapCanvas" width="600" height="400"></canvas>
    </div>
    <aside id="sidebar">
      <h2>Creatures</h2>
      <ul id="collection"></ul>
      <h2>Messages</h2>
      <div id="messages"></div>
      <div id="actions">
        <button id="moveBtn">Move</button>
        <button id="fightBtn">Fight</button>
        <button id="captureBtn">Capture</button>
        <button id="runBtn">Run</button>
      </div>
    </aside>
  </main>
  <script>
    // Basic setup for exploration and capturing
    const canvas = document.getElementById('mapCanvas');
    const ctx = canvas.getContext('2d');

    const player = {
      x: 0,
      y: 0,
      creatures: [],
    };

    const creatures = [
      { name: 'Flameling', hp: 20, maxHp: 20, sprite: 'ðŸ”¥' },
      { name: 'Aquadile', hp: 25, maxHp: 25, sprite: 'ðŸ’§' },
    ];

    let currentCreature = null;
    let inBattle = false;
    let playerCreatureSelected = null;

    // Drawing the map grid with player
    const tileSize = 50;
    const mapWidth = Math.floor(canvas.width / tileSize);
    const mapHeight = Math.floor(canvas.height / tileSize);

    function drawMap() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      // Draw grid
      ctx.strokeStyle = '#aaa';
      for(let i=0; i<=mapWidth; i++) {
        ctx.beginPath();
        ctx.moveTo(i*tileSize, 0);
        ctx.lineTo(i*tileSize, canvas.height);
        ctx.stroke();
      }
      for(let j=0; j<=mapHeight; j++) {
        ctx.beginPath();
        ctx.moveTo(0, j*tileSize);
        ctx.lineTo(canvas.width, j*tileSize);
        ctx.stroke();
      }
      // Draw player
      ctx.fillStyle = 'blue';
      ctx.fillRect(player.x*tileSize+5, player.y*tileSize+5, tileSize-10, tileSize-10);
    }

    function showMessage(msg) {
      document.getElementById('messages').innerText = msg;
    }

    function updateCollection() {
      const ul = document.getElementById('collection');
      ul.innerHTML = '';
      player.creatures.forEach((c, index) => {
        const li = document.createElement('li');
        li.innerHTML = `<strong>${c.name}</strong> (${c.sprite}) HP: ${c.currentHp}/${c.maxHp}`;
        li.style.cursor = 'pointer';
        li.onclick = () => {
          showMessage(`Selected ${c.name} for battle.`);
          playerCreatureSelected = c;
        };
        ul.appendChild(li);
      });
    }

    function encounterCreature() {
      const creature = creatures[Math.floor(Math.random() * creatures.length)];
      currentCreature = { ...creature, currentHp: creature.hp };
      showMessage(`A wild ${creature.name} appeared! Choose action.`);
    }

    function startBattle() {
      if (!playerCreatureSelected) {
        showMessage('Select one of your creatures for battle.');
        return;
      }
      inBattle = true;
      showBattleUI();
      updateBattleStats();
    }

    function showBattleUI() {
      // Simplify: disable move, enable fight, capture, run
      document.getElementById('moveBtn').disabled = true;
      document.getElementById('fightBtn').disabled = false;
      document.getElementById('captureBtn').disabled = false;
      document.getElementById('runBtn').disabled = false;
    }

    function hideBattleUI() {
      document.getElementById('moveBtn').disabled = false;
      document.getElementById('fightBtn').disabled = true;
      document.getElementById('captureBtn').disabled = true;
      document.getElementById('runBtn').disabled = true;
    }

    function updateBattleStats() {
      // Display in messages for simplicity
      showMessage(
        `Your ${playerCreatureSelected.name} HP: ${playerCreatureSelected.currentHp}/${playerCreatureSelected.maxHp}\n` + 
        `${currentCreature.name} HP: ${currentCreature.currentHp}/${currentCreature.maxHp}`
      );
    }

    function attack() {
      // Player attack
      const damage = Math.floor(Math.random() * 5) + 3; // random damage
      currentCreature.currentHp -= damage;
      showMessage(`Your ${playerCreatureSelected.name} dealt ${damage} damage!`);
      if (currentCreature.currentHp <= 0) {
        showMessage(`You defeated ${currentCreature.name}!`);
        inBattle = false;
        hideBattleUI();
        currentCreature = null;
        return;
      }
      // Opponent attack
      const damage2 = Math.floor(Math.random() * 4) + 2;
      playerCreatureSelected.currentHp -= damage2;
      showMessage(`${currentCreature.name} attacked back for ${damage2} damage!`);
      if (playerCreatureSelected.currentHp <= 0) {
        showMessage(`${playerCreatureSelected.name} fainted! Choose another creature or run.`);
        // Optional: auto switch or end
      }
      updateBattleStats();
    }

    function tryCapture() {
      const successChance = (currentCreature.currentHp / currentCreature.maxHp) * 0.8 + 0.2; // less HP, higher chance
      if (Math.random() < successChance) {
        // Capture successful
        const captured = { ...currentCreature };
        if (!captured.currentHp) captured.currentHp = captured.hp;
        player.creatures.push(captured);
        updateCollection();
        showMessage(`Successfully captured ${captured.name}!`);
        inBattle = false;
        hideBattleUI();
        currentCreature = null;
      } else {
        showMessage(`${currentCreature.name} broke free!`);
        // Opponent attacks
        const damage = Math.floor(Math.random() * 4) + 2;
        playerCreatureSelected.currentHp -= damage;
        showMessage(`The creature attacked back for ${damage} damage!`);
        if (playerCreatureSelected.currentHp <= 0) {
          showMessage(`${playerCreatureSelected.name} fainted!`);
        }
        updateBattleStats();
      }
    }

    // Movement
    document.getElementById('moveBtn').addEventListener('click', () => {
      // Simple random move
      const dir = Math.floor(Math.random() * 4);
      if (dir === 0 && player.x > 0) player.x--;
      else if (dir === 1 && player.x < mapWidth -1) player.x++;
      else if (dir === 2 && player.y > 0) player.y--;
      else if (dir === 3 && player.y < mapHeight -1) player.y++;
      drawMap();
      showMessage(`Moved to (${player.x}, ${player.y})`);
      // Random encounter
      if (Math.random() < 0.3) {
        encounterCreature();
        showMessage(`A wild ${currentCreature.name} appeared! Choose an action.`);
      }
    });

    // Battle actions
    document.getElementById('fightBtn').addEventListener('click', () => {
      if (inBattle) {
        attack();
      }
    });

    document.getElementById('captureBtn').addEventListener('click', () => {
      if (inBattle) {
        tryCapture();
      }
    });

    document.getElementById('runBtn').addEventListener('click', () => {
      if (inBattle) {
        showMessage('You ran away.');
        inBattle = false;
        hideBattleUI();
        currentCreature = null;
      }
    });

    // Initialize
    drawMap();
    updateCollection();

  </script>
</body>
</html>