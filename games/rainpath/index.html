<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Raindrops falling in A-Frame</title>
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <style>
        body {
            margin: 0;
            overflow: hidden;
        }
        #instructions {
            position: absolute;
            top: 20px;
            left: 20px;
            color: white;
            font-family: Arial, sans-serif;
            z-index: 10;
        }
    </style>
</head>
<body>
    <div id="instructions">Click to start the raindrops!</div>
    <a-scene>
        <a-entity light="type: ambient; color: #888"></a-entity>
        <a-entity light="type: directional; color: #fff; intensity: 0.5; position: 0 1 1"></a-entity>
        <a-entity camera look-controls position="0 1.6 0"></a-entity>
        <a-entity id="ground" geometry="primitive: plane; width: 10; height: 10" material="color: #7B9A7E" rotation="-90 0 0" position="0 0 0"></a-entity>
    </a-scene>

    <script>
        const raindrops = 10;
        const drops = [];

        function createRaindrop(x, z) {
            const drop = document.createElement('a-box');
            drop.setAttribute('depth', 0.1);
            drop.setAttribute('height', 0.1);
            drop.setAttribute('width', 0.1);
            drop.setAttribute('color', '#00f');
            drop.setAttribute('position', `${x} 5 ${z}`);
            document.querySelector('a-scene').appendChild(drop);
            drops.push(drop);
        }

        function randomPolynomial(t) {
            // A random polynomial equation of the form a*t^3 + b*t^2 + c*t + d
            const a = Math.random();
            const b = Math.random() * -2; // To let z movement go downward
            const c = Math.random() * -3;
            const d = Math.random() * 5; // To vary the initial position
            return a * Math.pow(t, 3) + b * Math.pow(t, 2) + c * t + d;
        }

        function dropRaindrops() {
            const timeInterval = 1000; // 1 second per step
            let currentTime = 0;

            drops.forEach(drop => {
                const initialX = drop.getAttribute('position').x;
                const initialZ = drop.getAttribute('position').z;

                const interval = setInterval(() => {
                    currentTime++;
                    const newX = initialX + randomPolynomial(currentTime * 0.1); // Scale down time for smoother transitions
                    const newZ = initialZ + randomPolynomial(currentTime * 0.1);
                    drop.setAttribute('position', {x: newX, y: drop.getAttribute('position').y - 0.1, z: newZ});

                    if (drop.getAttribute('position').y <= 0) {
                        clearInterval(interval); // Stop when the drop reaches the ground
                        drop.setAttribute('position', {x: newX, y: 0, z: newZ}); // Ensure final position is at ground level
                    }
                }, timeInterval);
            });
        }

        document.getElementById('instructions').addEventListener('click', function() {
            for (let i = 0; i < raindrops; i++) {
                const x = (Math.random() * 10) - 5; // Random x position within [-5, 5]
                const z = (Math.random() * 10) - 5; // Random z position within [-5, 5]
                createRaindrop(x, z);
            }
            dropRaindrops();
            this.style.display = 'none'; // Hide instructions after starting rain
        });
    </script>
</body>
</html>
