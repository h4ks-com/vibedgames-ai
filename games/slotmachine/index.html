<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Slot Machine Simulator</title>
    <style>
        body {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            font-family: 'Arial', sans-serif;
            background-color: #222;
            color: #fff;
        }
        #slots {
            display: flex;
            justify-content: center;
            font-size: 5rem;
            opacity: 0;
            transition: opacity 1s;
        }
        .result {
            margin-top: 20px;
            font-size: 1.5rem;
            color: #f39c12;
        }
        #spin {
            margin-top: 20px;
            padding: 10px 20px;
            font-size: 1.2rem;
            cursor: pointer;
            background-color: #f39c12;
            border: none;
            border-radius: 5px;
            color: white;
        }
        #spin:hover {
            background-color: #e67e22;
        }
    </style>
</head>
<body>

<div id="slots"></div>
<div class="result" id="result"></div>
<button id="spin">Spin Again</button>

<script>
    const symbols = ["üçí", "üçã", "üçâ", "‚≠ê", "üîî", "üçá"];
    const slotsDiv = document.getElementById('slots');
    const resultDiv = document.getElementById('result');
    let ws;

    function spin() {
        let slots = [];
        for (let i = 0; i < 3; i++) {
            const randomSymbol = symbols[Math.floor(Math.random() * symbols.length)];
            slots.push(randomSymbol);
        }
        slotsDiv.innerHTML = slots.join(' ');
        slotsDiv.style.opacity = 1; // Fade in
    }

    function connectWebSocket() {
        const randomNick = `casino_${Math.floor(Math.random() * 1000)}`;
        ws = new WebSocket('wss://irc.h4ks.com:8097');

        ws.onopen = () => {
            console.log('Connected to IRC');
            ws.send(`NICK ${randomNick}`);
            ws.send(`USER ${randomNick} 0 * :WebSocket IRChat`);
        };

        ws.onmessage = (event) => {
            console.log('Message from server:', event.data);
            handleServerMessage(event.data);
        };

        ws.onclose = () => {
            console.log('Disconnected from IRC');
        };

        ws.onerror = (error) => {
            console.error('WebSocket Error:', error);
        };
    }

    function handleServerMessage(data) {
        // Check for IRC status 422
        if (/^:.* 422/.test(data)) {
            console.log("Received status 422, sending .slot to _cloudbot");
            sendSlotCommand();
        }

        // Continue parsing for results messages if needed
        parseResponse(data);
    }

    function sendSlotCommand() {
        if (ws) {
            ws.send('PRIVMSG _cloudbot : .slot');
        }
    }

    function parseResponse(data) {
        // Example response: "(username) üçâ ‚≠ê | üçã ‚≠ê | üçâ ‚≠ê Almost there! Keep trying! You lost {bet:,} beans"
        const regex = /^\((.*?)\) (.*?) (.*?) \| (.*?) (.*?) Almost there! Keep trying! You lost (\{[^}]+\}) beans$/;
        const match = data.match(regex);
        if (match) {
            const username = match[1];
            const slots = match.slice(2, 5).join(' | '); // Slots are from match[2] to match[4]
            const resultText = match[5] + ' Almost there! Keep trying! You lost ' + match[6] + ' beans';

            slotsDiv.innerHTML = `${username} ${slots}`;
            resultDiv.innerHTML = resultText;
            slotsDiv.style.fontSize = '3rem'; // Adjust sizes if necessary
        }
    }

    window.onload = () => {
        spin();
        connectWebSocket();
    };

    document.getElementById('spin').addEventListener('click', () => {
        slotsDiv.style.opacity = 0; // Fade out
        setTimeout(() => {
            spin();
        }, 1000); // Wait for fade out before spinning again
    });
</script>

</body>
</html>
