// Initialize canvas and context
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');

// Game settings
const GAME_WIDTH = 800;
const GAME_HEIGHT = 600;
const PLAYER_WIDTH = 50;
const PLAYER_HEIGHT = 50;
const OBJECT_SIZE = 30;
const SPAWN_INTERVAL = 1500; // milliseconds
const TOTAL_OBJECTS = 50;

// Player properties
let player = {
  x: GAME_WIDTH / 2 - PLAYER_WIDTH / 2,
  y: GAME_HEIGHT - PLAYER_HEIGHT - 10,
  width: PLAYER_WIDTH,
  height: PLAYER_HEIGHT,
  speed: 5,
  dx: 0
};

// Falling objects
let objects = [];
let lastSpawnTime = 0;
let score = 0;
let collectedObjects = 0;
let gameOver = false;

// Key controls
let keys = {};

// Initialize game
function init() {
  canvas.width = GAME_WIDTH;
  canvas.height = GAME_HEIGHT;
  document.getElementById('scoreBoard').innerText = 'Score: ' + score;
  document.getElementById('gameOver').innerText = ''; 
  window.requestAnimationFrame(gameLoop);
}

// Event listeners for controls
window.addEventListener('keydown', (e) => { keys[e.key] = true; });
window.addEventListener('keyup', (e) => { keys[e.key] = false; });

// Update player position
function updatePlayer() {
  if (keys['ArrowLeft']) { player.dx = -player.speed; }
  else if (keys['ArrowRight']) { player.dx = player.speed; }
  else { player.dx = 0; }
  player.x += player.dx;
  // Boundary checks
  if (player.x < 0) player.x = 0;
  if (player.x + player.width > GAME_WIDTH) player.x = GAME_WIDTH - player.width;
}

// Spawn falling objects
function spawnObject() {
  const x = Math.random() * (GAME_WIDTH - OBJECT_SIZE);
  objects.push({ x: x, y: -OBJECT_SIZE, width: OBJECT_SIZE, height: OBJECT_SIZE });
}

// Update falling objects
function updateObjects(deltaTime) {
  for (let i = objects.length - 1; i >= 0; i--) {
    objects[i].y += 3;
    // Check for collision
    if (isColliding(objects[i], player)) {
      objects.splice(i, 1);
      score++;
      collectedObjects++;
      document.getElementById('scoreBoard').innerText = 'Score: ' + score;
      // Check for game end
      if (collectedObjects >= ${TOTAL_OBJECTS}) {
        endGame();
        return;
      }
    } else if (objects[i].y > GAME_HEIGHT) {
      objects.splice(i, 1);
    }
  }
}

// Check collision
function isColliding(a, b) {
  return (
    a.x < b.x + b.width &&
    a.x + a.width > b.x &&
    a.y < b.y + b.height &&
    a.y + a.height > b.y
  );
}

// Draw functions
function drawPlayer() {
  ctx.fillStyle = 'blue';
  ctx.fillRect(player.x, player.y, player.width, player.height);
}

function drawObjects() {
  ctx.fillStyle = 'red';
  for (let obj of objects) {
    ctx.fillRect(obj.x, obj.y, obj.width, obj.height);
  }
}

// End game
function endGame() {
  gameOver = true;
  document.getElementById('gameOver').innerText = 'Congratulations! You collected all objects!';
}

// Game loop
let lastTime = 0;
function gameLoop(timestamp) {
  if (gameOver) return;
  const deltaTime = timestamp - lastTime;
  lastTime = timestamp;
  // Clear canvas
  ctx.clearRect(0, 0, GAME_WIDTH, GAME_HEIGHT);
  // Update
  updatePlayer();
  if (Date.now() - lastSpawnTime > SPAWN_INTERVAL) {
    spawnObject();
    lastSpawnTime = Date.now();
  }
  updateObjects();
  // Draw
  drawPlayer();
  drawObjects();
  window.requestAnimationFrame(gameLoop);
}

// Start game
init();
