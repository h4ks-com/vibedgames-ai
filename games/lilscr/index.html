<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dynamic 4x4 Grid of 3D Lyapunov Fractals</title>
    <style>
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            height: 100vh;
            background-color: black;
            margin: 0;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(32, 32px); /* Each image is 320px wide */
            grid-gap: 5px;
        }



    input {
        width: 70%;
        padding: 4px;
        font-size: 16px;
    }
    .output {
        height: 120px;
        width: 70%;
        padding: 4px;
        color: #FFFFFF;
        background-color: #000000;
        font-size: 16px;
    }
.btn {
  border: none;
  width: 13%;
  color: #0D92F4;
  background-color: #9DBDFF;
  padding: 8px 8px;
  font-size: 16px;
  cursor: pointer;
  display: inline-block;
}
.btn:hover {
  border: none;
  width: 13%;
  color: #F7EF08;
  background-color: #0000FF;
  padding: 8px 8px;
  font-size: 16px;
  cursor: pointer;
  display: inline-block;
}

.success {
  color: green;
}

.success:hover {
  background-color: #04AA6D;
  color: white;
}
        canvas {
            border: 1px solid white;
            cursor: pointer; /* Change cursor to pointer for clickable canvas */
        }
    </style>
</head>
<body>
    
    <div class="grid" id="fractalGrid"></div>


        <a href="{% static 'webapp/img/term2.jpg' %}"><img src="{% static 'webapp/img/term2.jpg' %}" style="padding: 10px; border: 5px solid yellow; float:left" alt="sowhat" width="5%"></a>
    
<script>
fixed_color0="#000000";
fixed_color1="#FF0000";
fixed_color2="#00FF00";
fixed_color3="#0000FF";
fixed_color4="#FF00FF";
fixed_color5="#FFFFFF";
fixed_color6="#FFFF00";
fixed_color7="#00FFFF";
fixed_color8="#FFAAFF";
fixed_color9="#FFAAAA";
fixed_color10="#FF0000";
fixed_color11="#FF0000";
fixed_color12="#FF0000";
fixed_color13="#FF0000";
fixed_color14="#FF0000";
fixed_color15="#FF0000";
</script>

<div class="output" id="output" name="output" placeholder="random"><script>generateRandomLanguage();</script><br><br></div>

<br>UTC
<div id="txt11" style="float:center; padding: 40px"></div>

<div height="20" id="funcs" name="funcs" placeholder="random"></div>
  
<div height="20" id="inscription" name="inscription" placeholder="random"></div>

<br>
<input type="text" id="textInput" name="textInput" placeholder="Type here to run language function" style='border:5px dotted #FFFFFF; color:#66FF66; background-color:#000000;'>

<script>
stringarray= [];

    for (var i = 0; i < 1000; i++) {
stringarray.push(generateRandomLanguage());
    }
  
document.getElementById("textInput").addEventListener("keydown", (event) => changeDown(event));
document.getElementById("textInput").addEventListener("keyup", (event) => changeUp(event));

function changeUp(event) {
changeBackgroundColor();
}

function changeDown(event) {

if (event.key === 'Enter') {
document.getElementById("output").innerHTML+=document.getElementById("textInput").value + "<br>";
document.getElementById("textInput").value="";
changeBackgroundColor();
        console.log('Enter key pressed!');
        // Perform desired actions here
      }

}

function changeBackgroundColor() {
    var randomColor0 = fixed_color0;
    var randomColor1 = fixed_color1;
    var randomColor2 = fixed_color2;
    var randomColor3 = fixed_color3;
    var randomColor4 = fixed_color4;
    var randomColor5 = fixed_color5;
    var randomColor6 = fixed_color6;
    var randomColor7 = fixed_color7;
    var randomColor8 = fixed_color8;
    var randomColor9 = fixed_color9;
    var randomColor10 = fixed_color10;

    var bc = [ randomColor0,
    randomColor1,
    randomColor2,
    randomColor3,
    randomColor4,
    randomColor5 ];

    document.getElementById("funcs").innerHTML = "[F01][F02][F03][F04][F05][F06][F07][F08][F09][F10][F11][F12][F13]";
    document.getElementById("inscription").innerHTML = "";

    for (var i = 0; i < 6; i++) {
    document.getElementById("inscription").innerHTML += "<br>";
    randex = Math.floor(Math.random() * 20)

    document.getElementById("inscription").innerHTML += '<a href="https://www.google.com/search?q=' + stringarray[randex] + '"><input type="button" class="btn" value="View"></a>';
    document.getElementById("inscription").innerHTML += '<span style="color:' + bc[Math.floor(Math.random() * 4 + 1)] + '; background-color:' + bc[Math.floor(Math.random() * 2)] + ';">' + stringarray[randex] + '</span>';
    document.getElementById("inscription").innerHTML += '<a href="https://google.com"><span style="color:yellow; background-color: gray">[expand]</span></a>';
    }

}

function generateRandomColor() {
    var letters = '0123456789ABCDEF';
    var color = '#';

    for (var i = 0; i < 6; i++) {
        color += letters[Math.floor(Math.random() * 16)];
    }
    return color;
}

function generateRandomString() {
    var letters = 'abcdefghijklmnopqrstuvwxyz';
    var gooby = '';

    for (var i = 0; i < 16; i++) {
        gooby += letters[Math.floor(Math.random() * 16)];
    }
    return gooby;
}

function generateRandomSyll() {
    var letters = 'abcdefghijklmnopqrstuvwxyz';
    var gooby = '';

    for (var i = 0; i < (Math.floor(Math.random() * 10)+1); i++) {
    //for (var i = 0; i < 10; i++) {
        gooby += letters[Math.floor(Math.random() * 16)];
        //gooby += "-";
    }
    gooby += "-";

    return gooby;
}

function generateRandomLanguage() {
    var parts = [ generateRandomSyll(),
    generateRandomSyll(),
    generateRandomSyll(),
    generateRandomSyll(),
    generateRandomSyll(),
    generateRandomSyll(),
    generateRandomSyll(),
    generateRandomSyll(),
    generateRandomSyll(),
    generateRandomSyll(),
    generateRandomSyll(),
    generateRandomSyll(),
    generateRandomSyll(),
    generateRandomSyll(),
    generateRandomSyll(),
    generateRandomSyll(),
    generateRandomSyll(),
    generateRandomSyll(),
    generateRandomSyll(),
    generateRandomSyll(),
    generateRandomSyll(),
    generateRandomSyll() ];

    var gooby = '';

    for (var i = 0; i < 1; i++) {
        //gooby += parts[Math.floor(Math.random() * 6)] + "-";
        gooby += parts[Math.floor(Math.random() * 3)];
    }
    return gooby;
}

function draw() {
    var canvas = document.getElementById("canvas");
    var context = canvas.getContext("2d");

    context.clearRect(0, 0, 500, 500);
    showAxes(context);
    context.save();            
    
    plotSine(context, step, 50);
    context.restore();
    
    step += 4;
    window.requestAnimationFrame(draw);
}

function startTime() {
  const today = new Date();
  //const today = new Date(1733513435);

  let h = today.getHours();
  let m = today.getMinutes();
  let s = today.getSeconds();

  m = checkTime(m);
  s = checkTime(s);

  zonetime = today.toLocaleString('en-US', { timeZone: 'UTC' })
  document.getElementById('txt11').innerHTML =  zonetime;
  
newgradient=generateRandomColor();

document.getElementById("textInput").style.border="5px dotted " + newgradient;
document.getElementById("textInput").style.transition="border 0.5s";
setTimeout(startTime, 1000);
}

function checkTime(i) {
  if (i < 10) {i = "0" + i};  // add zero in front of numbers < 10
  return i;
}
</script>
    


    <div class="menudisplay" id="menudisplay"></div>
    <script>
        const cityUrls = [
            "https://en.wikipedia.org/wiki/New_York_City",
            "https://en.wikipedia.org/wiki/London",
            "https://en.wikipedia.org/wiki/Tokyo",
            "https://en.wikipedia.org/wiki/Paris",
            "https://en.wikipedia.org/wiki/Sydney",
            "https://en.wikipedia.org/wiki/Cape_Town",
            "https://en.wikipedia.org/wiki/Berlin",
            "https://en.wikipedia.org/wiki/Moscow",
            "https://en.wikipedia.org/wiki/Rio_de_Janeiro",
            "https://en.wikipedia.org/wiki/Mexico_City",
            "https://en.wikipedia.org/wiki/Sao_Paulo",
            "https://en.wikipedia.org/wiki/Bangkok",
            "https://en.wikipedia.org/wiki/Beijing",
            "https://en.wikipedia.org/wiki/San_Francisco",
            "https://en.wikipedia.org/wiki/Dubai",
            "https://en.wikipedia.org/wiki/Los_Angeles",
            "https://en.wikipedia.org/wiki/New_York_City",
            "https://en.wikipedia.org/wiki/London",
            "https://en.wikipedia.org/wiki/Tokyo",
            "https://en.wikipedia.org/wiki/Paris",
            "https://en.wikipedia.org/wiki/Sydney",
            "https://en.wikipedia.org/wiki/Cape_Town",
            "https://en.wikipedia.org/wiki/Berlin",
            "https://en.wikipedia.org/wiki/Moscow",
            "https://en.wikipedia.org/wiki/Rio_de_Janeiro",
            "https://en.wikipedia.org/wiki/Mexico_City",
            "https://en.wikipedia.org/wiki/Sao_Paulo",
            "https://en.wikipedia.org/wiki/Bangkok",
            "https://en.wikipedia.org/wiki/Beijing",
            "https://en.wikipedia.org/wiki/San_Francisco",
            "https://en.wikipedia.org/wiki/Dubai",
            "https://en.wikipedia.org/wiki/Los_Angeles",
            "https://en.wikipedia.org/wiki/Tokyo",
            "https://en.wikipedia.org/wiki/Paris",
            "https://en.wikipedia.org/wiki/Sydney",
            "https://en.wikipedia.org/wiki/Cape_Town",
            "https://en.wikipedia.org/wiki/Berlin",
            "https://en.wikipedia.org/wiki/Moscow",
            "https://en.wikipedia.org/wiki/Rio_de_Janeiro",
            "https://en.wikipedia.org/wiki/Mexico_City",
            "https://en.wikipedia.org/wiki/Sao_Paulo",
            "https://en.wikipedia.org/wiki/Bangkok",
            "https://en.wikipedia.org/wiki/Beijing",
            "https://en.wikipedia.org/wiki/San_Francisco",
            "https://en.wikipedia.org/wiki/Dubai",
            "https://en.wikipedia.org/wiki/Los_Angeles",
            "https://en.wikipedia.org/wiki/New_York_City",
            "https://en.wikipedia.org/wiki/London",
            "https://en.wikipedia.org/wiki/Tokyo",
            "https://en.wikipedia.org/wiki/Paris",
            "https://en.wikipedia.org/wiki/Sydney",
            "https://en.wikipedia.org/wiki/Cape_Town",
            "https://en.wikipedia.org/wiki/Berlin",
            "https://en.wikipedia.org/wiki/Moscow",
            "https://en.wikipedia.org/wiki/Rio_de_Janeiro",
            "https://en.wikipedia.org/wiki/Mexico_City",
            "https://en.wikipedia.org/wiki/Sao_Paulo",
            "https://en.wikipedia.org/wiki/Bangkok",
            "https://en.wikipedia.org/wiki/Beijing",
            "https://en.wikipedia.org/wiki/San_Francisco",
            "https://en.wikipedia.org/wiki/Dubai",
            "https://en.wikipedia.org/wiki/Los_Angeles",
            "https://en.wikipedia.org/wiki/Tokyo",
            "https://en.wikipedia.org/wiki/Paris",
            "https://en.wikipedia.org/wiki/Sydney",
            "https://en.wikipedia.org/wiki/Cape_Town",
            "https://en.wikipedia.org/wiki/Berlin",
            "https://en.wikipedia.org/wiki/Moscow",
            "https://en.wikipedia.org/wiki/Rio_de_Janeiro",
            "https://en.wikipedia.org/wiki/Mexico_City",
            "https://en.wikipedia.org/wiki/Sao_Paulo",
            "https://en.wikipedia.org/wiki/Bangkok",
            "https://en.wikipedia.org/wiki/Beijing",
            "https://en.wikipedia.org/wiki/San_Francisco",
            "https://en.wikipedia.org/wiki/Dubai",
            "https://en.wikipedia.org/wiki/Los_Angeles",
            "https://en.wikipedia.org/wiki/New_York_City",
            "https://en.wikipedia.org/wiki/London",
            "https://en.wikipedia.org/wiki/Tokyo",
            "https://en.wikipedia.org/wiki/Paris",
            "https://en.wikipedia.org/wiki/Sydney",
            "https://en.wikipedia.org/wiki/Cape_Town",
            "https://en.wikipedia.org/wiki/Berlin",
            "https://en.wikipedia.org/wiki/Moscow",
            "https://en.wikipedia.org/wiki/Rio_de_Janeiro",
            "https://en.wikipedia.org/wiki/Mexico_City",
            "https://en.wikipedia.org/wiki/Sao_Paulo",
            "https://en.wikipedia.org/wiki/Bangkok",
            "https://en.wikipedia.org/wiki/Beijing",
            "https://en.wikipedia.org/wiki/San_Francisco",
            "https://en.wikipedia.org/wiki/Dubai",
            "https://en.wikipedia.org/wiki/Los_Angeles",
            "https://en.wikipedia.org/wiki/Tokyo",
            "https://en.wikipedia.org/wiki/Paris",
            "https://en.wikipedia.org/wiki/Sydney",
            "https://en.wikipedia.org/wiki/Cape_Town",
            "https://en.wikipedia.org/wiki/Berlin",
            "https://en.wikipedia.org/wiki/Moscow",
            "https://en.wikipedia.org/wiki/Rio_de_Janeiro",
            "https://en.wikipedia.org/wiki/Mexico_City",
            "https://en.wikipedia.org/wiki/Sao_Paulo",
            "https://en.wikipedia.org/wiki/Bangkok",
            "https://en.wikipedia.org/wiki/Beijing",
            "https://en.wikipedia.org/wiki/San_Francisco",
            "https://en.wikipedia.org/wiki/Dubai",
            "https://en.wikipedia.org/wiki/Los_Angeles",
            "https://en.wikipedia.org/wiki/New_York_City",
            "https://en.wikipedia.org/wiki/London",
            "https://en.wikipedia.org/wiki/Tokyo",
            "https://en.wikipedia.org/wiki/Paris",
            "https://en.wikipedia.org/wiki/Sydney",
            "https://en.wikipedia.org/wiki/Cape_Town",
            "https://en.wikipedia.org/wiki/Berlin",
            "https://en.wikipedia.org/wiki/Moscow",
            "https://en.wikipedia.org/wiki/Rio_de_Janeiro",
            "https://en.wikipedia.org/wiki/Mexico_City",
            "https://en.wikipedia.org/wiki/Sao_Paulo",
            "https://en.wikipedia.org/wiki/Bangkok",
            "https://en.wikipedia.org/wiki/Beijing",
            "https://en.wikipedia.org/wiki/San_Francisco",
            "https://en.wikipedia.org/wiki/Dubai",
            "https://en.wikipedia.org/wiki/Los_Angeles",
            "https://en.wikipedia.org/wiki/Mexico_City",
            "https://en.wikipedia.org/wiki/Sao_Paulo",
            "https://en.wikipedia.org/wiki/Bangkok",
            "https://en.wikipedia.org/wiki/Beijing",
            "https://en.wikipedia.org/wiki/San_Francisco",
            "https://en.wikipedia.org/wiki/Dubai",
            "https://en.wikipedia.org/wiki/New_York_City",
            "https://en.wikipedia.org/wiki/London",
            "https://en.wikipedia.org/wiki/Tokyo",
            "https://en.wikipedia.org/wiki/Paris",
            "https://en.wikipedia.org/wiki/Sydney",
            "https://en.wikipedia.org/wiki/Cape_Town",
            "https://en.wikipedia.org/wiki/Berlin",
            "https://en.wikipedia.org/wiki/Moscow",
            "https://en.wikipedia.org/wiki/Rio_de_Janeiro",
            "https://en.wikipedia.org/wiki/Mexico_City",
            "https://en.wikipedia.org/wiki/Sao_Paulo",
            "https://en.wikipedia.org/wiki/Bangkok",
            "https://en.wikipedia.org/wiki/Beijing",
            "https://en.wikipedia.org/wiki/San_Francisco",
            "https://en.wikipedia.org/wiki/Dubai",
            "https://en.wikipedia.org/wiki/Los_Angeles",
            "https://en.wikipedia.org/wiki/New_York_City",
            "https://en.wikipedia.org/wiki/London",
            "https://en.wikipedia.org/wiki/Tokyo",
            "https://en.wikipedia.org/wiki/Paris",
            "https://en.wikipedia.org/wiki/Sydney",
            "https://en.wikipedia.org/wiki/Cape_Town",
            "https://en.wikipedia.org/wiki/Berlin",
            "https://en.wikipedia.org/wiki/Moscow",
            "https://en.wikipedia.org/wiki/Rio_de_Janeiro",
            "https://en.wikipedia.org/wiki/Mexico_City",
            "https://en.wikipedia.org/wiki/Sao_Paulo",
            "https://en.wikipedia.org/wiki/Bangkok",
            "https://en.wikipedia.org/wiki/Beijing",
            "https://en.wikipedia.org/wiki/San_Francisco",
            "https://en.wikipedia.org/wiki/Dubai",
            "https://en.wikipedia.org/wiki/Los_Angeles",
            "https://en.wikipedia.org/wiki/Tokyo",
            "https://en.wikipedia.org/wiki/Paris",
            "https://en.wikipedia.org/wiki/Sydney",
            "https://en.wikipedia.org/wiki/Cape_Town",
            "https://en.wikipedia.org/wiki/Berlin",
            "https://en.wikipedia.org/wiki/Moscow",
            "https://en.wikipedia.org/wiki/Rio_de_Janeiro",
            "https://en.wikipedia.org/wiki/Mexico_City",
            "https://en.wikipedia.org/wiki/Sao_Paulo",
            "https://en.wikipedia.org/wiki/Bangkok",
            "https://en.wikipedia.org/wiki/Beijing",
            "https://en.wikipedia.org/wiki/San_Francisco",
            "https://en.wikipedia.org/wiki/Dubai",
            "https://en.wikipedia.org/wiki/Los_Angeles",
            "https://en.wikipedia.org/wiki/New_York_City",
            "https://en.wikipedia.org/wiki/London",
            "https://en.wikipedia.org/wiki/Tokyo",
            "https://en.wikipedia.org/wiki/Paris",
            "https://en.wikipedia.org/wiki/Sydney",
            "https://en.wikipedia.org/wiki/Cape_Town",
            "https://en.wikipedia.org/wiki/Berlin",
            "https://en.wikipedia.org/wiki/Moscow",
            "https://en.wikipedia.org/wiki/Rio_de_Janeiro",
            "https://en.wikipedia.org/wiki/Mexico_City",
            "https://en.wikipedia.org/wiki/Sao_Paulo",
            "https://en.wikipedia.org/wiki/Bangkok",
            "https://en.wikipedia.org/wiki/Beijing",
            "https://en.wikipedia.org/wiki/San_Francisco",
            "https://en.wikipedia.org/wiki/Dubai",
            "https://en.wikipedia.org/wiki/Los_Angeles",
            "https://en.wikipedia.org/wiki/Tokyo",
            "https://en.wikipedia.org/wiki/Paris",
            "https://en.wikipedia.org/wiki/Sydney",
            "https://en.wikipedia.org/wiki/Cape_Town",
            "https://en.wikipedia.org/wiki/Berlin",
            "https://en.wikipedia.org/wiki/Moscow",
            "https://en.wikipedia.org/wiki/Rio_de_Janeiro",
            "https://en.wikipedia.org/wiki/Mexico_City",
            "https://en.wikipedia.org/wiki/Sao_Paulo",
            "https://en.wikipedia.org/wiki/Bangkok",
            "https://en.wikipedia.org/wiki/Beijing",
            "https://en.wikipedia.org/wiki/San_Francisco",
            "https://en.wikipedia.org/wiki/Dubai",
            "https://en.wikipedia.org/wiki/Los_Angeles",
            "https://en.wikipedia.org/wiki/New_York_City",
            "https://en.wikipedia.org/wiki/London",
            "https://en.wikipedia.org/wiki/Tokyo",
            "https://en.wikipedia.org/wiki/Paris",
            "https://en.wikipedia.org/wiki/Sydney",
            "https://en.wikipedia.org/wiki/Cape_Town",
            "https://en.wikipedia.org/wiki/Berlin",
            "https://en.wikipedia.org/wiki/Moscow",
            "https://en.wikipedia.org/wiki/Rio_de_Janeiro",
            "https://en.wikipedia.org/wiki/Mexico_City",
            "https://en.wikipedia.org/wiki/Sao_Paulo",
            "https://en.wikipedia.org/wiki/Bangkok",
            "https://en.wikipedia.org/wiki/Beijing",
            "https://en.wikipedia.org/wiki/San_Francisco",
            "https://en.wikipedia.org/wiki/Dubai",
            "https://en.wikipedia.org/wiki/Los_Angeles",
            "https://en.wikipedia.org/wiki/Tokyo",
            "https://en.wikipedia.org/wiki/Paris",
            "https://en.wikipedia.org/wiki/Sydney",
            "https://en.wikipedia.org/wiki/Cape_Town",
            "https://en.wikipedia.org/wiki/Berlin",
            "https://en.wikipedia.org/wiki/Moscow",
            "https://en.wikipedia.org/wiki/Rio_de_Janeiro",
            "https://en.wikipedia.org/wiki/Mexico_City",
            "https://en.wikipedia.org/wiki/Sao_Paulo",
            "https://en.wikipedia.org/wiki/Bangkok",
            "https://en.wikipedia.org/wiki/Beijing",
            "https://en.wikipedia.org/wiki/San_Francisco",
            "https://en.wikipedia.org/wiki/Dubai",
            "https://en.wikipedia.org/wiki/Los_Angeles",
            "https://en.wikipedia.org/wiki/New_York_City",
            "https://en.wikipedia.org/wiki/London",
            "https://en.wikipedia.org/wiki/Tokyo",
            "https://en.wikipedia.org/wiki/Paris",
            "https://en.wikipedia.org/wiki/Sydney",
            "https://en.wikipedia.org/wiki/Cape_Town",
            "https://en.wikipedia.org/wiki/Berlin",
            "https://en.wikipedia.org/wiki/Moscow",
            "https://en.wikipedia.org/wiki/Rio_de_Janeiro",
            "https://en.wikipedia.org/wiki/Mexico_City",
            "https://en.wikipedia.org/wiki/Sao_Paulo",
            "https://en.wikipedia.org/wiki/Bangkok",
            "https://en.wikipedia.org/wiki/Beijing",
            "https://en.wikipedia.org/wiki/San_Francisco",
            "https://en.wikipedia.org/wiki/Dubai",
            "https://en.wikipedia.org/wiki/Los_Angeles",
            "https://en.wikipedia.org/wiki/Mexico_City",
            "https://en.wikipedia.org/wiki/Sao_Paulo",
            "https://en.wikipedia.org/wiki/Bangkok",
            "https://en.wikipedia.org/wiki/Beijing",
            "https://en.wikipedia.org/wiki/San_Francisco",
            "https://en.wikipedia.org/wiki/Dubai",
        ];

        function generateRandomPalette() {
            const palette = [];
            for (let i = 0; i < 256; i++) {
                const r = Math.floor(Math.random() * 256);
                const g = Math.floor(Math.random() * 256);
                const b = Math.floor(Math.random() * 256);
                palette.push(`rgb(${r}, ${g}, ${b})`);
            }
            return palette;
        }

        function randomCoefficients() {
            return Array.from({ length: 9 }, () => Math.random() * 4 - 2);
        }

        function getRandomIterations(min = 100, max = 1000) {
            return Math.floor(Math.random() * (max - min + 1)) + min;
        }

        function getRandomZ() {
            //return Math.random() * 4 - 2; // Random z value between -2 and 2
            return Math.random(); // Random z value between -2 and 2

        }

        function calculateLyapunovExponent(coeffsX, coeffsY, coeffsZ) {
            const maxIterations = getRandomIterations(); // Random iterations between 1000 and 100000
            let lyapunovSum = 0;

            for (let n = 0; n < 100; n++) {
                let x = Math.random() * 4 - 2;
                let y = Math.random() * 4 - 2;
                let z = getRandomZ(); // Use random z value
                let localSum = 0;

                for (let i = 0; i < maxIterations; i++) {
                    const nextX = coeffsX[0] + coeffsX[1] * x + coeffsX[2] * x * x + coeffsX[3] * x * y + coeffsX[4] * y + coeffsX[5] * y * y + coeffsX[6] * z + coeffsX[7] * z * z + coeffsX[8] * x * z;
                    const nextY = coeffsY[0] + coeffsY[1] * x + coeffsY[2] * x * x + coeffsY[3] * x * y + coeffsY[4] * y + coeffsY[5] * y * y + coeffsY[6] * z + coeffsY[7] * z * z + coeffsY[8] * y * z;
                    const nextZ = coeffsZ[0] + coeffsZ[1] * x + coeffsZ[2] * x * x + coeffsZ[3] * x * y + coeffsZ[4] * y + coeffsZ[5] * y * y + coeffsZ[6] * z + coeffsZ[7] * z * z + coeffsZ[8] * x * y;

                    const derivativeX = coeffsX[1] + 2 * coeffsX[2] * x + coeffsX[3] * y + coeffsX[4] * y + coeffsX[5] * 2 * y + coeffsX[6] * z + coeffsX[8] * z;
                    const derivativeY = coeffsY[1] + 2 * coeffsY[2] * x + coeffsY[3] * y + coeffsY[4] * y + coeffsY[5] * 2 * y + coeffsY[6] * z + coeffsY[8] * z;
                    const derivativeZ = coeffsZ[1] + 2 * coeffsZ[2] * x + coeffsZ[3] * y + coeffsZ[4] * y + coeffsZ[5] * 2 * y + coeffsZ[6] * z + coeffsZ[8] * x;

                    localSum += Math.log(Math.abs(derivativeX * derivativeY * derivativeZ));
                    x = nextX;
                    y = nextY;
                    z = nextZ;
                }
                lyapunovSum += localSum / maxIterations;
            }
            return lyapunovSum / 100;
        }

        function drawFractal(canvas, coeffsX, coeffsY, coeffsZ, palette) {
            const ctx = canvas.getContext('2d');
            const pixels = ctx.createImageData(canvas.width, canvas.height);
            const data = pixels.data;
            const lyapunovExp = calculateLyapunovExponent(coeffsX, coeffsY, coeffsZ);
            const isChaotic = lyapunovExp > 0;
            var brightness = Math.random() * 128 + 128;

            //var xstart = 0;
            //var ystart = 0;

            for (let y = 0; y < canvas.height; y++) {
                for (let x = 0; x < canvas.width; x++) {
                    let nx = x / 2 - 2; // Scale for 320px width
                    let ny = y / 4 - 2; // Scale for 200px height
                    //let nz = x;//getRandomZ(); // Generate random z
                    //let nz = 100000;
                    let nz = getRandomZ();

                    let nextX = coeffsX[0] + coeffsX[1] * nx + coeffsX[2] * nx * nx + coeffsX[3] * nx * ny + coeffsX[4] * ny + coeffsX[5] * ny * ny + coeffsX[6] * nz + coeffsX[7] * nz * nz + coeffsX[8] * nx * nz;
                    let nextY = coeffsY[0] + coeffsY[1] * nx + coeffsY[2] * nx * nx + coeffsY[3] * nx * ny + coeffsY[4] * ny + coeffsY[5] * ny * ny + coeffsY[6] * nz + coeffsY[7] * nz * nz + coeffsY[8] * ny * nz;
                    let nextZ = coeffsZ[0] + coeffsZ[1] * nx + coeffsZ[2] * nx * nx + coeffsZ[3] * nx * ny + coeffsZ[4] * ny + coeffsZ[5] * ny * ny + coeffsZ[6] * nz + coeffsZ[7] * nz * nz + coeffsZ[8] * nx * ny;
                    const colorIndex = Math.floor((Math.abs(nextX + nextY + nextZ) % 256));
                    const [r, g, b] = palette[colorIndex].match(/\d+/g).map(Number);
                    const pixelIndex = (y * canvas.width + x) * 4;
                    data[pixelIndex] = r;     
                    data[pixelIndex + 1] = g; 
                    data[pixelIndex + 2] = b; 
                    data[pixelIndex + 3] = 255;
                    data[pixelIndex + 3] = brightness;
                }
            }
            ctx.putImageData(pixels, 0, 0);
        }
        function createFractalCanvas(url) {
            const link = document.createElement('a');
            link.href = url;
            link.target = "_blank"; // Open in a new tab
            const canvas = document.createElement('canvas');
            canvas.width = 32; // Width of each small fractal
            canvas.height = 16; // Height of each small fractal
            link.appendChild(canvas);
            return link;
        }
        function createDisplayCanvas(url) {
            const link = document.createElement('a');
            link.href = url;
            link.target = "_blank"; // Open in a new tab
            const canvas = document.createElement('canvas');
            canvas.width = 1280; // Width of each small fractal
            canvas.height = 300; // Height of each small fractal
            link.appendChild(canvas);
            return link;
        }
        function createMenuCanvas(url) {
            const link = document.createElement('a');
            link.href = url;
            link.target = "_blank"; // Open in a new tab
            const canvas = document.createElement('canvas');
            canvas.width = 1280; // Width of each small fractal
            canvas.height = 1; // Height of each small fractal
            link.appendChild(canvas);
            return link;
        }
        function updateFractal(canvas) {
            const coeffsX = randomCoefficients();
            const coeffsY = randomCoefficients();
            const coeffsZ = randomCoefficients();
            const palette = generateRandomPalette();
            drawFractal(canvas, coeffsX, coeffsY, coeffsZ, palette);
        }
        function createGrid() {
            const grid = document.getElementById('fractalGrid');
            const output = document.getElementById('output');
            const menudisplay = document.getElementById('menudisplay');

            grid.innerHTML = ''; // Clear previous contents
            output.innerHTML = ''; // Clear previous contents
            menudisplay.innerHTML = ''; // Clear previous contents

            const displayCanvas = createDisplayCanvas(cityUrls[0]);
            //output.appendChild(displayCanvas);

            const menuCanvas = createMenuCanvas(cityUrls[0]);
            //menudisplay.appendChild(menuCanvas);

            const canvases = [];
            for (let i = 0; i < cityUrls.length; i++) {
                const fractalCanvas = createFractalCanvas(cityUrls[i]);
                canvases.push(fractalCanvas.querySelector('canvas')); // Store the canvas element for updating
                grid.appendChild(fractalCanvas);
                // Immediately update with a fractal image
                updateFractal(fractalCanvas.querySelector('canvas'));
            }
            return canvases;
        }

        function startFractalSwap() {
            const canvases = createGrid();
            setInterval(() => {
                canvases.forEach(canvas => updateFractal(canvas));
            }, 3000); // Update every 3 seconds
        }
        startFractalSwap();
    </script>

</body>
</html>
