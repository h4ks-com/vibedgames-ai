<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Admin Onboarding Vibe Game - Enhanced Prototype</title>
  <meta name="description" content="A lightweight in-browser prototype of a 4-step admin onboarding loop with enhanced graphics, onboarding mindset, and shareable badge flow." />
  <style>
    /* Design tokens */
    :root {
      --bg: #0b1020;
      --surface: rgba(20,26,40,.95);
      --surface-2: rgba(20,26,40,.8);
      --text: #e5e7eb;
      --muted: #94a3b8;
      --primary: #7c5cff;
      --primary-dark: #4b6ef5;
      --accent: #22d3ee;
      --green: #10b981;
      --red: #f87171;
      --card: rgba(15,23,42,.95);
    }

    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto;
      color: var(--text);
      background: radial-gradient(circle at 20% -10%, rgba(124,92,255,.25), transparent 40%),
                  radial-gradient(circle at 100% 0%, rgba(34,211,238,.15), transparent 30%),
                  url('') no-repeat center/cover;
    background-color: #0b1020;
      overflow-y: auto;
    }

    /* App layout */
    .app {
      display: grid;
      grid-template-columns: 320px 1fr;
      min-height: 100vh;
    }

    .sidebar {
      padding: 22px 22px 16px 22px;
      background: linear-gradient(135deg, rgba(17,24,39,.95), rgba(17,24,39,.75));
      border-right: 1px solid rgba(255,255,255,.08);
      position: sticky; top: 0; height: 100vh; overflow:auto;
    }

    .brand {
      font-weight: 900;
      font-size: 1.25rem;
      letter-spacing: .5px;
      margin: 6px 0 8px 0;
      background: linear-gradient(90deg, #ffffff, #a5f3fc);
      -webkit-background-clip: text; background-clip: text; color: transparent;
    }

    .stepper { display:flex; flex-direction:column; gap: 10px; margin-top: 8px; }
    .step { display:flex; align-items:center; gap:12px; padding:12px; border-radius: 12px; border:1px solid rgba(255,255,255,.08); background: rgba(255,255,255,.04); }
    .step.completed { background: rgba(16,185,129,.25); border-color: rgba(16,185,129,.8); }
    .step.active { border-color: rgba(124,92,255,.8); background: linear-gradient(135deg, rgba(124,92,255,.25), rgba(34,211,238,.25)); box-shadow: inset 0 0 12px rgba(124,92,255,.5); }
    .step .step-index { width: 28px; height: 28px; border-radius: 8px; display:inline-flex; align-items:center; justify-content:center; font-weight:700; background:#1f2937; }
    .step-title { font-weight: 600; }
    .footnote { font-size: 12px; color: var(--muted); margin-top: 14px; }

    .content { padding: 28px; display:flex; align-items:flex-start; justify-content:center; }

    .card { background: var(--card); border:1px solid rgba(255,255,255,.08); border-radius: 16px; padding: 20px; width:100%; max-width: 860px; min-width: 280px; box-shadow: 0 18px 40px rgba(0,0,0,.25); }
    .card-header { display:flex; align-items: center; justify-content: space-between; margin-bottom: 12px; }
    .card-title { font-size: 1.25rem; font-weight: 700; margin:0; }
    .hint { color: var(--muted); font-size: 0.85rem; }

    .grid { display:grid; grid-template-columns: 1fr; gap:16px; }
    @media (min-width: 900px) { .grid { grid-template-columns: 1fr 1fr; } }

    .form { display:flex; flex-direction:column; gap:12px; }
    .label { font-size: 0.9rem; color: #cbd5e1; }
    .input, .select, .textarea { padding: 12px; border-radius: 8px; border:1px solid rgba(255,255,255,.25); background: rgba(2,6,23,.6); color: #fff; width: 100%; }
    .input:focus, .select:focus { outline: 2px solid #93c5fd; outline-offset: 0; }
    .row { display:flex; align-items:center; gap:12px; }
    .help { font-size: 12px; color: var(--muted); }
    .error { color: #f87171; font-size: 12px; }
    .success { color: #34d399; font-size: 12px; }

    .avatar { width: 28px; height: 28px; border-radius:50%; background: #334155; display:inline-block; vertical-align: middle; }

    .badge-preview { width: 180px; height: 180px; border-radius: 16px; overflow:hidden; border:1px solid rgba(255,255,255,.2); }
    .badge-wrap { display:flex; align-items: center; gap: 20px; }

    .toolbar { display:flex; flex-wrap:wrap; gap: 8px; align-items:center; }

    .toast { position: fixed; bottom: 16px; left: 50%; transform: translateX(-50%); background: #111827; color:white; padding: 12px 16px; border-radius: 8px; box-shadow: 0 6px 18px rgba(0,0,0,.4); }
  </style>
</head>
<body>
  <div id="app" class="app" role="application" aria-label="Admin onboarding app">
    <aside class="sidebar" aria-label="Onboarding steps">
      <div class="brand" aria-label="Brand">Admin Onboarder</div>
      <div id="stepper" class="stepper" aria-label="Onboarding steps summary"></div>
      <div class="footnote" aria-hidden="true">Tip: This is a lightweight in-browser prototype for a 4-step onboarding loop.</div>
      <div id="auditPanel" class="card" style="margin-top:16px; display:none;" aria-label="Audit logs panel">
        <div class="card-header"><h3 class="card-title">Admin Activity Feed</h3></div>
        <div id="auditList" aria-live="polite" style="max-height:180px; overflow:auto; font-family: ui-monospace, SFMono-Regular, Menlo, monospace; font-size:12px;"></div>
      </div>
    </aside>
    <main class="content" id="content" aria-label="Onboarding content" role="main" tabindex="-1">
      <!-- dynamic content injected by script -->
      <div class="card" id="contentCard" aria-label="Onboarding content card">
        <div class="card-header">
          <h2 class="card-title" id="cardTitle"></h2>
          <div class="toolbar" id="stepBadges" aria-label="Step progress badges"></div>
        </div>
        <div id="cardBody" class="card-body grid"></div>
      </div>
    </main>
  </div>
  <div id="toast" class="toast" style="display:none" role="status" aria-live="polite"></div>
  <script>
    // In-browser prototype data stores and logic for a 4-step onboarding loop with enhanced graphics.
    // Core concepts implemented:
    // 1) Login, 2) Create first user, 3) Grant admin, 4) Unlock shareable badge

    // Data stores (in-memory for prototype)
    const users = []; // { id, email, displayName, passwordHash, avatarColor, createdAt, updatedAt, lastLogin, isAdmin }
    const audits = []; // { actorId, action, targetId, timestamp }
    const badgesAwarded = []; // { userId, badgeId, issuedAt }
    const shareTokens = {}; // token -> { userId, badgeId, createdAt, expiresAt }

    // Simple in-memory user id generator
    let nextUserId = 1;
    function uid(prefix='u') { return prefix + (nextUserId++); }

    // Simple password hash (demo only) and policy checks
    function hashPassword(pw) {
      // Naive, for demo purposes only
      return btoa(pw);
    }
    function verifyPassword(pw, hash) {
      return hashPassword(pw) === hash;
    }
    function isStrongPassword(pw) {
      if (!pw || pw.length < 8) return false;
      const hasUpper = /[A-Z]/.test(pw);
      const hasLower = /[a-z]/.test(pw);
      const hasDigit = /[0-9]/.test(pw);
      return hasUpper && hasLower && hasDigit;
    }

    // Onboarding progress (simple per-session state for the demo)
    const onboarding = {
      currentStep: 0, // 0..3
      loginDone: false,
      firstUserCreated: false,
      adminGranted: false,
      badgeUnlocked: false
    };

    // DOM references
    const content = document.getElementById('content');
    const contentCard = document.getElementById('contentCard');
    const cardTitle = document.getElementById('cardTitle');
    const cardBody = document.getElementById('cardBody');
    const stepperEl = document.getElementById('stepper');
    const auditPanel = document.getElementById('auditPanel');
    const auditList = document.getElementById('auditList');
    const toast = document.getElementById('toast');
    const stepBadges = document.getElementById('stepBadges');

    // Initialize app
    function init() {
      renderStepper();
      renderContent();
    }

    // Utility: show toast
    function showToast(msg, duration=1800) {
      toast.textContent = msg;
      toast.style.display = 'block';
      setTimeout(() => { toast.style.display = 'none'; }, duration);
    }

    // Audit log helper
    function logAudit(action, actorId=null, targetId=null) {
      const entry = {
        actorId: actorId ?? 'system',
        action,
        targetId,
        timestamp: new Date().toISOString()
      };
      audits.push(entry);
      renderAuditFeed();
    }

    function renderAuditFeed() {
      if (audits.length === 0) {
        auditList.innerHTML = '<div class="help">No actions yet. Actions will appear here as you proceed.</div>';
        return;
      }
      auditPanel.style.display = 'block';
      auditList.innerHTML = audits.slice().reverse().map(a => {
        const actor = typeof a.actorId === 'string' ? a.actorId : ('user:' + a.actorId);
        return `<div>[$${a.timestamp}] ${actor} => ${a.action} ${a.targetId ? '(target:' + a.targetId + ')' : ''}</div>`;
      }).join('');
    }

    // Stepper rendering
    function renderStepper() {
      const steps = [
        { id: 'login', label: 'Login' },
        { id: 'first-user', label: 'Create first user' },
        { id: 'grant-admin', label: 'Grant admin' },
        { id: 'badge', label: 'Unlock badge' }
      ];
      const items = steps.map((s, idx) => {
        const completed = onboarding.currentStep > idx;
        const active = onboarding.currentStep === idx;
        return `<div class="step ${completed ? 'completed' : ''} ${active ? 'active' : ''}" role="button" aria-label="Step ${idx+1}: ${s.label}" data-step="${idx}">
          <span class="step-index">${idx+1}</span>
          <div class="step-title">${s.label}</div>
        </div>`;
      }).join('');
      stepperEl.innerHTML = items;
      // Attach click to navigate (for demo convenience)
      stepperEl.querySelectorAll('.step').forEach(el => {
        el.addEventListener('click', () => {
          const s = parseInt(el.getAttribute('data-step'), 10);
          if (!Number.isNaN(s)) {
            onboarding.currentStep = s;
            renderStepper();
            renderContent();
          }
        });
      });
    }

    // Badge helpers
    const BADGES = {
      ONBOARDING_COMPLETE: 'Onboarding Complete',
      FIRST_ADMIN: 'First Admin',
      ADMIN_MILESTONE: 'Admin Milestone'
    };

    function hasAdminExists() { return users.some(u => u.isAdmin); }
    function getFirstAdmin() { return users.find(u => u.isAdmin); }

    function awardBadge(userId, badgeId) {
      // idempotent: do not duplicate
      const exists = badgesAwarded.find(b => b.userId === userId && b.badgeId === badgeId);
      if (exists) return false;
      badgesAwarded.push({ userId, badgeId, issuedAt: new Date().toISOString() });
      return true;
    }

    function generateBadgeSVG(userName, badgeName, dateStr) {
      const safeName = userName.replace(/&/g, '&amp;').replace(/</g, '&lt;');
      const svg = `<?xml version='1.0' encoding='UTF-8'?>
<svg width='480' height='480' viewBox='0 0 480 480' xmlns='http://www.w3.org/2000/svg'>
  <defs>
    <linearGradient id='g' x1='0' y1='0' x2='1' y2='1'>
      <stop offset='0%' stop-color='#7c5cff'/>
      <stop offset='100%' stop-color='#22d3ee'/>
    </linearGradient>
  </defs>
  <rect width='100%' height='100%' rx='28' fill='#0b1020'/>
  <circle cx='240' cy='180' r='120' fill='url(#g)' opacity='0.9'/>
  <text x='50%' y='315' font-family='Arial' font-size='28' text-anchor='middle' fill='#e2e8f0'>${badgeName}</text>
  <text x='50%' y='350' font-family='Arial' font-size='20' text-anchor='middle' fill='#cbd5e1'>Awarded to ${safeName}</text>
  <text x='50%' y='385' font-family='Arial' font-size='16' text-anchor='middle' fill='#93c5fd'>${dateStr}</text>
</svg>`;
      return svg;
    }

    // Share token generation (deterministic-ish for demo)
    function baseSlug(s) { return s.toLowerCase().replace(/[^a-z0-9]+/g, '-').replace(/(^-|-$)/g, ''); }
    function generateShareToken(userId, badgeId) {
      const t = btoa(userId + ':' + badgeId + ':' + Date.now().toString());
      shareTokens[t] = { userId, badgeId, createdAt: new Date().toISOString(), expiresAt: Date.now() + 7*24*60*60*1000 };
      return t;
    }

    // Render content for each step
    function renderContent() {
      // Update step badges inside header
      stepBadges.innerHTML = '';
      const current = onboarding.currentStep;
      for (let i=0; i<4; i++) {
        const dot = document.createElement('span');
        dot.className = 'badge'; dot.style.fontSize='12px'; dot.style.padding='6px 9px';
        if (i < current) dot.style.background = 'rgba(16,185,129,.3)';
        else if (i === current) dot.style.background = 'rgba(124,92,255,.4)';
        dot.textContent = i+1;
        stepBadges.appendChild(dot);
      }

      // Card title and body depending on step
      const steps = ['Login', 'Create first user', 'Grant admin', 'Unlock shareable badge'];
      cardTitle.textContent = steps[current];

      // Clear body
      cardBody.innerHTML = '';

      if (current === 0) {
        renderLoginStep();
      } else if (current === 1) {
        renderFirstUserStep();
      } else if (current === 2) {
        renderGrantAdminStep();
      } else if (current === 3) {
        renderBadgeStep();
      }

      // Update accessibility focus
      content.setAttribute('tabindex','-1');
      content.focus();
      // Audit panel visibility based on progress
      if (audits.length > 0) auditPanel.style.display = 'block';
    }

    // 0. Login step
    function renderLoginStep() {
      const container = document.createElement('div'); container.className='step-content';
      container.innerHTML = `
        <form id="loginForm" class="form" aria-label="Login form">
          <div>
            <label class="label" for="loginEmail">Email</label>
            <input id="loginEmail" name="email" type="email" class="input" placeholder="admin@example.com" required />
          </div>
          <div>
            <label class="label" for="loginPw">Password</label>
            <input id="loginPw" name="password" type="password" class="input" placeholder="Enter password" required />
          </div>
          <div class="row" style="align-items:center; justify-content: space-between;">
            <button type="submit" class="btn primary" aria-label="Login">Login</button>
            <span class="hint">Hint: No users yet? Use Step 2 to create the first admin user.</span>
          </div>
          <div id="loginError" class="error" aria-live="polite"></div>
        </form>
      `;
      cardBody.appendChild(container);

      const loginForm = document.getElementById('loginForm');
      loginForm.addEventListener('submit', (e) => {
        e.preventDefault();
        const email = document.getElementById('loginEmail').value.trim().toLowerCase();
        const pw = document.getElementById('loginPw').value;
        const user = users.find(u => u.email.toLowerCase() === email);
        const errBox = document.getElementById('loginError');
        if (!user) {
          errBox.textContent = 'No user found with that email. Create the first user in Step 2.';
          return;
        }
        if (!verifyPassword(pw, user.passwordHash)) {
          errBox.textContent = 'Incorrect password. Please try again.';
          return;
        }
        // login success
        currentUserId = user.id;
        onboarding.loginDone = true;
        logAudit('user.login', currentUserId, user.id);
        showToast('Welcome, ' + user.displayName + '!');
        // move to next step if allowed
        onboarding.currentStep = Math.min(3, 1); // proceed to Step 2 by default
        renderStepper();
        renderContent();
      });
    }

    // 1. Create first user
    function renderFirstUserStep() {
      const container = document.createElement('div'); container.className='step-content';
      container.innerHTML = `
        <form id="firstUserForm" class="form" aria-label="Create first user form">
          <div>
            <label class="label" for="fuEmail">Email</label>
            <input id="fuEmail" name="email" type="email" class="input" placeholder="admin@example.com" required />
          </div>
          <div>
            <label class="label" for="fuName">Display name</label>
            <input id="fuName" name="name" type="text" class="input" placeholder="Administrator" required />
          </div>
          <div>
            <label class="label" for="fuPw">Password</label>
            <input id="fuPw" name="password" type="password" class="input" placeholder="Create a strong password" required />
          </div>
          <div class="row" aria-label="admin option row">
            <input id="fuAdmin" type="checkbox" name="makeAdmin" />
            <label for="fuAdmin" class="help">Make this user an admin (optional)</label>
          </div>
          <div class="row" style="justify-content: space-between; align-items: center;">
            <button type="submit" class="btn primary" aria-label="Create first user">Create User</button>
            <span class="hint">If this is the first user and you enable admin, they will be granted admin rights automatically by default.</span>
          </div>
          <div id="fuError" class="error" aria-live="polite"></div>
        </form>
      `;
      cardBody.appendChild(container);

      const firstUserForm = document.getElementById('firstUserForm');
      firstUserForm.addEventListener('submit', (e) => {
        e.preventDefault();
        const email = document.getElementById('fuEmail').value.trim().toLowerCase();
        const name = document.getElementById('fuName').value.trim();
        const pw = document.getElementById('fuPw').value;
        const isAdmin = document.getElementById('fuAdmin').checked;
        const fuError = document.getElementById('fuError');
        // validations
        if (!email || !name || !pw) { fuError.textContent = 'Please fill all fields.'; return; }
        if (users.find(u => u.email.toLowerCase() === email)) { fuError.textContent = 'That email is already registered.'; return; }
        if (!isStrongPassword(pw)) { fuError.textContent = 'Password must be at least 8 chars with uppercase, lowercase, and digits.'; return; }
        // create user
        const user = {
          id: uid('u'),
          email,
          displayName: name,
          passwordHash: hashPassword(pw),
          avatarColor: '#'+Math.floor(Math.random()*16777215).toString(16),
          createdAt: new Date().toISOString(),
          updatedAt: new Date().toISOString(),
          lastLogin: null,
          isAdmin: false
        };
        // auto-assign admin if first admin and no admins exist and option enabled
        const adminExists = hasAdminExists();
        const isFirstUser = users.length === 0;
        user.isAdmin = false;
        if (!adminExists && isFirstUser) {
          // auto-assign admin for first created user
          user.isAdmin = true;
        } else if (isAdmin) {
          user.isAdmin = true;
        }
        users.push(user);
        nextUserIdToast(user.displayName);
        // update onboarding state
        onboarding.firstUserCreated = true;
        onboarding.currentStep = 2; // move to grant-admin next
        // persist current login as the user if admin created? We just created user; log audit
        logAudit('user.created', 'system', user.id);
        if (user.isAdmin) logAudit('admin.granted', user.id, user.id);
        renderStepper(); renderContent();
      });
    }

    // 2. Grant admin
    function renderGrantAdminStep() {
      const container = document.createElement('div'); container.className='step-content';
      // List non-admin users and a form to grant admin
      const nonAdmins = users.filter(u => !u.isAdmin);
      const hasCandidates = nonAdmins.length > 0;
      const options = nonAdmins.map(u => `<option value="${u.id}">${u.displayName} (${u.email})</option>`).join('');
      const selectHTML = `<select id="grantUser" class="input" aria-label="Select user to grant admin">${ options || '<option value="">No non-admin users</option>'}</select>`;
      container.innerHTML = `
        <div class="grid">
          <div class="card" style="padding:12px; background: rgba(2,6,23,.5); border-radius:12px; border:1px solid rgba(255,255,255,.15);">
            <h3 style="margin:0 0 8px; font-size:1.1rem;">Grant admin to an existing user</h3>
            <p class="hint" style="margin:0 0 8px;">Select a user who should receive admin rights. This action can be audited and is reflected in the badge flow.</p>
            <div>${selectHTML}</div>
            <button id="grantBtn" class="btn primary" style="margin-top:8px;" ${hasCandidates ? '' : 'disabled aria-disabled="true"'}>Grant Admin</button>
            <div id="grantMsg" class="error" aria-live="polite" style="margin-top:6px;"></div>
          </div>
          <div class="card" style="padding:12px; display:flex; flex-direction:column; gap:8px;">
            <div class="hint">Current admins:</div>
            <div id="adminList" style="font-family: ui-monospace, SFMono-Regular; font-size:12px; max-height:120px; overflow:auto;"></div>
          </div>
        </div>
      `;
      cardBody.appendChild(container);

      const grantBtn = document.getElementById('grantBtn');
      grantBtn.addEventListener('click', () => {
        const sel = document.getElementById('grantUser');
        const userId = sel.value;
        const msg = document.getElementById('grantMsg');
        if (!userId) { msg.textContent = 'Please select a user to grant admin.'; return; }
        const user = users.find(u => u.id === userId);
        if (!user) { msg.textContent = 'Selected user not found.'; return; }
        if (user.isAdmin) { msg.textContent = 'User is already an admin.'; return; }
        user.isAdmin = true;
        onboarding.adminGranted = true;
        logAudit('admin.granted', 'system', user.id);
        showToast('Admin granted to ' + user.displayName);
        refreshAdminList();
        renderStepper(); // update active step highlight
      });

      function refreshAdminList() {
        const list = document.getElementById('adminList');
        if (!list) return;
        const admins = users.filter(u => u.isAdmin);
        list.innerHTML = admins.map(a => `- ${a.displayName} (${a.email})`).join('<br>') || 'No admins yet.';
      }
      refreshAdminList();
    }

    // 3. Badge unlock (shareable)
    function renderBadgeStep() {
      // Ensure there is at least one admin; if not, guide user back.
      const firstAdmin = getFirstAdmin();
      if (!firstAdmin) {
        const msg = document.createElement('div'); msg.className='hint'; msg.textContent = 'Awaiting an admin before unlocking a shareable badge. Go back to Grant Admin to proceed.';
        cardBody.appendChild(msg);
        // Move pointer back to admin step automatically after animation
        onboarding.currentStep = 2;
        renderStepper(); renderContent();
        return;
      }
      // Auto-award a simple onboarding badge to the first admin if not yet awarded
      const already = badgesAwarded.find(b => b.userId === firstAdmin.id && b.badgeId === BADGES.ONBOARDING_COMPLETE);
      if (!already) {
        awardBadge(firstAdmin.id, BADGES.ONBOARDING_COMPLETE);
        logAudit('badge.awarded', firstAdmin.id, BADGES.ONBOARDING_COMPLETE);
      }

      // Build UI: show badge, share URL, copy button, and preview image
      const container = document.createElement('div'); container.className='step-content';
      const badgeSVG = getBadgeSVGMarkup(firstAdmin);
      container.innerHTML = `
        <div class="grid">
          <div class="card" style="padding:12px; display:flex; flex-direction:column; gap:12px;">
            <h3 style="margin:0 0 6px; font-size:1.1rem;">Your shareable badge</h3>
            <div class="badge-wrap" aria-label="Badge preview and share">
              <div class="badge-preview" id="badgeImg" aria-label="Badge image" style="width:180px; height:180px; border-radius:12px; overflow:hidden; border:1px solid rgba(255,255,255,.2);"></div>
              <div>
                <div class="hint">Badge title: ${BADGES.ONBOARDING_COMPLETE}</div>
                <div id="badgeDate" class="hint">Issued: ${new Date().toLocaleDateString()}</div>
                <div style="margin-top:6px;" aria-label="Share link">
                  <input id="shareURL" class="input" style="width: 100%;" value="https://example.com/share/${firstAdmin.id}/${encodeURIComponent(BADGES.ONBOARDING_COMPLETE)}" readonly />
                  <button id="copyBtn" class="btn secondary" style="margin-top:6px;" aria-label="Copy share URL">Copy</button>
                </div>
              </div>
            </div>
          </div>
          <div class="card" style="padding:12px; display:flex; flex-direction:column; gap:8px; align-items:flex-start;">
            <div id="sharePreview" style="width:100%; display:flex; flex-direction:column; gap:8px; align-items:flex-start;">
              <div class="hint">Shareable badge image (SVG):</div>
              <img id="badgeSVG" alt="Badge SVG preview" style="width:320px; height:auto; display:block; border:1px solid rgba(255,255,255,.2);" />
              <div class="hint">Open Graph preview and social sharing can be simulated with the share URL above.</div>
            </div>
          </div>
        </div>
      `;
      cardBody.appendChild(container);

      // Build badge SVG image into the #badgeImg container and as img for SVG rendering
      const imgContainer = document.getElementById('badgeImg');
      const svgData = badgeSVG.svgData || badgeSVG; // if function returns string or object
      // We embed a generated SVG as a data URL
      const badgeStr = (typeof badgeSVG === 'string') ? badgeSVG : badgeSVG.svg;
      const dataUrl = 'data:image/svg+xml;utf8,' + encodeURIComponent(badgeStr);
      const badgePreview = document.getElementById('badgeSVG');
      badgePreview.src = dataUrl;

      // Prepare share button
      const copyBtn = document.getElementById('copyBtn');
      const shareURL = document.getElementById('shareURL');
      copyBtn.addEventListener('click', () => {
        navigator.clipboard?.writeText(shareURL.value).then(() => {
          showToast('Share URL copied to clipboard');
        }).catch(() => {
          showToast('Could not copy to clipboard');
        });
      });

      // Show a tiny demo of a share link that would be used by social platforms
      renderOpenGraphPreview(firstAdmin);
    }

    function getBadgeSVGMarkup(user) {
      const dateStr = new Date().toLocaleDateString();
      const svg = generateBadgeSVG(user.displayName, BADGES.ONBOARDING_COMPLETE, dateStr);
      return svg;
    }

    function renderOpenGraphPreview(user) {
      // Could render an Open Graph meta-like preview in the UI
      // For demo, show a small panel with a sample og:title and og:description.
      const og = document.createElement('div'); og.className='hint';
      og.style.maxWidth='600px'; og.textContent = 'Open Graph Preview: title="Badge: ' + BADGES.ONBOARDING_COMPLETE + '" for ' + user.displayName;
      cardBody.appendChild(og);
    }

    // Utility: display a next-user toast
    function nextUserIdToast(name) {
      showToast('First user created: ' + name + ' (admin auto-assigned if none existed)');
    }

    // Boot
    let currentUserId = null;
    init();

  </script>
</body>
</html>