<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>TinyVibe Onboarding Deluxe</title>
  <style>
    :root{
      --bg: #0b1020;
      --card: #0f1320;
      --text: #e8e7f5;
      --muted: #a8a8b8;
      --ring: 2px;
      --focus: 3px;
      --accent: #7c3aed; /* violet-600 */
      --accent-2: #06b6d4; /* cyan-500 */
      --shadow: 0 12px 30px rgba(0,0,0,.35);
      --surface: rgba(255,255,255,.04);
      --panel: rgba(2,6,23,.5);
      --glow: 0 0 20px rgba(124,58,237,.6);
    }

    [data-theme="light"] {
      --bg: #f7f7fb;
      --card: #ffffff;
      --text: #111827;
      --muted: #6b7280;
      --surface: rgba(0,0,0,.04);
      --panel: rgba(255,255,255,.6);
      --glow: 0 0 14px rgba(0,0,0,.08);
    }

    html { box-sizing: border-box; }
    *, *::before, *::after { box-sizing: inherit; }
    body {
      margin: 0;
      background: var(--bg);
      color: var(--text);
      font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto;
      line-height: 1.5;
      min-height: 100vh;
      display: grid;
      align-items: center;
      justify-items: center;
      padding: 2rem;
      overflow: hidden;
    }

    /* Background canvas for parallax particles */
    #bg {
      position: fixed;
      z-index: 0;
      top: 0; left: 0;
      width: 100vw; height: 100vh;
      display: block;
      /* subtle vignette to keep focus on card */
      background: radial-gradient( circle at 50% 0%, rgba(124,58,237,.25), transparent 40% ),
                  radial-gradient( circle at 0% 100%, rgba(6,182,212,.15), transparent 40% );
    }

    /* Focus visibility for keyboard users */
    :focus-visible {
      outline: 3px solid #22c55e;
      outline-offset: 2px;
      border-radius: 6px;
    }

    main[role="main"] {
      width: 100%;
      max-width: 980px;
      z-index: 1;
    }

    .card {
      background: var(--card);
      border-radius: 18px;
      padding: 1.75rem;
      box-shadow: var(--shadow);
      border: 1px solid rgba(255,255,255,.08);
      backdrop-filter: saturate(1.1) blur(2px);
      position: relative;
      overflow: hidden;
      transform-style: preserve-3d;
      transition: transform .2s ease;
    }
    .card:hover {
      transform: translateY(-2px) scale(1.01);
      box-shadow: 0 20px 40px rgba(0,0,0,.18);
    }

    /* Subtle vibe bar at the top for aesthetics */
    .vibe-bar {
      height: 8px;
      border-radius: 6px;
      background: linear-gradient(90deg, rgba(124,58,237,.95), rgba(14,165,233,.95));
      margin-bottom: 0.75rem;
      box-shadow: inset 0 1px 0 rgba(255,255,255,.6);
    }

    .row { display: flex; gap: 12px; align-items: center; }

    .orb {
      width: 42px; height: 42px;
      display: inline-block;
      vertical-align: middle;
      border-radius: 50%;
      background: radial-gradient(circle at 30% 30%, #fda4af 0%, #f472b6 25%, #a78bfa 60%, #60a5fa 100%);
      box-shadow: inset 0 0 6px rgba(255,255,255,.5), 0 2px 10px rgba(0,0,0,.15);
    }

    h1 {
      margin: 0;
      font-size: 1.8rem;
      line-height: 1.2;
    }

    h2 {
      font-size: 1.1rem;
      margin: .25rem 0 0;
      color: var(--muted);
    }

    p { margin: 0.4rem 0 0.65rem; color: var(--muted); }

    /* Stepper / progress */
    .progress {
      height: 8px;
      background: rgba(0,0,0,.06);
      border-radius: 999px;
      overflow: hidden;
      margin: 0.75rem 0 1rem;
    }
    .progress > span {
      display: block;
      height: 100%;
      background: linear-gradient(90deg, var(--accent), var(--accent-2));
      width: 0%;
      transition: width .4s ease;
    }

    /* Buttons & CTA styling (accessible) */
    .cta {
      margin-top: 0.9rem;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: .88rem 1.25rem;
      font-size: 1rem;
      font-weight: 700;
      color: #fff;
      background: linear-gradient(135deg, var(--accent), var(--accent-2));
      border: none;
      border-radius: 999px;
      cursor: pointer;
      text-decoration: none;
      transition: transform .06s ease-in-out, filter .2s ease;
      min-width: 210px;
      user-select: none;
      position: relative;
      overflow: hidden;
    }
    .cta:hover { filter: brightness(1.03); }
    .cta:active { transform: translateY(1px) scale(0.99); }
    .cta:focus-visible {
      outline: 3px solid #1e40af;
      outline-offset: 2px;
    }

    /* Ripple effect for CTA */
    .cta .ripple {
      position: absolute; width: 0; height: 0; border-radius: 50%;
      background: rgba(255,255,255,.5); transform: translate(-50%, -50%);
      pointer-events: none;
      animation: ripple 0.6s ease-out forwards;
    }
    @keyframes ripple {
      from { width: 0; height: 0; opacity: 0.9; }
      to { width: 320px; height: 320px; opacity: 0; }
    }

    /* Layout helpers for accessibility if screen reader is used */
    .sr-only {
      position: absolute; width: 1px; height: 1px;
      padding: 0; margin: -1px;
      overflow: hidden; clip: rect(0,0,0,0);
      white-space: nowrap; border: 0;
    }

    /* Advanced options panel */
    .panel {
      margin-top: 1rem;
      padding: .75rem;
      border-radius: 12px;
      background: var(--panel);
      border: 1px solid rgba(255,255,255,.15);
      display: grid; grid-template-columns: 1fr 1fr; gap: 12px;
    }
    .panel .row { align-items: center; justify-content: space-between; }
    .label { font-size: .92rem; color: var(--muted); }
    .switch {
      display: inline-flex; align-items: center; gap: 8px;
      background: rgba(255,255,255,.08); padding: 6px 10px; border-radius: 999px;
      border: 1px solid rgba(255,255,255,.15);
    }
    .switch input { display: none; }
    .toggle {
      width: 42px; height: 24px; border-radius: 999px;
      background: #374151; position: relative; transition: background .2s;
    }
    .toggle::after {
      content: ""; width: 18px; height: 18px; border-radius: 50%;
      background: white; position: absolute; top: 3px; left: 3px;
      transition: transform .2s;
    }
    input:checked + .toggle { background: #10b981; }
    input:checked + .toggle::after { transform: translateX(18px); }

    /* Mini-game area */
    .mini {
      margin-top: 1rem;
      display: grid; grid-template-columns: 1fr 1fr; gap: 14px;
    }
    .mini .panel {
      padding: 0; background: transparent; border: none;
      display: flex; flex-direction: column; gap: 6px;
    }
    .mini canvas {
      width: 100%; height: 280px; border-radius: 12px;
      background: #0b1220;
      border: 1px solid rgba(255,255,255,.15);
      display: block;
    }
    .mini .stats { display: flex; justify-content: space-between; align-items: center; padding: 6px 4px; font-size: .92rem; color: var(--muted); }
    .mini .btns { display: flex; gap: 8px; justify-content: flex-end; padding: 0 4px 6px; }
    .mini .button {
      padding: 6px 10px; border-radius: 8px; border: 1px solid rgba(255,255,255,.2);
      background: rgba(255,255,255,.04); color: #e5e7eb; cursor: pointer;
    }
    @media (max-width: 860px) {
      .panel { grid-template-columns: 1fr; }
      .mini { grid-template-columns: 1fr; }
    }

    /* Tiny sparkles in the background for depth */
    .sparkles {
      position: fixed; pointer-events: none; z-index: 0;
      width: 100%; height: 100%; overflow: hidden;
      mix-blend-mode: screen; opacity: .5;
    }

    /* Accent animation on the leading orb next to title */
    @keyframes floaty {
      0% { transform: translateY(0px); }
      50% { transform: translateY(-6px); }
      100% { transform: translateY(0px); }
    }
    .orb.float { animation: floaty 2.4s ease-in-out infinite; }

  </style>
</head>
<body>
  <canvas id="bg" aria-hidden="true"></canvas>

  <div class="sparkles" aria-hidden="true"></div>

  <main role="main" aria-label="TinyVibe onboarding main content">
    <section class="card" role="region" aria-labelledby="title" aria-describedby="desc">
      <div class="vibe-bar" aria-hidden="true"></div>

      <div class="row" style="gap: .75rem;">
        <span class="orb float" aria-hidden="true"></span>
        <div>
          <h1 id="title" style="margin:0;">Hi, welcome to TinyVibe!</h1>
          <p id="subtitle" style="margin:0; color:var(--muted);">A playful onboarding with a tiny game, settings, and smooth vibes.</p>
        </div>
      </div>

      <div class="progress" aria-label="Onboarding progress">
        <span id="progress" style="width: 0%;"></span>
      </div>

      <div id="steps" aria-live="polite" style="margin-top:.25rem;">
        <!-- Step content injected by JS -->
      </div>

      <div class="panel" id="advancedPanel" style="display:none;">
        <div class="row" style="grid-column: 1 / -1;">
          <div class="label">Advanced Options</div>
          <button id="togglePanel" class="button" style="padding:6px 10px;border-radius:8px;">Hide</button>
        </div>

        <div class="row" style="align-items:center;">
          <div class="label" style="flex:1 1 auto;">Motion speed</div>
          <input id="motionRange" type="range" min="0.3" max="2" step="0.05" value="1" style="width:100%;">
        </div>

        <div class="row" style="align-items:center;">
          <div class="label" style="flex:1 1 auto;">Accent color</div>
          <div class="switch" aria-label="Accent color">
            <label style="display:flex;gap:6px;align-items:center;">
              <span style="width:14px;height:14px;border-radius:50%;background:#7c3aed;border:1px solid #fff;display:inline-block"></span>
              <input id="accentBlue" type="checkbox" />
              <span class="toggle"></span>
              <span style="font-size:.9rem;color:var(--muted);">Blue-ish</span>
            </label>
          </div>
        </div>

        <div class="row" style="align-items:center;">
          <div class="label" style="flex:1 1 auto;">Sound</div>
          <div class="switch" aria-label="Sound on/off">
            <label style="display:flex;gap:6px;align-items:center;">
              <input id="soundToggle" type="checkbox" checked />
              <span class="toggle"></span>
              <span style="font-size:.9rem;color:var(--muted);">Enabled</span>
            </label>
          </div>
        </div>

      </div>

      <div class="mini" aria-label="Mini-game area inside onboarding">
        <div class="panel" style="padding:0.75rem;">
          <h2 style="margin:0 0 6px;font-size:1rem;">Mini-game: Coin Catch</h2>
          <p class="note" style="margin:0 0 6px;">Click the coins as they appear to score points. Survive for 15 seconds!</p>
          <div class="stats" style="border-radius:8px; background: rgba(0,0,0,.12); padding:6px 8px;">
            <span>Score: <strong id="score">0</strong></span>
            <span>Best: <strong id="best">—</strong></span>
            <span>Time: <strong id="timeLeft">15</strong>s</span>
          </div>
          <div class="btns" style="margin-top:6px;">
            <button id="startGame" class="button" style="background: linear-gradient(135deg, #10b981, #3b82f6);">Start Game</button>
            <button id="pauseGame" class="button" style="opacity:.8;">Pause</button>
          </div>
        </div>

        <div class="panel" style="padding:0.75rem;">
          <canvas id="miniCanvas" width="640" height="360" style="width:100%; height: auto; border-radius:12px; background:#0b1220; border:1px solid rgba(255,255,255,.15);"></canvas>
        </div>
      </div>

      <div style="display:flex; gap:12px; align-items:center; justify-content: space-between; margin-top: 12px;">
        <span class="sr-only" aria-live="polite">Tip: You can press S to toggle sound, M to toggle motion, and N for next step.</span>
        <div style="display:flex; gap:8px;">
          <button id="nextBtn" class="cta" aria-label="Next onboarding step" style="min-width:120px;">
            Next
          </button>
          <button id="launchBtn" class="cta" aria-label="Launch game" style="min-width:180px; display:none;">
            Launch Game
          </button>
        </div>
      </div>

      <div class="sr-only" id="kbdHint" aria-live="polite">Keyboard shortcuts: N for Next, S to toggle sound, M to toggle motion.</div>
    </section>
  </main>

  <script>
    // Canvas background particles
    (function initBackground(){
      const canvas = document.getElementById('bg');
      const ctx = canvas.getContext('2d');
      const DPR = Math.max(window.devicePixelRatio || 1, 1);
      let w = canvas.width = innerWidth;
      let h = canvas.height = innerHeight;
      const particles = [];
      const count = Math.floor((w*h)/9000);
      const colors = ['#4f46e5','#14b8a6','#f472b6','#f59e0b','#10b981'];

      function spawn(){
        for(let i=0;i<Math.max(40,count);i++){
          particles.push({
            x: Math.random()*w,
            y: Math.random()*h,
            r: Math.random()*2.5 + 0.5,
            vx: (Math.random()-0.5)*0.6,
            vy: (Math.random()-0.5)*0.6,
            color: colors[i % colors.length],
            life: Math.random()*60
          });
        }
      }

      function resize(){
        w = canvas.width = innerWidth;
        h = canvas.height = innerHeight;
      }
      window.addEventListener('resize', resize);

      spawn();

      function loop(){
        ctx.clearRect(0,0,w,h);
        for(let p of particles){
          p.x += p.vx * DPR * 1.2;
          p.y += p.vy * DPR * 1.2;
          if(p.x < -10) p.x = w+10;
          if(p.y < -10) p.y = h+10;
          if(p.x > w+10) p.x = -10;
          if(p.y > h+10) p.y = -10;
          // subtle twinkle
          p.life -= 1;
          if(p.life < 0) p.life = Math.random()*60;
          const a = (Math.sin((p.life)/10)+1)/2;
          ctx.globalAlpha = 0.45 + a*0.5;
          ctx.fillStyle = p.color;
          ctx.beginPath();
          ctx.arc(p.x, p.y, p.r, 0, Math.PI*2);
          ctx.fill();
        }
        ctx.globalAlpha = 1;
        requestAnimationFrame(loop);
      }
      loop();
    })();

    // Onboarding flow and mini-game logic
    (function(){
      // Elements
      const stepsEl = document.getElementById('steps');
      const progress = document.getElementById('progress');
      const nextBtn = document.getElementById('nextBtn');
      const launchBtn = document.getElementById('launchBtn');
      const advancedPanel = document.getElementById('advancedPanel');
      const togglePanelBtn = document.getElementById('togglePanel');
      const motionRange = document.getElementById('motionRange');
      const soundToggle = document.getElementById('soundToggle');
      const accentBlue = document.getElementById('accentBlue');

      // Mini-game elements
      const scoreEl = document.getElementById('score');
      const bestEl = document.getElementById('best');
      const timeLeftEl = document.getElementById('timeLeft');
      const startGameBtn = document.getElementById('startGame');
      const pauseGameBtn = document.getElementById('pauseGame');
      const miniCanvas = document.getElementById('miniCanvas');
      const miniCtx = miniCanvas.getContext('2d');
      let miniW = miniCanvas.width, miniH = miniCanvas.height;

      let gameRunning = false;
      let gamePaused = false;
      let score = 0, best = 0, timeLeft = 15;
      let coins = []; // coins: {x,y,r}
      let gameTimer = null;
      let coinTimer = null;
      let gameReq = null;

      // Audio context for beeps
      let audioCtx = null;
      let soundOn = true;
      function ensureAudio(){
        if(!audioCtx){
          const ctx = new (window.AudioContext || window.webkitAudioContext)();
          audioCtx = ctx;
        }
        return audioCtx;
      }
      function beep(freq=440, dur=0.1, vol=0.2){
        if(!soundOn) return;
        const ctx = ensureAudio();
        const o = ctx.createOscillator();
        const g = ctx.createGain();
        o.connect(g); g.connect(ctx.destination);
        o.frequency.value = freq;
        o.type = 'triangle';
        g.gain.value = vol;
        const t = ctx.currentTime;
        g.gain.setValueAtTime(vol, t);
        g.gain.exponentialRampToValueAtTime(0.0001, t + dur);
        o.start(t);
        o.stop(t + dur);
      }

      // Stepper setup
      const steps = [
        {
          title: 'Welcome',
          body: 'Thanks for joining TinyVibe. We will guide you through a quick setup and a tiny game to warm up.'
        },
        {
          title: 'Personalize',
          body: 'Fine-tune motion, color accents, and sound. Your preferences are saved locally.'
        },
        {
          title: 'Challenge',
          body: 'Play a quick coin-collection mini-game. Then you can launch the main game.'
        }
      ];

      let currentStep = 0;
      function renderStep(){
        stepsEl.innerHTML = '';
        const s = steps[currentStep];
        const card = document.createElement('div');
        card.style.padding = '8px 0';
        card.innerHTML = `
          <h2 style="margin:0 0 6px;">${s.title}</h2>
          <p>${s.body}</p>
        `;
        stepsEl.appendChild(card);

        // simulate progress
        const pct = ((currentStep+1)/steps.length)*100;
        progress.style.width = pct + '%';
        if(currentStep === steps.length-1){
          launchBtn.style.display = 'inline-flex';
          nextBtn.style.display = 'none';
        } else {
          launchBtn.style.display = 'none';
          nextBtn.style.display = 'inline-flex';
        }
      }

      function toNextStep(){
        if(currentStep < steps.length - 1){
          currentStep++;
          renderStep();
          if(currentStep === steps.length - 1){
            // small nudge
            beep(660, .08, 0.18);
          } else {
            beep(520, .08, 0.15);
          }
        }
      }

      // Initialize steps
      renderStep();

      // Advanced panel toggle
      togglePanelBtn.addEventListener('click', function(){
        if(advancedPanel.style.display === 'none' || advancedPanel.style.display === ''){
          advancedPanel.style.display = 'grid';
          togglePanelBtn.textContent = 'Hide';
        } else {
          advancedPanel.style.display = 'none';
          togglePanelBtn.textContent = 'Show';
        }
      });

      // Motion adjust
      motionRange.addEventListener('input', function(){
        // use for visuals: adjust CSS gently
        const v = parseFloat(motionRange.value);
        document.documentElement.style.setProperty('--glow', `0 0 ${8 + v*6}px rgba(124,58,237,.6)`);
        // also adjust particle speed via global variable (simplified)
        // We'll apply by dispatching a custom event (not necessary heavy)
        window.dispatchEvent(new CustomEvent('motionChange', {detail: {speed: v}}));
      });

      // Accent color toggle (simple immediate feedback)
      accentBlue.addEventListener('change', function(){
        // not persisting a lot; just toggle gradient hue
        if(accentBlue.checked){
          document.documentElement.style.setProperty('--accent', '#3b82f6');
          document.documentElement.style.setProperty('--accent-2', '#a78bfa');
        } else {
          document.documentElement.style.setProperty('--accent', '#7c3aed');
          document.documentElement.style.setProperty('--accent-2', '#10b981');
        }
      });

      // Sound toggle
      soundToggle.addEventListener('change', function(){
        soundOn = !!soundToggle.checked;
        localStorage.setItem('tv_sound', soundOn ? '1' : '0');
      });

      // Start/pause mini-game
      startGameBtn.addEventListener('click', startMiniGame);
      pauseGameBtn.addEventListener('click', pauseMiniGame);

      // Keyboard shortcuts
      window.addEventListener('keydown', function(e){
        if(e.key.toLowerCase() === 'n'){ nextBtn.click(); }
        if(e.key.toLowerCase() === 's'){ soundToggle.click(); }
        if(e.key.toLowerCase() === 'm'){ motionRange.focus(); }
      });

      // Next/Launch buttons
      nextBtn.addEventListener('click', function(){
        toNextStep();
        // visual click feedback
        const r = document.createElement('span');
        r.className = 'ripple';
        const btnRect = nextBtn.getBoundingClientRect();
        r.style.left = (btnRect.width/2) + 'px';
        r.style.top = (btnRect.height/2) + 'px';
        nextBtn.appendChild(r);
        beep(520, .08, 0.25);
      });

      launchBtn.addEventListener('click', function(){
        window.open('https://example.com', '_self');
      });

      // Persist simple settings
      function loadSettings(){
        // sound
        const s = localStorage.getItem('tv_sound');
        if(s !== null){
          const on = s === '1';
          soundOn = on;
          if(soundOn){
            soundToggle.checked = true;
          } else {
            soundToggle.checked = false;
          }
        }
      }
      loadSettings();

      // Mini-game loop
      let coinsPerSpawn = 1;
      function spawnCoin(){
        const x = Math.random() * (miniW - 20) + 10;
        const y = Math.random() * (miniH - 20) + 10;
        const r = 9 + Math.random()*6;
        coins.push({x,y,r,life:60});
      }

      function resetMiniCanvas(){
        miniW = miniCanvas.width = miniCanvas.clientWidth;
        miniH = miniCanvas.height = Math.max(240, miniCanvas.clientHeight);
      }
      window.addEventListener('resize', resetMiniCanvas);
      resetMiniCanvas();

      // click to collect
      miniCanvas.addEventListener('click', function(e){
        const rect = miniCanvas.getBoundingClientRect();
        const px = e.clientX - rect.left;
        const py = e.clientY - rect.top;
        for(let i=coins.length-1; i>=0; i--){
          const c = coins[i];
          const dx = px - c.x;
          const dy = py - c.y;
          if(dx*dx + dy*dy <= c.r*c.r){
            coins.splice(i,1);
            score += 1;
            scoreEl.textContent = score;
            beep(800, 0.07, 0.18);
            break;
          }
        }
      });

      function drawMini(){
        miniCtx.clearRect(0,0,miniW,miniH);
        // gentle background gradient
        const g = miniCtx.createLinearGradient(0,0,miniW, miniH);
        g.addColorStop(0, '#0b1220');
        g.addColorStop(1, '#0b1a2a');
        miniCtx.fillStyle = g;
        miniCtx.fillRect(0,0,miniW, miniH);

        // coins
        for(let c of coins){
          miniCtx.beginPath();
          const grd = miniCtx.createRadialGradient(c.x - c.r/3, c.y - c.r/3, 2, c.x, c.y, c.r);
          grd.addColorStop(0, '#fff');
          grd.addColorStop(1, '#ffd36b');
          miniCtx.fillStyle = grd;
          miniCtx.arc(c.x, c.y, c.r, 0, Math.PI*2);
          miniCtx.fill();
          // subtle outline
          miniCtx.strokeStyle = 'rgba(255,255,255,.6)';
          miniCtx.lineWidth = 1;
          miniCtx.stroke();
        }

        // time bar
        if(gameRunning){
          miniCtx.fillStyle = 'rgba(255,255,255,.25)';
          miniCtx.fillRect(10, miniH-14, miniW-20, 4);
          const tW = Math.max(0, (timeLeft / 15) * (miniW-20));
          miniCtx.fillStyle = '#22c55e';
          miniCtx.fillRect(10, miniH-14, tW, 4);
        }
      }

      function gameLoop(){
        if(gameRunning && !gamePaused){
          // spawn logic
          if(coins.length < 12){
            spawnCoin();
          }
        }
        // decay life
        for(let i=coins.length-1;i>=0;i--){
          if(coins[i].life-- <= 0){
            coins.splice(i,1);
          }
        }

        drawMini();
        gameReq = requestAnimationFrame(gameLoop);
      }

      function startMiniGame(){
        if(gameRunning) return;
        gameRunning = true;
        gamePaused = false;
        score = 0;
        timeLeft = 15;
        coins = [];
        scoreEl.textContent = score;
        timeLeftEl.textContent = timeLeft;
        if(audioCtx){
          // small beep to start
          beep(440, .08, .25);
        }
        // timer
        if(gameTimer) clearInterval(gameTimer);
        gameTimer = setInterval(function(){
          timeLeft--;
          timeLeftEl.textContent = timeLeft;
          if(timeLeft <= 0){
            endMiniGame();
          }
        }, 1000);
        // spawn coins for a second
        if(coinTimer) clearInterval(coinTimer);
        coinTimer = setInterval(spawnCoin, 800);
      }

      function pauseMiniGame(){
        if(!gameRunning) return;
        gamePaused = !gamePaused;
        if(gamePaused){
          beep(300, .08, .2);
        } else {
          beep(520, .08, .22);
        }
      }

      function endMiniGame(){
        gameRunning = false;
        clearInterval(gameTimer);
        clearInterval(coinTimer);
        if(best < score) best = score;
        bestEl.textContent = best;
        beep(600, .12, 0.28);
      }

      // start loop
      gameLoop();

      // Start/Stop controls
      startGameBtn.addEventListener('click', startMiniGame);

      // initial best from localStorage
      const storedBest = localStorage.getItem('tv_best');
      if(storedBest !== null){
        best = parseInt(storedBest, 10);
        bestEl.textContent = best;
      } else {
        bestEl.textContent = '—';
      }
      // persist best on change
      function commitBest(){
        localStorage.setItem('tv_best', String(best));
      }

      // Save best when the page unloads or score updates to ensure it persists
      window.addEventListener('beforeunload', commitBest);
      // update best when end occurs
      function endMiniGameAndPersist(){
        if(score > best){
          best = score;
          bestEl.textContent = best;
          commitBest();
        }
      }
      // hook: whenever time ends
      // We'll poll for end by timeLeft === 0 in endMiniGame
      // call endMiniGameAndPersist at end
      const originalEnd = endMiniGame;
      endMiniGame = function(){
        originalEnd();
        endMiniGameAndPersist();
      }

    })();

    // Accessibility hints (resize tweaks)
    window.addEventListener('resize', () => {
      // re-evaluate canvas sizes for main card parallax if needed
    });

  </script>
</body>
</html>