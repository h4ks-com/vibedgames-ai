<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>PuppyTimer</title>
<style>
  :root{
    --bg:#0f1724;
    --card:#0b1220;
    --accent:#ffb86b;
    --accent-2:#7ee7c7;
    --muted:#9aa4b2;
    --glass: rgba(255,255,255,0.04);
    --glass-2: rgba(255,255,255,0.02);
    --glass-3: rgba(0,0,0,0.4);
    --glass-border: rgba(255,255,255,0.04);
  }

  *{box-sizing:border-box; font-family: Inter,ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial; -webkit-tap-highlight-color: transparent;}
  html,body{height:100%; margin:0; background: radial-gradient(1000px 600px at 10% 10%, rgba(126,231,199,0.06), transparent), linear-gradient(180deg,#071124 0%, #071022 50%, #03101a 100%), var(--bg); color:#e6eef6; -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;}

  .wrap{
    max-width:1100px;
    margin:28px auto;
    padding:20px;
    display:grid;
    grid-template-columns: 1fr 420px;
    gap:20px;
  }

  header{
    grid-column:1/-1;
    display:flex;
    align-items:center;
    gap:12px;
    margin-bottom:4px;
  }

  .logo{
    width:58px;
    height:58px;
    border-radius:14px;
    background:linear-gradient(135deg,var(--accent),#ff7ab6);
    display:flex;
    align-items:center;
    justify-content:center;
    box-shadow: 0 6px 30px rgba(0,0,0,0.6), inset 0 -6px 20px rgba(255,255,255,0.06);
    flex-shrink:0;
  }

  .logo svg{filter:drop-shadow(0 6px 18px rgba(255,184,107,0.12));}

  h1{font-size:20px; margin:0; letter-spacing:0.2px;}
  .sub{font-size:13px; color:var(--muted); margin-top:3px;}

  /* Left "panel" */
  .card{
    background: linear-gradient(180deg, rgba(255,255,255,0.02), transparent);
    border-radius:14px;
    padding:18px;
    box-shadow: 0 6px 30px rgba(0,0,0,0.6);
    border:1px solid var(--glass-border);
  }

  .timer-wrap{
    display:flex;
    gap:16px;
    align-items:center;
    flex-wrap:wrap;
  }

  .display{
    flex:1 1 260px;
    background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
    border-radius:12px;
    padding:18px;
    display:flex;
    flex-direction:column;
    gap:12px;
    justify-content:space-between;
  }

  .time{
    font-size:48px;
    font-weight:700;
    letter-spacing:1px;
    display:flex;
    gap:8px;
    align-items:baseline;
  }
  .time small{font-size:14px; color:var(--muted); font-weight:600;}

  .controls{
    display:flex;
    gap:10px;
    align-items:center;
    flex-wrap:wrap;
  }

  .bigbtn{
    background:linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.01));
    border:1px solid var(--glass-border);
    color:var(--accent-2);
    padding:14px 18px;
    border-radius:12px;
    cursor:pointer;
    display:inline-flex;
    gap:10px;
    align-items:center;
    font-weight:700;
    font-size:15px;
    transition:transform .12s ease, box-shadow .12s;
  }

  .bigbtn:active{transform:translateY(2px);}

  .start{
    background: linear-gradient(90deg,var(--accent-2), #6be0c6);
    color:#05211a;
    box-shadow: 0 8px 26px rgba(19,180,148,0.12), inset 0 -8px 36px rgba(255,255,255,0.04);
  }

  .small{
    padding:8px 12px; font-weight:600; font-size:13px;
    background:transparent; color:var(--muted); border:1px solid transparent;
  }

  .mode-switch{
    display:flex; gap:6px; background:var(--glass-2); padding:6px; border-radius:10px;
  }
  .mode-switch button{
    background:transparent; color:var(--muted); border:0; padding:8px 12px; border-radius:8px; cursor:pointer; font-weight:700;
  }
  .mode-switch button.active{ background:linear-gradient(90deg,var(--accent-2), #9be3d4); color:#07221b; box-shadow:0 6px 18px rgba(15,140,114,0.06); }

  .inputs{
    display:flex; gap:8px; align-items:center; flex-wrap:wrap;
  }
  .inputs input[type=number]{
    width:86px; padding:8px 12px; border-radius:10px; border:1px solid var(--glass-border); background:transparent; color:inherit; font-weight:700;
  }

  .tools{
    margin-top:12px; display:flex; gap:10px; flex-wrap:wrap; align-items:center;
  }

  .tool{
    padding:8px 12px; border-radius:10px; background:var(--glass-2); color:var(--muted); font-weight:700; font-size:13px; cursor:pointer; border:1px solid transparent;
  }

  .laps{
    margin-top:12px; max-height:160px; overflow:auto; padding:10px; border-radius:10px; background:linear-gradient(180deg, rgba(255,255,255,0.01), transparent); border:1px dashed rgba(255,255,255,0.02);
  }
  .laps .lap{display:flex;justify-content:space-between;padding:8px 6px;border-bottom:1px dashed rgba(255,255,255,0.02); font-size:13px;}
  .laps .lap:last-child{border-bottom:0;}

  /* Right panel - photo */
  .photo-card{
    display:flex;
    flex-direction:column;
    gap:12px;
    position:relative;
  }
  .photo{
    background:linear-gradient(180deg, rgba(0,0,0,0.2), rgba(0,0,0,0.05));
    border-radius:14px;
    overflow:hidden;
    min-height:360px;
    display:flex;
    align-items:center;
    justify-content:center;
    position:relative;
    border:1px solid rgba(255,255,255,0.03);
  }
  .photo img{
    width:100%; height:100%; object-fit:cover; display:block; transform-origin:center center; transition: transform .9s cubic-bezier(.2,.9,.2,1);
    pointer-events:none; user-select:none;
  }
  .breed-tag{
    position:absolute;
    left:12px; bottom:12px;
    background:linear-gradient(90deg, rgba(0,0,0,0.55), rgba(0,0,0,0.25));
    padding:8px 12px; border-radius:999px; font-weight:700; font-size:13px; color:#fff; backdrop-filter: blur(6px);
    border:1px solid rgba(255,255,255,0.03);
  }

  .photo .actions{
    position:absolute; right:12px; top:12px; display:flex; gap:8px;
  }
  .iconbtn{
    background:rgba(0,0,0,0.35); border-radius:10px; padding:8px; display:inline-flex; align-items:center; justify-content:center; cursor:pointer; border:1px solid rgba(255,255,255,0.03);
  }
  .info{
    display:flex; gap:10px; align-items:center; justify-content:space-between;
  }
  .info .left{font-size:13px; color:var(--muted);}
  .info .right{display:flex; gap:8px; align-items:center;}

  .credits{font-size:12px; color:var(--muted); text-align:center; margin-top:6px;}

  /* Responsive */
  @media (max-width:980px){
    .wrap{grid-template-columns:1fr; padding:14px;}
    .photo{min-height:290px;}
  }

  /* playful pulses */
  .pulse{
    animation: pulse 1s ease-in-out;
  }
  @keyframes pulse {
    0%{ box-shadow: 0 0 0 0 rgba(255,184,107,0.6); transform:scale(1); }
    50%{ box-shadow: 0 0 0 18px rgba(255,184,107,0.06); transform:scale(1.02); }
    100%{ box-shadow:0 0 0 0 rgba(255,184,107,0); transform:scale(1); }
  }

  /* small helpers */
  .muted{color:var(--muted); font-size:13px;}
  .hidden{display:none!important;}
  .rounded{border-radius:10px;}
</style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="logo" aria-hidden="true">
        <svg width="32" height="32" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M6 10c0 2.5 2 4.6 4.5 4.6S15 12.5 15 10" stroke="#08221B" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round"/>
          <circle cx="8.5" cy="6.5" r="1.6" fill="#05221a"/>
          <circle cx="15.5" cy="6.5" r="1.6" fill="#05221a"/>
          <path d="M12 20c-2.2 0-4.2-.9-5.6-2.3C5 16.4 4 14.4 4 12" stroke="#08221B" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </div>
      <div>
        <h1>PuppyTimer</h1>
        <div class="sub">A playful stopwatch + interval picture fetcher. Random dog pics to brighten your timing.</div>
      </div>
      <div style="margin-left:auto;display:flex;gap:8px;align-items:center">
        <button id="fetchNow" class="bigbtn small" title="Fetch new puppy">New Pupp y üê∂</button>
        <button id="shareBtn" class="bigbtn small" title="Share current picture/time">Share</button>
      </div>
    </header>

    <section class="card">
      <div class="timer-wrap">
        <div class="display">
          <div style="display:flex;justify-content:space-between;align-items:center;gap:12px;">
            <div>
              <div class="time" id="timeDisplay">00:00:00<small id="ms" style="margin-left:6px;opacity:.6;font-size:12px">.000</small></div>
              <div class="muted" id="modeLabel">Mode: Stopwatch</div>
            </div>
            <div>
              <div style="display:flex;gap:10px;flex-direction:row;align-items:center;">
                <div class="mode-switch" role="tablist" aria-label="Mode">
                  <button class="active" data-mode="stopwatch">Stopwatch</button>
                  <button data-mode="countdown">Countdown</button>
                  <button data-mode="interval">Interval</button>
                </div>
              </div>
            </div>
          </div>

          <div class="controls">
            <button id="startBtn" class="bigbtn start" aria-pressed="false">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M5 3v18l15-9L5 3z" fill="currentColor"/></svg>
              Start
            </button>
            <button id="pauseBtn" class="bigbtn small" disabled>
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none"><path d="M6 5h4v14H6zM14 5h4v14h-4z" fill="currentColor"/></svg>
              Pause
            </button>
            <button id="resetBtn" class="bigbtn small">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none"><path d="M12 6v1a5 5 0 1 0 5 5h-1" stroke="currentColor" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round"/></svg>
              Reset
            </button>

            <div style="flex:1"></div>

            <div class="inputs" id="countInputs" style="display:none;">
              <input type="number" id="minInput" min="0" value="0" aria-label="Minutes" />
              <input type="number" id="secInput" min="0" max="59" value="30" aria-label="Seconds" />
            </div>

            <div class="inputs" id="intervalInputs" style="display:none;">
              <input type="number" id="intSec" min="2" value="10" aria-label="Interval seconds" />
              <div class="muted">sec</div>
            </div>
          </div>

          <div class="tools">
            <button id="lapBtn" class="tool" disabled>Lap</button>
            <button id="clearLaps" class="tool">Clear Laps</button>
            <button id="setAlarm" class="tool">Bell On</button>
            <button id="vibrateBtn" class="tool">Vibrate</button>
            <button id="mutebtn" class="tool">Mute üîà</button>
          </div>

          <div class="laps" id="lapsList" aria-live="polite">
            <!-- laps -->
          </div>
        </div>

        <div style="width:420px; min-width:240px;" class="photo-card card">
          <div class="photo rounded" id="photoCard" aria-live="polite" role="img" aria-label="Random dog picture">
            <img id="dogImage" src="" alt="Random dog" />
            <div class="breed-tag" id="breedTag">Fetching...</div>

            <div class="actions">
              <div class="iconbtn" id="zoomBtn" title="Zoom">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M21 21l-4.35-4.35" stroke="#fff" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round"/><path d="M11 19a8 8 0 1 1 0-16 8 8 0 0 1 0 16z" stroke="#fff" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round"/></svg>
              </div>
              <div class="iconbtn" id="downloadBtn" title="Download">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" stroke="#fff" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round"/><path d="M7 10l5 5 5-5" stroke="#fff" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round"/><path d="M12 15V3" stroke="#fff" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round"/></svg>
              </div>
            </div>
          </div>

          <div class="info">
            <div class="left">
              <div id="imageInfo">Random pup</div>
              <div class="muted">Source: dog.ceo API</div>
            </div>
            <div class="right">
              <div class="muted">Interval:</div>
              <div id="currentInterval" class="muted">‚Äî</div>
            </div>
          </div>

          <div class="credits">Tip: switch to Interval mode for automatic picture changes while timing. Tap "New Puppy" anytime.</div>
        </div>
      </div>
    </section>

    <footer style="grid-column:1/-1; text-align:center; color:var(--muted); font-size:12px; margin-top:6px;">
      Pupp y Timer ‚Äî made for cute focus sessions üêæ
    </footer>
  </div>

<script>
(() => {
  const API = 'https://dog.ceo/api/breeds/image/random';

  // UI refs
  const startBtn = document.getElementById('startBtn');
  const pauseBtn = document.getElementById('pauseBtn');
  const resetBtn = document.getElementById('resetBtn');
  const lapBtn = document.getElementById('lapBtn');
  const lapsList = document.getElementById('lapsList');
  const clearLaps = document.getElementById('clearLaps');
  const timeDisplay = document.getElementById('timeDisplay');
  const msDisplay = document.getElementById('ms');
  const modeSwitch = document.querySelectorAll('.mode-switch button');
  const modeLabel = document.getElementById('modeLabel');
  const countInputs = document.getElementById('countInputs');
  const intervalInputs = document.getElementById('intervalInputs');
  const minInput = document.getElementById('minInput');
  const secInput = document.getElementById('secInput');
  const intSec = document.getElementById('intSec');
  const fetchNow = document.getElementById('fetchNow');
  const dogImage = document.getElementById('dogImage');
  const breedTag = document.getElementById('breedTag');
  const photoCard = document.getElementById('photoCard');
  const currentIntervalEl = document.getElementById('currentInterval');
  const zoomBtn = document.getElementById('zoomBtn');
  const downloadBtn = document.getElementById('downloadBtn');
  const setAlarmBtn = document.getElementById('setAlarm');
  const vibrateBtn = document.getElementById('vibrateBtn');
  const muteBtn = document.getElementById('mutebtn');
  const shareBtn = document.getElementById('shareBtn');

  // state
  let mode = 'stopwatch'; // stopwatch | countdown | interval
  let running = false;
  let startTime = 0, elapsed = 0, rafId = null;
  let laps = [];
  let alarmOn = true;
  let vibrateOn = false;
  let muted = false;
  let intervalTimer = null;
  let intervalSeconds = 10;
  let countdownTarget = 0;

  // audio via WebAudio
  const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

  function beep(freq = 880, duration = 0.18, type = 'sine', gain = 0.12){
    if(muted) return;
    try {
      const o = audioCtx.createOscillator();
      const g = audioCtx.createGain();
      o.type = type;
      o.frequency.value = freq;
      g.gain.value = gain;
      o.connect(g);
      g.connect(audioCtx.destination);
      o.start();
      g.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime + duration);
      o.stop(audioCtx.currentTime + duration + 0.01);
    } catch (e) { /* ignore */ }
  }

  function playEndSound(){
    if(muted) return;
    // playful sequence
    beep(440, 0.12, 'sine', 0.1);
    setTimeout(()=>beep(660, 0.16, 'sine', 0.14), 120);
    setTimeout(()=>beep(880, 0.26, 'sawtooth', 0.16), 300);
  }

  // helpers
  function pad(n, l=2){ return String(n).padStart(l,'0'); }
  function formatTime(ms){
    const total = Math.max(0, Math.floor(ms));
    const hours = Math.floor(total/3600000);
    const mins = Math.floor(total%3600000/60000);
    const secs = Math.floor(total%60000/1000);
    const msecs = total % 1000;
    return {hours, mins, secs, msecs,
            str: `${pad(hours)}:${pad(mins)}:${pad(secs)}`};
  }

  function setMode(m){
    mode = m;
    modeSwitch.forEach(b => b.classList.toggle('active', b.dataset.mode === m));
    modeLabel.textContent = 'Mode: ' + (m === 'stopwatch' ? 'Stopwatch' : (m === 'countdown' ? 'Countdown' : 'Interval'));
    countInputs.style.display = (m === 'countdown') ? 'flex' : 'none';
    intervalInputs.style.display = (m === 'interval') ? 'flex' : 'none';
    currentIntervalEl.textContent = (m === 'interval') ? `${intervalSeconds}s` : '‚Äî';
    lapBtn.disabled = (m !== 'stopwatch') || !running;
  }

  // fetch dog image
  let lastImageUrl = '';
  async function fetchDog(animate=true){
    try {
      const res = await fetch(API);
      const data = await res.json();
      if(data && data.status === 'success'){
        const url = data.message;
        lastImageUrl = url;
        dogImage.src = url;
        dogImage.onload = () => {
          if(animate) {
            dogImage.style.transform = 'scale(1.06)';
            setTimeout(()=> dogImage.style.transform = 'scale(1)', 700);
          }
        };
        breedTag.textContent = parseBreedFromUrl(url) || 'mystery pup';
        document.getElementById('imageInfo').textContent = shortUrl(url);
      }
    } catch (e) {
      breedTag.textContent = 'fetch failed :(';
      document.getElementById('imageInfo').textContent = 'Unable to fetch image';
    }
  }

  function parseBreedFromUrl(url){
    // sample: https://images.dog.ceo/breeds/hound-afghan/n02088094_1003.jpg
    try {
      const parts = url.split('/');
      const i = parts.indexOf('breeds');
      if(i >= 0 && parts[i+1]){
        return parts[i+1].replace('-', ' ').replace(/\//g,' ').toLowerCase();
      }
      return null;
    } catch { return null; }
  }
  function shortUrl(url){
    try {
      const u = new URL(url);
      return u.pathname.split('/').slice(-1)[0];
    } catch { return url; }
  }

  // stopwatch logic
  function tick(){
    const now = performance.now();
    const delta = now - startTime + elapsed;
    const t = formatTime(delta);
    timeDisplay.textContent = t.str;
    msDisplay.textContent = '.' + pad(t.msecs,3);
    // handle countdown mode check
    if(mode === 'countdown'){
      const remaining = Math.max(0, countdownTarget - delta);
      const tr = formatTime(remaining);
      timeDisplay.textContent = tr.str;
      msDisplay.textContent = '.' + pad(tr.msecs,3);
      if(remaining <= 10 && !document.body.classList.contains('pulse-active')) {
        // subtle pulse as approaching zero
        document.getElementById('photoCard').classList.add('pulse');
        setTimeout(()=>document.getElementById('photoCard').classList.remove('pulse'), 600);
      }
      if(remaining <= 0){
        stopRunning();
        timeUp();
        return;
      }
    }
    rafId = requestAnimationFrame(tick);
  }

  function startRunning(){
    if(running) return;
    running = true;
    startBtn.setAttribute('aria-pressed','true');
    pauseBtn.disabled = false;
    lapBtn.disabled = (mode !== 'stopwatch');
    startTime = performance.now();
    // when previously paused, startTime uses elapsed
    rafId = requestAnimationFrame(tick);

    if(mode === 'interval'){
      startIntervalMode();
      currentIntervalEl.textContent = `${intervalSeconds}s`;
    }
  }

  function stopRunning(){
    if(!running) return;
    running = false;
    startBtn.setAttribute('aria-pressed','false');
    pauseBtn.disabled = true;
    lapBtn.disabled = true;
    if(rafId) cancelAnimationFrame(rafId);
    // accumulate elapsed
    const now = performance.now();
    elapsed += now - startTime;
    // stop interval
    stopIntervalMode();
  }

  function resetAll(){
    stopRunning();
    elapsed = 0;
    startTime = 0;
    updateDisplay(0);
    msDisplay.textContent = '.000';
    laps = [];
    renderLaps();
    if(mode === 'countdown'){
      // reset countdown target based on inputs
      const mins = Math.max(0, parseInt(minInput.value)||0);
      const secs = Math.max(0, parseInt(secInput.value)||0);
      countdownTarget = (mins*60 + secs)*1000;
      updateDisplay(countdownTarget);
    }
  }

  function updateDisplay(ms){
    const t = formatTime(ms);
    timeDisplay.textContent = t.str;
    msDisplay.textContent = '.' + pad(t.msecs,3);
  }

  function lap(){
    if(mode !== 'stopwatch' || !running) return;
    const now = performance.now();
    const delta = now - startTime + elapsed;
    const t = formatTime(delta);
    const label = `${t.str}.${pad(t.msecs,3)}`;
    laps.unshift({time: delta, label});
    renderLaps();
  }

  function renderLaps(){
    lapsList.innerHTML = '';
    if(laps.length === 0) {
      lapsList.innerHTML = '<div class="muted" style="padding:8px">No laps yet</div>';
      return;
    }
    laps.forEach((l,i) => {
      const el = document.createElement('div');
      el.className = 'lap';
      el.innerHTML = `<div>#${laps.length-i}</div><div>${l.label}</div>`;
      lapsList.appendChild(el);
    });
  }

  function timeUp(){
    // action on countdown end
    playEndSound();
    if(vibrateOn && navigator.vibrate) navigator.vibrate([200,100,200]);
    if(alarmOn) flashPicture();
    // fetch a celebration pup
    fetchDog(true);
    // small shake
    photoCard.animate([{transform:'translateY(0)'},{transform:'translateY(-8px)'},{transform:'translateY(0)'}],{duration:600,iterations:1,easing:'cubic-bezier(.2,.7,.2,1)'});
  }

  function flashPicture(){
    const el = photoCard;
    el.style.transition = 'box-shadow .18s';
    el.style.boxShadow = '0 12px 44px rgba(255,184,107,0.16), 0 2px 10px rgba(0,0,0,0.6)';
    setTimeout(()=> el.style.boxShadow = '', 900);
  }

  // interval mode
  function startIntervalMode(){
    stopIntervalMode();
    intervalSeconds = Math.max(2, parseInt(intSec.value) || 10);
    intervalTimer = setInterval(()=> {
      // fetch and play soft tick
      fetchDog(true);
      if(!muted) beep(880,0.06,'sine',0.06);
    }, intervalSeconds * 1000);
    // immediate first fetch
    fetchDog(true);
  }
  function stopIntervalMode(){
    if(intervalTimer){ clearInterval(intervalTimer); intervalTimer = null; }
  }

  // misc actions
  fetchNow.addEventListener('click', ()=> {
    fetchDog(true);
  });

  startBtn.addEventListener('click', async ()=>{
    // resume audio context on certain browsers
    if(audioCtx.state === 'suspended') await audioCtx.resume();

    if(!running){
      // if countdown prepare target
      if(mode === 'countdown'){
        const mins = Math.max(0, parseInt(minInput.value)||0);
        const secs = Math.max(0, parseInt(secInput.value)||0);
        countdownTarget = (mins*60 + secs)*1000;
        // if elapsed > 0 (paused) then target should be countdownTarget + elapsed? We'll use target relative: countdownTarget is duration wanting to count down to zero. When starting, set elapsed=0
        elapsed = 0;
      }
      startRunning();
      startBtn.textContent = 'Running';
      startBtn.classList.add('pulse');
      setTimeout(()=> startBtn.classList.remove('pulse'), 400);
    }
  });

  pauseBtn.addEventListener('click', ()=>{
    if(running) {
      stopRunning();
      startBtn.textContent = 'Resume';
    }
  });

  resetBtn.addEventListener('click', ()=>{
    resetAll();
    startBtn.textContent = 'Start';
  });

  lapBtn.addEventListener('click', ()=> {
    lap();
  });

  clearLaps.addEventListener('click', ()=> {
    laps = [];
    renderLaps();
  });

  setAlarmBtn.addEventListener('click', ()=> {
    alarmOn = !alarmOn;
    setAlarmBtn.textContent = alarmOn ? 'Bell On' : 'Bell Off';
  });

  vibrateBtn.addEventListener('click', ()=> {
    vibrateOn = !vibrateOn;
    vibrateBtn.textContent = vibrateOn ? 'Vibrate On' : 'Vibrate';
  });

  muteBtn.addEventListener('click', ()=> {
    muted = !muted;
    muteBtn.textContent = muted ? 'Muted üîá' : 'Mute üîà';
  });

  // mode switch buttons
  modeSwitch.forEach(btn => {
    btn.addEventListener('click', ()=>{
      setMode(btn.dataset.mode);
      resetAll();
      startBtn.textContent = 'Start';
    });
  });

  // zoom toggle
  let zoomed = false;
  zoomBtn.addEventListener('click', ()=>{
    zoomed = !zoomed;
    dogImage.style.transition = 'transform .45s cubic-bezier(.2,.9,.2,1)';
    dogImage.style.transform = zoomed ? 'scale(1.25)' : 'scale(1)';
  });

  // download
  downloadBtn.addEventListener('click', async ()=>{
    if(!lastImageUrl) return;
    try {
      const a = document.createElement('a');
      a.href = lastImageUrl;
      a.download = 'puppy.jpg';
      document.body.appendChild(a);
      a.click();
      a.remove();
    } catch(e){}
  });

  // share API
  shareBtn.addEventListener('click', async ()=>{
    const text = `PuppyTimer ‚Ä¢ ${timeDisplay.textContent}${msDisplay.textContent} ‚Ä¢ ${breedTag.textContent}`;
    if(navigator.share && lastImageUrl){
      try {
        await navigator.share({title:'PuppyTimer', text, url:lastImageUrl});
      } catch (e) { /* user cancelled */ }
    } else {
      // fallback copy
      try {
        await navigator.clipboard.writeText(`${text}\n${lastImageUrl}`);
        shareBtn.textContent = 'Copied!';
        setTimeout(()=> shareBtn.textContent = 'Share', 1200);
      } catch {
        alert(text + '\\n' + lastImageUrl);
      }
    }
  });

  // keyboard shortcuts
  window.addEventListener('keydown', (e)=>{
    if(e.code === 'Space'){ e.preventDefault(); if(running) pauseBtn.click(); else startBtn.click(); }
    if(e.key === 'l' || e.key === 'L') lapBtn.click();
    if(e.key === 'n' || e.key === 'N') fetchNow.click();
  });

  // initial load
  fetchDog(false);
  setMode('stopwatch');
  renderLaps();

  // small UI niceties
  // show current interval live update
  intSec.addEventListener('input', ()=> {
    intervalSeconds = Math.max(2, parseInt(intSec.value) || 10);
    currentIntervalEl.textContent = `${intervalSeconds}s`;
    if(mode === 'interval' && running){
      startIntervalMode();
    }
  });

  // Update countdown input bounds
  secInput.addEventListener('input', ()=> {
    let v = parseInt(secInput.value) || 0;
    if(v > 59) secInput.value = v % 60;
  });

  // touch friendly: long-press to fetch a puppy
  let touchTimer = null;
  fetchNow.addEventListener('pointerdown', (e) => {
    fetchNow.setPointerCapture(e.pointerId);
    touchTimer = setTimeout(()=> {
      // long-press: fetch 3 puppies fast
      (async ()=>{
        for(let i=0;i<3;i++){
          await fetchDog(true);
          await new Promise(r=>setTimeout(r, 360));
        }
      })();
    }, 700);
  });
  fetchNow.addEventListener('pointerup', (e) => {
    clearTimeout(touchTimer);
    fetchNow.releasePointerCapture(e.pointerId);
  });
})();
</script>
</body>
</html>