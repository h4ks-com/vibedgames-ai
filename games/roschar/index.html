<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Stormlight 2D Adventure - Skybreaker</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body, html { width: 100%; height: 100%; overflow: hidden; background: #111; color: #eee; font-family: sans-serif; }
    #gameCanvas { background: #223; display: block; margin: 0 auto; }
    #ui { position: absolute; top: 10px; left: 10px; color: #fff; }
    #ui div { margin-bottom: 5px; }
    .button { padding: 5px 10px; background: #446; border: 1px solid #889; cursor: pointer; display: inline-block; margin-right: 5px; }
  </style>
</head>
<body>
  <canvas id="gameCanvas" width="800" height="600"></canvas>
  <div id="ui">
    <div>Spren Collected: <span id="sprenCount">0</span></div>
    <div>Weapon: <span id="currentWeapon">None</span></div>
    <div>
      Craft: 
      <span class="button" data-w="shardblade">Shardblade</span>
      <span class="button" data-w="spear">Spear</span>
    </div>
    <div>
      Shadesmar Fast Travel: 
      <span class="button" data-x="50" data-y="50">Karbranth</span>
      <span class="button" data-x="700" data-y="500">Urithiru</span>
    </div>
  </div>
  <script>
    // Canvas setup
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    const W = canvas.width, H = canvas.height;

    // Game state
    const player = { x: W/2, y: H/2, size: 20, color: '#8af', speed: 3 };
    let sprenCount = 0;
    let currentWeapon = null;
    const enemies = [];
    const storms = [];
    const portals = [ { name: 'Karbranth', x:50,y:50 }, { name:'Urithiru',x:700,y:500 } ];

    // Input
    const keys = {};
    window.addEventListener('keydown', e => keys[e.key] = true);
    window.addEventListener('keyup', e => keys[e.key] = false);

    // UI handlers
    document.querySelectorAll('.button').forEach(btn => {
      btn.addEventListener('click', () => {
        if (btn.dataset.w) {
          const weapon = btn.dataset.w;
          if (sprenCount >= 3) {
            currentWeapon = weapon;
            sprenCount -= 3;
            updateUI();
          } else alert('Need 3 spren to craft!');
        }
        if (btn.dataset.x) {
          player.x = +btn.dataset.x;
          player.y = +btn.dataset.y;
        }
      });
    });

    function updateUI() {
      document.getElementById('sprenCount').textContent = sprenCount;
      document.getElementById('currentWeapon').textContent = currentWeapon || 'None';
    }

    // Random events
    function spawnChasmfiend() {
      enemies.push({ x: Math.random()*W, y: Math.random()*H, size: 30, color: '#f55', speed:1.5 });
    }
    function spawnSpren() {
      enemies.push({ x: Math.random()*W, y: Math.random()*H, size: 10, color: '#af5', spren:true });
    }
    function triggerStorm() {
      storms.push({ timer: 300 });
    }

    // Game loop
    function update() {
      // Move player
      if(keys['ArrowUp'] || keys['w']) player.y -= player.speed;
      if(keys['ArrowDown'] || keys['s']) player.y += player.speed;
      if(keys['ArrowLeft'] || keys['a']) player.x -= player.speed;
      if(keys['ArrowRight'] || keys['d']) player.x += player.speed;

      // Boundaries
      player.x = Math.max(0, Math.min(W, player.x));
      player.y = Math.max(0, Math.min(H, player.y));

      // Random events
      if(Math.random() < 0.005) spawnSpren();
      if(Math.random() < 0.002) spawnChasmfiend();
      if(Math.random() < 0.001) triggerStorm();

      // Storm effect
      storms.forEach(s => s.timer--);
      if(storms.length && storms[0].timer < 0) storms.shift();

      // Enemy movement & collisions
      for(let i = enemies.length-1; i>=0; i--) {
        let e = enemies[i];
        if(e.spren) {
          if(dist(player, e) < (player.size+e.size)/2) {
            sprenCount++; enemies.splice(i,1); updateUI();
            continue;
          }
        } else {
          // move towards player
          let ang = Math.atan2(player.y - e.y, player.x - e.x);
          e.x += Math.cos(ang)*e.speed;
          e.y += Math.sin(ang)*e.speed;
          // collision
          if(dist(player, e) < (player.size+e.size)/2) {
            // if player has weapon, destroy enemy
            if(currentWeapon) enemies.splice(i,1);
            else alert('You were slain by a chasmfiend!');
          }
        }
      }
    }

    function draw() {
      // clear
      ctx.fillStyle = storms.length ? '#445' : '#223';
      ctx.fillRect(0,0,W,H);

      // player
      ctx.fillStyle = player.color;
      ctx.beginPath(); ctx.arc(player.x, player.y, player.size,0,2*Math.PI); ctx.fill();

      // enemies/spren
      enemies.forEach(e => {
        ctx.fillStyle = e.color;
        ctx.beginPath(); ctx.arc(e.x, e.y, e.size,0,2*Math.PI); ctx.fill();
      });

      // storms
      if(storms.length) {
        ctx.fillStyle = 'rgba(200,200,255,0.1)';
        ctx.fillRect(0,0,W,H);
      }
    }

    function loop() {
      update(); draw(); requestAnimationFrame(loop);
    }

    function dist(a,b) { return Math.hypot(a.x-b.x,a.y-b.y); }

    // start
    updateUI(); loop();
  </script>
</body>
</html>
