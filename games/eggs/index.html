<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Web VR Environment with A-Frame</title>
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <style>
        body { margin: 0; }
        canvas { display: none; }
        a-scene { height: 100vh; }
    </style>
</head>
<body>
    <a-scene embedded>
        <a-sky color="#ECECEC"></a-sky>
    </a-scene>

    <script>
        const imageUrl = 'https://www.recipetineats.com/tachyon/2025/02/Devilled-eggs_8.jpg';
        const canvas = document.createElement('canvas');
        const context = canvas.getContext('2d');

        const loadImage = async (url) => {
            return new Promise((resolve, reject) => {
                const img = new Image();
                img.crossOrigin = "Anonymous";
                img.onload = () => resolve(img);
                img.onerror = (err) => reject(err);
                img.src = url;
            });
        };

        const getColorAtPixel = (imageData, x, y) => {
            const index = (y * imageData.width + x) * 4;
            return `rgb(${imageData.data[index]}, ${imageData.data[index + 1]}, ${imageData.data[index + 2]})`;
        };

        const createSphere = (position, color) => {
            const sphere = document.createElement('a-sphere');
            sphere.setAttribute('radius', '0.1');
            sphere.setAttribute('position', position);
            sphere.setAttribute('color', color);
            document.querySelector('a-scene').appendChild(sphere);
        };

        const generateRandomSpheres = (imageData) => {
            const width = imageData.width;
            const height = imageData.height;

            for (let i = 0; i < 200; i++) {
                const x = Math.floor(Math.random() * width);
                const y = Math.floor(Math.random() * height);
                const position = `${(Math.random() - 0.5) * 10} ${(Math.random() - 0.5) * 10} ${(Math.random() - 0.5) * 10}`;
                const color = getColorAtPixel(imageData, x, y);
                createSphere(position, color);
            }
        };

        const start = async () => {
            const img = await loadImage(imageUrl);
            canvas.width = img.width;
            canvas.height = img.height;
            context.drawImage(img, 0, 0);
            const imageData = context.getImageData(0, 0, img.width, img.height);
            generateRandomSpheres(imageData);
        };

        start();
    </script>
</body>
</html>
