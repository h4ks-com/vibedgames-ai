<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>64 Cultures</title>
<style>
  :root{
    --bg:#0b1220;
    --card:#071020;
    --accent:#6ee7b7;
    --muted:#9fb0c8;
    --glass: rgba(255,255,255,0.03);
    --border: rgba(255,255,255,0.04);
  }
  html,body{height:100%}
  body{
    margin:0;
    font-family:Inter,ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial;
    background:
      radial-gradient(800px 400px at 10% 10%, rgba(110,231,183,0.04), transparent 8%),
      radial-gradient(700px 400px at 90% 90%, rgba(109,140,255,0.03), transparent 8%),
      var(--bg);
    color:#e6eef8;
    -webkit-font-smoothing:antialiased;
    -moz-osx-font-smoothing:grayscale;
    padding:28px;
    box-sizing:border-box;
  }

  header{
    display:flex;
    gap:16px;
    align-items:center;
    margin-bottom:18px;
    flex-wrap:wrap;
  }
  h1{
    font-size:20px;
    margin:0;
    color:var(--accent);
    letter-spacing:0.02em;
  }
  .controls{
    margin-left:auto;
    display:flex;
    gap:8px;
    align-items:center;
  }
  button{
    background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
    color:var(--muted);
    border:1px solid var(--border);
    padding:8px 12px;
    border-radius:10px;
    cursor:pointer;
    font-weight:600;
    font-size:13px;
  }
  button:hover{ filter:brightness(1.06) }
  .small{ font-size:13px; color:var(--muted) }

  main{
    display:grid;
    grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
    gap:14px;
  }

  .culture{
    background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.007));
    border:1px solid var(--border);
    padding:12px;
    border-radius:12px;
    box-shadow: 0 6px 20px rgba(2,6,23,0.6);
    display:flex;
    flex-direction:column;
    min-height:160px;
  }

  .culture-header{
    display:flex;
    align-items:center;
    gap:10px;
    margin-bottom:8px;
  }
  .emoji{
    width:44px;
    height:44px;
    display:inline-grid;
    place-items:center;
    font-size:24px;
    border-radius:10px;
    background:linear-gradient(90deg, rgba(255,255,255,0.02), rgba(255,255,255,0.00));
    border:1px solid rgba(255,255,255,0.02);
  }
  .culture-title{
    font-weight:700;
    font-size:14px;
    color:var(--accent);
  }
  .culture-actions{
    margin-left:auto;
    display:flex;
    gap:6px;
  }

  .words{
    margin-top:6px;
    display:grid;
    grid-template-columns: repeat(2, minmax(0,1fr));
    gap:6px;
    overflow:auto;
    padding-right:6px;
    max-height:240px;
  }
  .word{
    font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, "Roboto Mono", "Courier New", monospace;
    font-size:11px;
    background:var(--glass);
    padding:6px 8px;
    border-radius:8px;
    color:#dbeafe;
    border:1px solid rgba(255,255,255,0.02);
    word-break:break-all;
  }

  .footer-note{
    margin-top:12px;
    color:var(--muted);
    font-size:13px;
  }

  /* responsive tweaks */
  @media (max-width:720px){
    .words{ grid-template-columns: repeat(1, minmax(0,1fr)); }
  }

  /* subtle focus styles */
  button:focus{ outline:2px solid rgba(110,231,183,0.14); outline-offset:2px; }
  .culture:focus-within{ box-shadow:0 10px 30px rgba(2,6,23,0.75); border-color:rgba(110,231,183,0.12) }
</style>
</head>
<body>
  <header>
    <h1>64 Cultures</h1>
    <div class="small">Each culture = 64 words (length 64). Pool size: 1000 words.</div>
    <div class="controls" role="region" aria-label="controls">
      <button id="regenerateAllBtn">Regenerate all cultures</button>
      <button id="regenPoolBtn">Regenerate pool only</button>
    </div>
  </header>

  <main id="culturesContainer" aria-live="polite"></main>

  <div class="footer-note">Click a culture's regen button to reshuffle the 64 words for that culture.</div>

<script>
(() => {
  const CHARSET = "abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ-.";
  const WORD_LENGTH = 64;
  const POOL_SIZE = 1000;
  const CULTURE_COUNT = 64;
  const WORDS_PER_CULTURE = 64;

  const EMOJIS = [
    "🐶","🐱","🐭","🐹","🐰","🦊","🐻","🐼","🐨","🐯","🦁","🐮","🐷","🐸","🐵","🐔",
    "🐧","🐦","🐤","🦆","🦉","🦅","🦇","🐺","🦄","🦋","🐌","🐞","🐢","🐍","🦕","🦖",
    "🐙","🦑","🦐","🦞","🦀","🐡","🐠","🐳","🐬","🐋","🦈","🐊","🐅","🐆","🦓","🦍",
    "🦧","🐘","🦛","🦏","🦒","🦬","🐃","🐂","🐄","🐪","🐫","🐐","🐏","🐑","🦙","🐎"
  ];

  // DOM
  const container = document.getElementById("culturesContainer");
  const regenerateAllBtn = document.getElementById("regenerateAllBtn");
  const regenPoolBtn = document.getElementById("regenPoolBtn");

  let pool = [];
  let cultures = []; // array of {emoji, words: []}

  // Utility: secure random integer between 0 (inclusive) and n (exclusive)
  function randInt(n) {
    const u32 = new Uint32Array(1);
    window.crypto.getRandomValues(u32);
    return u32[0] % n;
  }

  function randomWord() {
    // build array of characters for slightly better performance
    let arr = new Array(WORD_LENGTH);
    for (let i = 0; i < WORD_LENGTH; i++) {
      arr[i] = CHARSET.charAt(randInt(CHARSET.length));
    }
    return arr.join("");
  }

  function generatePool() {
    const set = new Set();
    while (set.size < POOL_SIZE) {
      set.add(randomWord());
    }
    pool = Array.from(set);
  }

  function sampleWithoutReplacement(n) {
    // Fisher-Yates partial: pick n unique elements from pool
    // We'll copy indices and shuffle first n items
    const m = pool.length;
    const indices = new Uint32Array(m);
    for (let i = 0; i < m; i++) indices[i] = i;
    // partial shuffle first n
    for (let i = 0; i < n; i++) {
      const j = i + randInt(m - i);
      const tmp = indices[i];
      indices[i] = indices[j];
      indices[j] = tmp;
    }
    const sample = new Array(n);
    for (let i = 0; i < n; i++) sample[i] = pool[indices[i]];
    return sample;
  }

  function randomEmoji() {
    return EMOJIS[randInt(EMOJIS.length)];
  }

  function createCulturesFromPool() {
    cultures = new Array(CULTURE_COUNT);
    for (let i = 0; i < CULTURE_COUNT; i++) {
      cultures[i] = {
        emoji: randomEmoji(),
        words: sampleWithoutReplacement(WORDS_PER_CULTURE)
      };
    }
  }

  function render() {
    container.innerHTML = "";
    const frag = document.createDocumentFragment();
    cultures.forEach((culture, idx) => {
      const card = document.createElement("article");
      card.className = "culture";
      card.setAttribute("data-index", idx);

      const header = document.createElement("div");
      header.className = "culture-header";

      const emojiBox = document.createElement("div");
      emojiBox.className = "emoji";
      emojiBox.textContent = culture.emoji;
      header.appendChild(emojiBox);

      const title = document.createElement("div");
      title.className = "culture-title";
      title.textContent = "Culture " + String(idx + 1).padStart(2, "0");
      header.appendChild(title);

      const actions = document.createElement("div");
      actions.className = "culture-actions";

      const regenBtn = document.createElement("button");
      regenBtn.textContent = "regen";
      regenBtn.title = "Regenerate this culture's 64 words";
      regenBtn.addEventListener("click", (e) => {
        e.stopPropagation();
        regenerateCulture(idx);
      });

      const copyBtn = document.createElement("button");
      copyBtn.textContent = "copy";
      copyBtn.title = "Copy culture words to clipboard";
      copyBtn.addEventListener("click", (e) => {
        e.stopPropagation();
        copyCultureWords(idx);
      });

      actions.appendChild(regenBtn);
      actions.appendChild(copyBtn);
      header.appendChild(actions);

      card.appendChild(header);

      const wordsWrap = document.createElement("div");
      wordsWrap.className = "words";
      culture.words.forEach(w => {
        const wEl = document.createElement("div");
        wEl.className = "word";
        wEl.textContent = w;
        wordsWrap.appendChild(wEl);
      });
      card.appendChild(wordsWrap);

      frag.appendChild(card);
    });
    container.appendChild(frag);
    // smooth scroll to top when regenerating all
    if (render._scrolled === false) {
      // do nothing
    }
  }

  function regenerateAll() {
    // regenerate pool and all cultures
    generatePool();
    createCulturesFromPool();
    render();
  }

  function regeneratePoolOnly() {
    generatePool();
    // keep cultures but reassign words (keep emoji)
    for (let i = 0; i < cultures.length; i++) {
      cultures[i].words = sampleWithoutReplacement(WORDS_PER_CULTURE);
    }
    render();
  }

  function regenerateCulture(index) {
    if (index < 0 || index >= cultures.length) return;
    cultures[index].words = sampleWithoutReplacement(WORDS_PER_CULTURE);
    cultures[index].emoji = randomEmoji();
    // update only that card
    const card = container.querySelector(`.culture[data-index="${index}"]`);
    if (card) {
      const emojiBox = card.querySelector(".emoji");
      emojiBox.textContent = cultures[index].emoji;
      const wordsWrap = card.querySelector(".words");
      wordsWrap.innerHTML = "";
      cultures[index].words.forEach(w => {
        const wEl = document.createElement("div");
        wEl.className = "word";
        wEl.textContent = w;
        wordsWrap.appendChild(wEl);
      });
    } else {
      render();
    }
  }

  function copyCultureWords(index) {
    const culture = cultures[index];
    if (!culture) return;
    const text = culture.words.join("\n");
    navigator.clipboard?.writeText(text).then(() => {
      // temporary visual feedback
      const card = container.querySelector(`.culture[data-index="${index}"]`);
      const btn = card?.querySelector("button:nth-child(2)");
      if (btn) {
        const prev = btn.textContent;
        btn.textContent = "copied";
        setTimeout(() => btn.textContent = prev, 1200);
      }
    }).catch(() => {
      // fallback: select text (not needed)
    });
  }

  // initial generation
  regenerateAll();

  // wire buttons
  regenerateAllBtn.addEventListener("click", () => {
    regenerateAllBtn.disabled = true;
    regenerateAllBtn.textContent = "regenerating...";
    setTimeout(() => {
      regenerateAll();
      regenerateAllBtn.disabled = false;
      regenerateAllBtn.textContent = "Regenerate all cultures";
    }, 60); // tiny delay to show state
  });

  regenPoolBtn.addEventListener("click", () => {
    regenPoolBtn.disabled = true;
    regenPoolBtn.textContent = "regenerating pool...";
    setTimeout(() => {
      regeneratePoolOnly();
      regenPoolBtn.disabled = false;
      regenPoolBtn.textContent = "Regenerate pool only";
    }, 60);
  });

})();
</script>
</body>
</html>