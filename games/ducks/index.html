<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Duck Hunter 3D</title>
<style>
body{margin:0;overflow:hidden;background:#000;user-select:none;font-family:system-ui,sans-serif}
#gameCanvas{display:block}
#ui{position:fixed;top:20px;left:20px;color:#fff;text-shadow:2px 2px 4px rgba(0,0,0,0.8);pointer-events:none;z-index:10}
#crosshair{position:fixed;top:50%;left:50%;width:12px;height:12px;border:2px solid rgba(255,255,255,0.9);border-radius:50%;transform:translate(-50%,-50%);pointer-events:none;z-index:10;box-shadow:0 0 4px rgba(0,0,0,0.8)}
#instructions{position:fixed;bottom:20px;left:50%;transform:translateX(-50%);color:rgba(255,255,255,0.8);font-size:14px;text-align:center;pointer-events:none}
kbd{background:rgba(255,255,255,0.2);padding:2px 6px;border-radius:4px;font-family:monospace}
</style>
</head>
<body>
<div id="ui"><b>Score: <span id="score">0</span></b> | Ducks: <span id="duckCount">0</span></div>
<div id="crosshair"></div>
<div id="instructions">Click to lock pointer • <kbd>WASD</kbd> to move • <kbd>Right Click</kbd> to shoot</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
<script>
const scene=new THREE.Scene();
scene.background=new THREE.Color(0x87CEEB);
scene.fog=new THREE.Fog(0x87CEEB,10,60);

const camera=new THREE.PerspectiveCamera(75,window.innerWidth/window.innerHeight,0.1,1000);
camera.position.y=2;

const renderer=new THREE.WebGLRenderer({antialias:true});
renderer.setSize(window.innerWidth,window.innerHeight);
renderer.shadowMap.enabled=true;
document.body.appendChild(renderer.domElement);

const hemiLight=new THREE.HemisphereLight(0xffffff,0x444444,0.6);
scene.add(hemiLight);
const dirLight=new THREE.DirectionalLight(0xffffff,0.8);
dirLight.position.set(50,100,50);
dirLight.castShadow=true;
dirLight.shadow.mapSize.width=2048;
dirLight.shadow.mapSize.height=2048;
scene.add(dirLight);

const ground=new THREE.Mesh(
new THREE.PlaneGeometry(200,200),
new THREE.MeshStandardMaterial({color:0x55aa55})
);
ground.rotation.x=-Math.PI/2;
ground.receiveShadow=true;
scene.add(ground);

for(let i=0;i<30;i++){
const x=(Math.random()-0.5)*180;
const z=(Math.random()-0.5)*180;
if(Math.abs(x)<10&&Math.abs(z)<10)continue;
const trunk=new THREE.Mesh(new THREE.CylinderGeometry(0.5,0.8,3,8),new THREE.MeshStandardMaterial({color:0x8B4513}));
trunk.position.set(x,1.5,z);
trunk.castShadow=true;
const leaves=new THREE.Mesh(new THREE.ConeGeometry(3,8,8),new THREE.MeshStandardMaterial({color:0x228B22}));
leaves.position.set(x,6,z);
leaves.castShadow=true;
scene.add(trunk);
scene.add(leaves);
}

const ducks=[];
const bullets=[];
let score=0;
const scoreEl=document.getElementById('score');
const duckCountEl=document.getElementById('duckCount');

function createDuck(){
const duck=new THREE.Group();
const bodyMat=new THREE.MeshStandardMaterial({color:0xffdd00});
const body=new THREE.Mesh(new THREE.BoxGeometry(0.8,0.5,1.2),bodyMat);
body.castShadow=true;
duck.add(body);
const head=new THREE.Mesh(new THREE.BoxGeometry(0.5,0.5,0.5),bodyMat);
head.position.set(0,0.5,0.6);
duck.add(head);
const beak=new THREE.Mesh(new THREE.ConeGeometry(0.1,0.3,8),new THREE.MeshStandardMaterial({color:0xff6600}));
beak.rotation.x=Math.PI/2;
beak.position.set(0,0.5,0.9);
duck.add(beak);
const wingGeo=new THREE.BoxGeometry(0.1,0.3,0.8);
const wingMat=new THREE.MeshStandardMaterial({color:0xffcc00});
const leftWing=new THREE.Mesh(wingGeo,wingMat);
leftWing.position.set(0.45,0.1,0);
const rightWing=new THREE.Mesh(wingGeo,wingMat);
rightWing.position.set(-0.45,0.1,0);
duck.add(leftWing);
duck.add(rightWing);
duck.userData={leftWing,rightWing,velocity:new THREE.Vector3((Math.random()-0.5)*0.1,0,(Math.random()-0.5)*0.1),wobble:Math.random()*100};
duck.position.set((Math.random()-0.5)*80,2+Math.random()*3,(Math.random()-0.5)*80);
scene.add(duck);
ducks.push(duck);
duckCountEl.textContent=ducks.length;
}

for(let i=0;i<15;i++)createDuck();
setInterval(()=>{if(ducks.length<25)createDuck();},3000);

const keys={w:false,a:false,s:false,d:false};
document.addEventListener('keydown',e=>{
if(e.code==='KeyW')keys.w=true;
if(e.code==='KeyA')keys.a=true;
if(e.code==='KeyS')keys.s=true;
if(e.code==='KeyD')keys.d=true;
});
document.addEventListener('keyup',e=>{
if(e.code==='KeyW')keys.w=false;
if(e.code==='KeyA')keys.a=false;
if(e.code==='KeyS')keys.s=false;
if(e.code==='KeyD')keys.d=false;
});

document.addEventListener('click',()=>{
if(document.pointerLockElement!==document.body){
document.body.requestPointerLock();
}
});

let yaw=0,pitch=0;
document.addEventListener('mousemove',e=>{
if(document.pointerLockElement===document.body){
yaw-=e.movementX*0.002;
pitch-=e.movementY*0.002;
pitch=Math.max(-Math.PI/2,Math.min(Math.PI/2,pitch));
camera.rotation.order='YXZ';
camera.rotation.y=yaw;
camera.rotation.x=pitch;
}
});

const audioCtx=new(window.AudioContext||window.webkitAudioContext)();
function playGunshot(){
if(audioCtx.state==='suspended')audioCtx.resume();
const osc=audioCtx.createOscillator();
const gain=audioCtx.createGain();
const noise=audioCtx.createBufferSource();
const buffer=audioCtx.createBuffer(1,audioCtx.sampleRate*0.1,audioCtx.sampleRate);
const data=buffer.getChannelData(0);
for(let i=0;i<data.length;i++)data[i]=Math.random()*2-1;
noise.buffer=buffer;
const noiseGain=audioCtx.createGain();
noiseGain.gain.value=0.3;
osc.type='square';
osc.frequency.setValueAtTime(200,audioCtx.currentTime);
osc.frequency.exponentialRampToValueAtTime(50,audioCtx.currentTime+0.1);
gain.gain.setValueAtTime(0.3,audioCtx.currentTime);
gain.gain.exponentialRampToValueAtTime(0.01,audioCtx.currentTime+0.1);
osc.connect(gain);
noise.connect(noiseGain);
noiseGain.connect(gain);
gain.connect(audioCtx.destination);
osc.start();
noise.start();
osc.stop(audioCtx.currentTime+0.1);
noise.stop(audioCtx.currentTime+0.1);
}
function playQuack(){
if(audioCtx.state==='suspended')audioCtx.resume();
const osc=audioCtx.createOscillator();
const gain=audioCtx.createGain();
osc.type='sawtooth';
osc.frequency.setValueAtTime(350,audioCtx.currentTime);
osc.frequency.linearRampToValueAtTime(250,audioCtx.currentTime+0.1);
gain.gain.setValueAtTime(0.2,audioCtx.currentTime);
gain.gain.linearRampToValueAtTime(0,audioCtx.currentTime+0.15);
osc.connect(gain);
gain.connect(audioCtx.destination);
osc.start();
osc.stop(audioCtx.currentTime+0.15);
}
function playMusic(){
if(audioCtx.state==='suspended')audioCtx.resume();
const notes=[110,130.81,146.83,164.81,196,220];
let idx=0;
setInterval(()=>{
if(audioCtx.state==='suspended')return;
const osc=audioCtx.createOscillator();
const gain=audioCtx.createGain();
osc.type='triangle';
osc.frequency.value=notes[idx%notes.length]/2;
gain.gain.setValueAtTime(0.08,audioCtx.currentTime);
gain.gain.exponentialRampToValueAtTime(0.001,audioCtx.currentTime+0.4);
osc.connect(gain);
gain.connect(audioCtx.destination);
osc.start();
osc.stop(audioCtx.currentTime+0.4);
idx++;
},400);
}
playMusic();

document.addEventListener('contextmenu',e=>{
e.preventDefault();
if(!document.pointerLockElement)return;
playGunshot();
const bullet=new THREE.Mesh(new THREE.SphereGeometry(0.08,8,8),new THREE.MeshBasicMaterial({color:0xffff00}));
bullet.position.copy(camera.position);
const dir=new THREE.Vector3();
camera.getWorldDirection(dir);
bullet.userData={velocity:dir.multiplyScalar(2),life:60};
scene.add(bullet);
bullets.push(bullet);
});

const clock=new THREE.Clock();

function animate(){
requestAnimationFrame(animate);
const delta=clock.getDelta();
const time=clock.getElapsedTime();

const forward=new THREE.Vector3(Math.sin(yaw),0,Math.cos(yaw));
const right=new THREE.Vector3(Math.cos(yaw),0,-Math.sin(yaw));
const speed=10*delta;
if(keys.w)camera.position.addScaledVector(forward,speed);
if(keys.s)camera.position.addScaledVector(forward,-speed);
if(keys.d)camera.position.addScaledVector(right,speed);
if(keys.a)camera.position.addScaledVector(right,-speed);
camera.position.y=2;

for(let i=bullets.length-1;i>=0;i--){
const b=bullets[i];
b.position.add(b.userData.velocity);
b.userData.life--;
if(b.userData.life<=0){
scene.remove(b);
bullets.splice(i,1);
continue;
}
for(let j=ducks.length-1;j>=0;j--){
const d=ducks[j];
if(b.position.distanceTo(d.position)<1){
scene.remove(d);
ducks.splice(j,1);
scene.remove(b);
bullets.splice(i,1);
score++;
scoreEl.textContent=score;
duckCountEl.textContent=ducks.length;
playQuack();
break;
}
}
}

ducks.forEach(d=>{
d.position.add(d.userData.velocity);
d.userData.wobble+=delta*3;
d.position.y=2+Math.sin(d.userData.wobble)*0.5;
d.userData.leftWing.rotation.z=Math.sin(time*15)*0.6;
d.userData.rightWing.rotation.z=-Math.sin(time*15)*0.6;
if(Math.abs(d.position.x)>90||Math.abs(d.position.z)>90){
d.userData.velocity.negate();
}
d.rotation.y=Math.atan2(d.userData.velocity.x,d.userData.velocity.z);
});

renderer.render(scene,camera);
}
animate();

window.addEventListener('resize',()=>{
camera.aspect=window.innerWidth/window.innerHeight;
camera.updateProjectionMatrix();
renderer.setSize(window.innerWidth,window.innerHeight);
});
</script>
</body>
</html>