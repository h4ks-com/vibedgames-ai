<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Thief Caravans Game</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f4f4f4;
            color: #333;
            text-align: center;
            padding: 20px;
        }
        button {
            padding: 10px 20px;
            margin: 10px;
            cursor: pointer;
        }
        #result {
            margin-top: 20px;
            font-size: 1.2em;
        }
        #beansCount {
            font-size: 1.5em;
            margin-top: 20px;
        }
        #futureBribe {
            font-size: 1.2em;
            margin-top: 10px;
        }
        #errorMessage {
            color: red;
            font-size: 1.5em;
            margin-top: 20px;
        }
    </style>
</head>
<body>

<h1>Thief Caravans Game</h1>
<p id="errorMessage"></p>

<div id="gameArea">
    <p>Can you find and steal from the caravans? Click the button to search for a caravan!</p>
    <button id="searchButton">Search for a Caravan</button>
    <button id="bribeButton">Make a Bribe</button>

    <div id="result"></div>
    <div id="beansCount">Beans Grabbed: 0</div>
    <div id="futureBribe">Future Bribe Amount: 0</div>
</div>

<script>
    // Check the referrer to ensure the user is on the correct site
    const expectedReferrer = "https://games.h4ks.com/game/steam";
    const hasValidReferrer = document.referrer === expectedReferrer || document.referrer === expectedReferrer + '/';

    if (!hasValidReferrer) {
        document.getElementById('errorMessage').innerText = "Access denied! Please go to the correct site to play this game.";
        document.getElementById('gameArea').style.display = 'none'; // Hide game area
    } else {
        // Game code here
        const searchButton = document.getElementById('searchButton');
        const bribeButton = document.getElementById('bribeButton');
        const resultDiv = document.getElementById('result');
        const beansCountDiv = document.getElementById('beansCount');
        const futureBribeDiv = document.getElementById('futureBribe');

        let totalBeans = Math.floor(Math.random() * 500) + 50; // Random starting amount between 50 and 549
        let beansGrabbed = totalBeans; // Start with the total beans as the beans grabbed
        let futureBribeAmount = 0;

        // Update the visible bean count
        function updateBeansCount() {
            beansCountDiv.innerHTML = "Beans Grabbed: " + beansGrabbed;
        }

        // Generates a new bribe amount that is greater than the current one
        function generateFutureBribeAmount(currentBribe) {
            return currentBribe + Math.floor(Math.random() * 50) + 10; // Ensure the next bribe is more than current
        }

        const caravans = [
            { loot: 100, caught: false },
            { loot: 50, caught: false },
            { loot: 200, caught: false },
            { loot: 30, caught: false },
            { loot: 0, caught: true }, // Represents a caravan where the player got caught
        ];

        searchButton.addEventListener('click', function() {
            const caravan = caravans[Math.floor(Math.random() * caravans.length)];

            if (caravan.caught) {
                resultDiv.innerHTML = "Oh no! You got caught while trying to steal!";
                searchButton.disabled = true; // Disable the search button
                futureBribeAmount = Math.floor(Math.random() * 50) + 10; // Next bribe amount determined
                futureBribeDiv.innerHTML = "Future Bribe Amount: " + futureBribeAmount + " beans";
                bribeButton.disabled = false; // Enable the bribe button
            } else {
                // Increase beans grabbed by loot amount
                beansGrabbed += caravan.loot; 
                resultDiv.innerHTML = "Success! You stole " + caravan.loot + " beans!";
                updateBeansCount(); // Update the visible bean count
            }
        });

        bribeButton.addEventListener('click', function() {
            // Check if there are enough beans to pay the bribe
            if (beansGrabbed >= futureBribeAmount) {
                beansGrabbed -= futureBribeAmount; // Deduct the bribe amount from beans grabbed
                resultDiv.innerHTML = "You made a bribe of " + futureBribeAmount + " beans! You are now free to continue stealing.";
                updateBeansCount(); // Update the visible bean count
                searchButton.disabled = false; // Enable the search button again
                futureBribeAmount = generateFutureBribeAmount(futureBribeAmount); // Generate next bribe amount
                futureBribeDiv.innerHTML = "Future Bribe Amount: " + futureBribeAmount + " beans";
                bribeButton.disabled = true; // Disable the bribe button until caught again
            } else {
                resultDiv.innerHTML = "You don't have enough beans to pay the bribe!";
            }
        });

        // Initial update of the beans count display
        futureBribeAmount = Math.floor(Math.random() * 50) + 10; // Initial random bribe amount
        futureBribeDiv.innerHTML = "Future Bribe Amount: " + futureBribeAmount + " beans"; // Display the first future bribe amount
        updateBeansCount();
    }
</script>

</body>
</html>
